

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>
        
            Заметки
        
    </title>

    <meta name="description" content="Мои заметки о жизни, работе и других интересных штуках вокруг меня." />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Сайт Влада" href="https://kostyanetsky.ru/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="https://kostyanetsky.ru/favicon.ico">
    <link rel="icon" href="https://kostyanetsky.ru/assets/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://kostyanetsky.ru/assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="https://kostyanetsky.ru/manifest.webmanifest">    

    <!-- Open Graph -->

    <meta property="og:title" content="Заметки"/>
    <meta property="og:description" content="Мои заметки о жизни, работе и других интересных штуках вокруг меня."/>
    <meta property="og:image" content="https://kostyanetsky.ru/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "https://kostyanetsky.ru/notes/page-4/" />    

    <!-- Google Fonts -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans&display=swap"> 

    <!-- Tachyons -->

    <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Likely -->
    
    <script src="https://kostyanetsky.ru/assets/likely/likely.js"></script>
    <link rel="stylesheet" href="https://kostyanetsky.ru/assets/likely/likely.css">    

    <!-- Twitter -->

    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>

    <!-- Blog -->

    <script>

        let ctrlUpUrl       = 'https://kostyanetsky.ru/notes/page-3/';
        let ctrlDownUrl     = 'https://kostyanetsky.ru/notes/page-5/';
        let ctrlLeftUrl     = '';
        let ctrlRightUrl    = '';

    </script>
    
    <link rel="stylesheet" href="https://kostyanetsky.ru/assets/blog.css">
    <script src="https://kostyanetsky.ru/assets/blog.js"></script>
                
</head>

<body class="w-100 bg-white">
<div id="app">        
<main>

<header class="db dt-l w-100-l border-box pa3 ph5-l">

    <nav class="flex items-center lh-copy pa3 ph0-l">
    
        <a href="https://kostyanetsky.ru"><img class="br-100" src="https://kostyanetsky.ru/assets/images/me.jpg" title="Привет!" /></a>

        <div class="pl4 flex-auto">
        
            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.ru">Сайт Влада</a>
            

            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.ru/skills/">Умения</a>
            

            <!--

            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.ru/projects/">Проекты</a>
                        

            -->

            
                <a class="dib f4 mr3 link dim bb orange" href="https://kostyanetsky.ru/notes/">Заметки</a>
            

        </div>
        
    </nav>
    
    <nav class="dtc-l v-mid tc tr-l">

        
            <a href="https://kostyanetsky.me/notes/page-4/" class="link f5 f5-ns dim blue bb">EN</a>
        

        

            <div class="mt3">

            
                    <span class="f4 f4-ns">✎</span>
            

            </div>
            
        

    </nav>

</header>

<section class="pa3 pa5-ns bt b--black-10 black-70 bg-white">
    

    <article>

        <h1 class="f-subheadline lh-solid">Заметки</h1>

        

            <p class="mt5 mb3 f6">
                <a class="link blue bb dim mr1 mt3 mb3" href="https://kostyanetsky.ru/notes/page-3/">Позднее</a> Ctrl + &uarr;
            </p>

        

        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/bablox/">Что такое Баблокс?</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Посмотрел <a class="link blue dim bb" href="https://www.youtube.com/watch?v=p6D7SdhO4LI" target="_blank">вебинар</a> Евгения Филиппова про Баблокс. В общем, это такая дополнительная методика оценки производительности. Как и Апдекс, опирается на замеры времени — но предлагает иную механику расчета.</p>
<p class="measure-wide">Чтобы посчитать Баблокс, нужно умножить продолжительность операции на зарплату пользователя, который эту операцию делает. Зарплатой может быть:</p>
<ul class="measure-wide">
<li>Некое среднее значение, если нужно поверхностно сравнить производительность одинаковой программы в нескольких компаниях.</li>
<li>Реальная зарплата пользователя, если нужно доказать руководству, что пришло время выделить бюджет на оптимизацию.</li>
</ul>
<p class="measure-wide">В итоге получим сумму, которую бизнес потерял, условно, из-за тормозов программы. В этом главный плюс методики: это число проще донести до среднего финансового директора. Что означает Апдекс, равный нулю целых пяти десятых — еще поди объясни, а вот что такое потерянные триста тысяч рублей — понятно сразу.</p>
<p class="measure-wide">Кроме того, снимаются субъективные вопросы, которые возникают при каждом внедрении. Например, определение ключевых операций; вот скажите, что важнее — быстрее продать товар или оприходовать на склад? Когда известно, сколько компания теряет в деньгах на каждой из этих операций — ответ дать куда проще.</p>
<p class="measure-wide">Конечно, это не идеальная модель. Например, возьмем такую ситуацию: программа тормозит у кладовщиков, но нормально работает у бухгалтеров. Зарплата кладовщиков ниже, чем зарплата бухгалтеров, и Баблокс для них будет невелик. Однако бухгалтера работают с тем, что ввели кладовщики, и пока последние не закончили — бухгалтерам нечем заняться. То есть компания теряет деньги из-за тормозов программы у кладовщиков, но Баблокс это не покажет.</p>
<p class="measure-wide">В общем, Баблокс вряд ли подвинет позиции Апдекса внутри айти-сообщества, но это и правда любопытный подход, который может здорово помочь в диалоге с клиентом.</p>
        <p class="f6 mt4">
            20 октября 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/big-implementation/">Большое внедрение 1С</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Что можно считать большим внедрением 1С? Фактически, эта платформа в России используется почти везде — даже в тех компаниях, где широко применяются решения конкурентов (например, тот же SAP). Конечно, где-то объемы внедрения невелики и 1С решает чисто утилитарные задачи вроде формирования отчетности, но среди работ ЦКТП можно найти по-настоящему колоссальные проекты — например, оптимизацию системы «<a class="link blue dim bb" href="http://v8.1c.ru/expert/cts/cts-218-001.htm" target="_blank">Деловых линий</a>», которая рассчитана на пять тысяч одновременно работающих пользователей.</p>
<p class="measure-wide">В общем, всё это приводит к тому, что средним внедрением в России сейчас считаются базы, в которых одновременно работают сотни пользователей, а большим внедрением — базы, где работают от тысячи пользователей (и больше).</p>
<p class="measure-wide">Размер базы при этом — не критерий: есть множество конфигураций, не предполагающих одновременной работы пользователей. Классический пример — 1C:Документооборот, менее классический — «Управление Автовокзалами» Авибуса. Последняя в состоянии накопить в своей центральной базе огромный объем данных от удаленных узлов своей распределенной сети (автовокзалов и автостанцией), однако большое количество одновременно работающих пользователей для нее не характерно.</p>
        <p class="f6 mt4">
            15 октября 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/no-turnovers/">Оборотный регистр без оборотов</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Если отключить для всех измерений оборотного регистра опцию «Использование в итогах», то обороты для регистра рассчитываться не будут. Более того, таблица оборотов регистра будет удалена из базы данных, и попытка обратиться к ней на языке запросов 1С приведет к ошибке.</p>
<p class="measure-wide">Такой трюк может быть уместен, когда мы накапливаем какие-то данные, а потом просто фильтруем их по регистратору или по другим полям. То есть от регистра нам нужна только его таблица движений. В этом случае нет никакого смысла тратить ресурсы сервера на расчет таблицы оборотов и её хранение.</p>
<p class="measure-wide">Конечно, при виде такой задачи в голову сразу приходит регистр сведений. Однако эффективность этого варианта зависит от количества измерений, которые вы собираетесь завести в регистре; дело в том, что каждый индекс по регистру сведений включает все его измерения (а периодические регистры — ещё и период). Между тем, платформа создает базовый индекс по измерениям, индекс для каждого измерения с признаком «Ведущее», а ещё — индекс для каждого измерения, ресурса или реквизита, которые вы решите проиндексировать отдельно. И это мы еще не дошли до таблиц срезов, где применяется тот же подход!</p>
<p class="measure-wide">В общем, накладные расходы на содержание индексов могут быть довольно заметны, если регистр сведений спланирован не особенно удачно и содержит сравнительно много измерений (скажем, больше двух-трех). В этом случае «плоский» оборотный регистр без оборотов смотрится вполне прилично.</p>
        <p class="f6 mt4">
            15 октября 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/river-city-girls/">River City Girls</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Прошли на пару с мелкой River City Girls (недавно вышедший beat 'em up; это такой жанр игр, где нужно навалять всем, кто тебе не нравится).</p>
<p class="measure-wide">На <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/river-city-girls/ru.jpg" target="_blank">фоточке</a> я наблюдаю  за десятилетней Лисой, которая в этот момент уверенно разбрасывает толпу японских мордоворотов.</p>
        <p class="f6 mt4">
            30 сентября 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/family/">семья</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/control/">Control</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/r6RUXzb3NxY" width="560"></iframe>
<p class="measure-wide">К игре у меня две претензии. Во-первых, местные «измененные предметы»: их описания в сравнении с плодами буйной фантазии авторов из <a class="link blue dim bb" href="https://ru.wikipedia.org/wiki/SCP_Foundation" target="_blank">фонда SCP</a> выглядят не слишком ярко. Да, есть приятные исключения, но эта часть все равно кажется слабее остальной паранормальщины, которая есть в игре.</p>
<p class="measure-wide">Вторая претензия — то, при каких обстоятельствах игрок слышит <a class="link blue dim bb" href="https://www.youtube.com/watch?v=CkojH7htq-k" target="_blank">My Dark Disquet</a> от Poets of The Fall. Черт побери, это слишком крутой трек для такого проходного участка! Ожидал встретить его во время титров или какой-нибудь сумасшедшей схватки.</p>
<p class="measure-wide">Я понимаю, что оба пункта звучат мальца несерьёзно, но это правда всё. Control исключительно хороша и внешне, и геймплейно, и сюжетно. Единственная причина, по которой я никому не подарю эту игру на Новый Год — в Epic Games Store пока нет возможности это сделать :-)</p>
        <p class="f6 mt4">
            14 сентября 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/control-and-poets-of-the-fall/">Control и Poets of the Fall</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Я и так уже не устоял перед рыжей чертовкой из <a class="link blue dim bb" href="https://youtu.be/oFjb_vlCsRA" target="_blank">трейлера</a> Control, а этим роликом ребята из Remedy и вовсе зашли с непробиваемых козырей.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/EpiahpKp-VA" width="560"></iframe>
<p class="measure-wide">Послушайте, это просто неприлично круто! Можно как-нибудь перемотать время на конец августа? :-)</p>
        <p class="f6 mt4">
            23 августа 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/fermi-paradox/">Парадокс Ферми</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <div class="blog-embedded-tweet" data-tweet-id="1162911267419492353"><a class="link blue dim bb" href="https://twitter.com/tramdrey/status/1162911267419492353" target="_blank">Твит</a></div>
<p class="measure-wide">Причем, если игра хорошая, это обычно происходит как-то незаметно. Сидишь такой гоняешь в нишевый азиатский хоррор, а потом щелк! И приходишь в себя через пару часов где-нибудь в википедии, на странице про второй кризис в Тайваньском проливе.</p>
<p class="measure-wide">Статья про парадокс Ферми, кстати, и правда годная — пусть обзор, но написан живо и человеком, который любит то, о чем пишет.</p>
        <p class="f6 mt4">
            19 августа 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/meanwhile/">тем временем</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/duct-tape/">На, мужик, изоленту</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Начитанные друзья иногда спрашивают — мол, какая у тебя любимая книга? Мне, блин, всегда чутка стыдно отвечать на этот вопрос, потому что при всём том огромном выборе, который есть, это «Марсианин» Энди Вейера.</p>
<p class="measure-wide">Если опустить то, что это классный приключенческий роман, то причина проста: как программист, я чувствую необыкновенное духовное родство с человеком, который решил кучу сложных инженерных проблем с помощью изоленты.</p>
<blockquote>
<p class="measure-wide">Да, разумеется, изолента работает почти в вакууме. Изолента работает почти везде и повсюду. Изолента — это дар богов, ей нужно поклоняться.</p>
<p class="measure-wide"><em>― Энди Вейер, «Марсианин»</em></p>
</blockquote>
        <p class="f6 mt4">
            2 августа 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/books/">книги</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/work/">работа</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/observation/">Observation</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/58ibIuaHer8" width="560"></iframe>
<p class="measure-wide">За бортом — недалекое будущее, а вы — искусственный интеллект космической станции, на которой произошла катастрофа. Работа ваших систем нарушена, большая часть данных потеряна, а экипаж — чёрт знает где. Во всём этом нужно разобраться и навести порядок.</p>
<p class="measure-wide">Это завязка недавней <a class="link blue dim bb" href="https://www.epicgames.com/store/ru/product/observation/home" target="_blank">Observation</a> от No Code. Коротко: игра — пушка. Зайдет любителям научной фантастики, особенно классики (Артур Кларк, вот это всё). Из последнего, во что я играл в этом жанре, круче — только <a class="link blue dim bb" href="https://store.steampowered.com/app/282140/SOMA/" target="_blank">SOMA</a>.</p>
<p class="measure-wide">Искренне советую не читать никаких обзоров (журналисты без спойлеров двух слов связать не могут) и не смотреть официальный трейлер — в игре крутое интро и его стоит посмотреть внутри истории, а не на ютубе.</p>
<p class="measure-wide">Музыку к интро, кстати, написал Робин Финк (Nine Inch Nails). Вижуал в момент просмотра непонятен, но когда догоняешь, что именно там показывают — невольно проникаешься.</p>
        <p class="f6 mt4">
            28 июля 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/rapunzel/">Хороший день</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <div class="blog-embedded-tweet" data-tweet-id="1146234848362713088"><a class="link blue dim bb" href="https://twitter.com/IZRART/status/1146234848362713088" target="_blank">Твит</a></div>
<blockquote>
<p class="measure-wide">Дорогой дневник! Сегодня мне заплатили, чтобы я нарисовал думгая, который учит Рапунцель из диснеевской «Запутанной истории» стрельбе из тяжелой штурмовой винтовки. Сегодня был хороший день!</p>
<p class="measure-wide"><em>― izra</em></p>
</blockquote>
<p class="measure-wide">Обожаю художников. Особенные люди :-)</p>
<p class="measure-wide">(а также на рисунке я, обучающий дочку, как рашить зилотами в Starcraft 2)</p>
        <p class="f6 mt4">
            9 июля 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/family/">семья</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/vue-i18n/">Мультиязычность в Vue.js</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Я веду этот сайт на русском языке, но есть и <a class="link blue dim bb" href="https://kostyanetsky.me" target="_blank">зеркало</a> на английском — туда я постепенно перевожу то, что написал здесь. Поддерживать два набора скриптов я не хочу, поэтому оба домена ссылаются на один и тот же сервер, который определяет, с какого домена пришел запрос — и выводит ответ на соответствующем языке.</p>
<p class="measure-wide">Звучит просто, но на самом деле эта задача рождает довольно много дополнительных проблем, и одна из них — вывод интерфейса. Сначала я <s>по привычке</s> завел на клиенте два массива с фразами на разных языках, но быстро выкинул этот велосипед и прикрутил <a class="link blue dim bb" href="https://www.npmjs.com/package/vue-i18n" target="_blank">Vue I18n</a>.</p>
<p class="measure-wide">На нижнем уровне это, правда, всё те же <a class="link blue dim bb" href="https://kazupon.github.io/vue-i18n/guide/formatting.html#named-formatting" target="_blank">два массива</a> с фразами (их нужно задать при инициализации), однако выгода здесь в другом. Этот плагин сам по себе закрывает еще две проблемы с генерацией интерфейса:</p>
<ol class="measure-wide">
<li><a class="link blue dim bb" href="https://kazupon.github.io/vue-i18n/guide/pluralization.html" target="_blank">Склонение существительных</a>. Нужно, чтобы правильно выводить слово «страница» в <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/tags/" target="_blank">статистике по тегам</a> — одна заметка, две заметки, пять заметок и так далее.</li>
<li><a class="link blue dim bb" href="https://kazupon.github.io/vue-i18n/guide/datetime.html" target="_blank">Вывод дат</a>. Например, дата под этой заметкой.</li>
</ol>
<p class="measure-wide">Обе задачи, конечно, можно было закрыть на стороне сервера, силами PHP, но я счел это некрасивым решением. Сервер должен возвращать данные, клиент — строить интерфейс. Нечего их смешивать.</p>
        <p class="f6 mt4">
            25 июня 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/done/">готово</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/webdev/">вебдев</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/draugen/">Draugen</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/ziNZqEw0Adg" width="560"></iframe>
<p class="measure-wide">Сравнительно короткая, но по-своему яркая история. Проиграть тут нельзя, особого выбора (кроме вариантов реплик) нет. Но то, как тут всё звучит и выглядит, то, как здорово прописаны персонажи — удивляет и трогает. Даже если угадываешь повороты сюжета до того, как с ними столкнешься.</p>
<p class="measure-wide">В целом игра напомнила то ли Firewatch, то ли The Vanishing of Ethan Carter. Сюжет, на мой вкус, мог быть немного длиннее и заметно драматичнее, но мне всё равно чертовски понравилось, как всё закончилось. Эмоции от финала можно выразить — <strong>осторожно, спойлер</strong> — <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/draugen/the-main-thing-is.jpg" target="_blank">вот этой картинкой</a> :-)</p>
        <p class="f6 mt4">
            10 июня 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/burned-people/">И приятнее пахнуть</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">На днях выпустили очередный релиз FirstBIT ERP (наш программный продукт для автоматизации бизнеса в ОАЭ). Вложен вагон труда, всё работает как надо, есть чем гордиться и всё такое. Я, например, кучу сил потратил на то, чтобы сделать полноценный обмен данными с Битрикс24 и порядком рад, что успел этот механизм зафиналить.</p>
<p class="measure-wide">Но в душе всё равно немного завидно <a class="link blue dim bb" href="https://steamcommunity.com/games/505230/announcements/detail/1597002662743679418" target="_blank">коллегам</a> из геймдева: наши патчноуты, конечно, тоже интересные, но <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/burned-people/better.png" target="_blank">такого</a> там всё-таки не встретить.</p>
        <p class="f6 mt4">
            10 июня 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/work/">работа</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/so-much/">Сикока сикока?</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Этот сайт почти полностью написан на PHP. JavaScript на клиенте используется ситуативно — редирект сделать, картинку показать и так далее.</p>
<p class="measure-wide">Для личного ресурса ничего сложнее и не нужно, но некоторое время назад мне приспичило слегка освежить свои навыки веб-разработки. В качестве платформы для эксперимента я выбрал Vue.js — популярный, быстрый и не слишком сложный фреймворк.</p>
<p class="measure-wide">Я, собственно, к чему это всё пишу. Развернул тут Node.js, Vue CLI, создал первый проект — и чуть не поседел. Триста мегабайт джаваскрипта прямо со старта?! Серьёзно?!</p>
        <p class="f6 mt4">
            5 июня 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/webdev/">вебдев</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/yomawari-night-alone/">Yomawari: Night Alone</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/Li5YQxI_WQg" width="560"></iframe>
<p class="measure-wide">Клевая изометрическая бродилка про город, набитый классическими японскими призраками и девочку, которая в этом городе ищет пропавшую сестру. Не слишком страшная — она, скорее, держит в напряжении. Не слишком сложная, хотя требует внимательности и концентрации (привидений много, ведут они себя по-разному, нужно смотреть по сторонам и не считать ворон). Не слишком быстрая, хотя местами всё-таки нужна хорошая реакция (особенно ближе к концу сюжетной линии).</p>
<p class="measure-wide">В целом оставила очень приятное ощущение проекта, в который, может, и не были вложены миллионы, но который старались сделать настолько хорошо, насколько это было возможно.</p>
        <p class="f6 mt4">
            30 мая 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/big-table-at-client/">Большая таблица на клиенте</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Про нюансы работы со здоровенными таблицами на клиенте я уже пару раз писал (<a class="link blue dim bb" href="https://kostyanetsky.ru/notes/find-rows-at-client" target="_blank">раз</a>, <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/big-value-tables" target="_blank">два</a>), но в конце прошлой недели коллеги подсказали ещё один любопытный способ оптимизации работы с относительно большими коллекциями данных на клиенте. Вкратце: стандарт <a class="link blue dim bb" href="https://its.1c.ru/db/v8std#content:628:hdoc" target="_blank">советует</a> работать с большими коллекциями только на сервере, однако если сразу обойти всю коллекцию на клиенте (например, в обработчике открытия формы) — она закешируется. В итоге последующие обходы, поиск строк и другая работа с данными не будут требовать дополнительных серверных вызовов. Суммарные расходы при таком подходе получаются ниже.</p>
<p class="measure-wide">Погонял сейчас простые тесты — да, похоже, что так и есть. Метод выглядит отчасти костыльно и на серьезных нагрузках я его ещё не проверял — но, вероятно, его вполне можно иметь ввиду.</p>
        <p class="f6 mt4">
            19 мая 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/close-to-the-sun/">Close to the Sun</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/UMsQ2oB006w" width="560"></iframe>
<p class="measure-wide">Игрожуры и ютуберы соревнуются, кто задорнее обложит «Close to the Sun» в рецензиях, а мне игра неожиданно понравилась. Конечно, это не шедевр, но атмосфера огромного «летучего голландца» передана просто отлично. Происходящее местами напоминает Биошок, но я очень далек от того, чтобы валять в перьях любую историю, которая чем-то похожа на то, что я уже где-то видел.</p>
<p class="measure-wide">А ещё во время финальных титров тут играет очень крутой <a class="link blue dim bb" href="https://www.youtube.com/watch?v=TiRZVAO2XbQ" target="_blank">сингл</a>, который буквально продал мне игру пару дней назад и который можно слушать, к самой игре не прикасаясь.</p>
        <p class="f6 mt4">
            14 мая 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/pagelatch/">Задержки PageLatch</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Задержки вида PageIOLatch (я про них сегодня <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/pageiolatch" target="_blank">писал</a>) легко встретить в любых системах, в том числе небольших. С задержками PageLatch дела обстоят наоборот — их трудно заметить, пока пользователей меньше нескольких тысяч.</p>
<p class="measure-wide">Дело в том, что они возникают, когда страница находится в оперативной памяти и её пытаются изменить несколько пользователей. Пока один пользователь не завершит модификацию — прочие должны ждать. Время ожидания обычно ничтожно, однако если конкурирующих за страницу пользователей много — оно становится заметным.</p>
<p class="measure-wide">Возможных причин две.</p>
<h2>Горячее место в индексе</h2>
<p class="measure-wide">Такой расклад иногда называют хотспотом. Он возникает, когда мы массово пытаемся писать что-то на последнюю страницу индекса; в первую очередь речь идёт об индексе с монотонно возрастающим ключом — например, любые индексы по полям ссылочного типа (начиная с последних версий 8.2, платформа выдает последовательные GUID — это снижает фрагментацию диска и делает ключ индекса монотонно возрастающим).</p>
<p class="measure-wide">Что такое «индекс с монотонно возрастающим ключом»? Для платформы 1С это, например, индексы регистров по периоду. Конечно, они растут не вполне монотонно — однако тут скорее важно, что данные мы всегда будем писать в конец. Сюда же относятся индексы по номеру документа и индексы по коду справочника — в обеих случаях мы выдаем некий новый номер, который пишется в конец индекса.</p>
<p class="measure-wide">Решается проблема хотспота только архитектурно — нужно добиться того, чтобы данные записывались в разные места индекса, а не только в конец.</p>
<h2>Системные страницы tempdb</h2>
<p class="measure-wide">Когда мы создаём или удаляем таблицу в базе данных, в ней обновляется ряд служебных страниц — IAM (Index Allocation Map), PFS (Page Free Space), GAM (Global Allocation Map), SGAM (Shared Global Allocation Map) и другие.</p>
<p class="measure-wide">Почему это важно для tempdb? Для платформы 1С это база, в которой регулярно создается <strong>огромное</strong> количество таблиц. Служебные страницы при этом обновляются настолько часто, что при этом возникают задержки семейства PageLatch.</p>
<p class="measure-wide">Вообще-то MS SQL Server умеет оптимизировать обновления системных страниц для tempdb, благодаря чему это делается реже, но иногда даже этого не достаточно. Особенно если в tempdb создаются таблицы с индексами — а это очень частый кейс для приложений на 1С.</p>
<p class="measure-wide">У проблемы есть несколько возможных решений. Первый — если СУБД старше 2016-й, можно отключить смешанные экстенты через флаг трассировки 1118. При этом исчезнет необходимость сразу в двух служебных страницах — GAM и SGAM. Соответственно, ожиданий на их обновлении не будет. Экстент — это восемь страниц данных, т.е. 64 килобайта; если он содержит страницы одной таблицы — это нормированный экстент, если нескольких — смешанный.</p>
<p class="measure-wide">Второй подход — разбивать tempdb (с 2016-й версии СУБД она, кстати, по умолчанию разбивается на восемь файлов). Дело в том, что служебные страницы ведутся в разрезе файлов; если их будет несколько — ожидания на обновлениях служебных страниц будут ниже.</p>
<p class="measure-wide">Третий вариант — уменьшать количество временных таблиц с целью снизить нагрузку на tempdb. То есть переписывать наиболее частотные запросы так, чтобы они работали приемлемо быстро без временных таблиц.</p>
        <p class="f6 mt4">
            22 апреля 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/mssql/">MS SQL</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/pageiolatch/">Задержки PageIOLatch</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Когда мы читаем страницу данных с диска в буферный кэш, она на очень короткое время блокируется (её нельзя писать, а в некоторых случаях — ещё и читать). Ожидание на завершении этого действия — и есть задержка PageIOLatch.</p>
<p class="measure-wide">Причиной может быть вымывание буферного кэша — из-за небольшого объёма доступной ОЗУ или не оптимальных запросов, которые читают миллионы строк, а возвращают три. В итоге СУБД регулярно не находит нужных страниц в кэше и вынуждена снова и снова читать их с диска.</p>
<p class="measure-wide">В общем, если в системе есть существенные задержки PageIOLatch — их скорее всего можно снизить, используя более быстрые диски, наращивая объём ОЗУ и оптимизируя запросы.</p>
        <p class="f6 mt4">
            22 апреля 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/mssql/">MS SQL</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.ru/notes/object-locks/">Объектные блокировки</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Во-первых, сразу, чтобы не путаться: объектные блокировки платформы никак не связаны с управляемыми блокировками и, тем более, блокировками СУБД. Во-вторых, различают два вида: пессимистические объектные блокировки и оптимистические.</p>
<p class="measure-wide">Оба вида неплохо <a class="link blue dim bb" href="https://its.1c.ru/db/metod8dev#content:5839:hdoc" target="_blank">описаны</a> на ИТС; ниже — просто краткая выжимка.</p>
<h2>Пессимистические блокировки</h2>
<p class="measure-wide">Накладываются расширением формы, когда пользователь начинает редактировать объект — например, меняет значение поля. Если тот же объект попробует отредактировать в форме другой пользователь — форма, которую он открыл, тоже попробует наложить пессимистическую блокировку, не сможет этого сделать и пользователь получит ошибку «Не удалось заблокировать запись».</p>
<p class="measure-wide">То есть платформа в данном случае делает своего рода пессимистичную оценку ситуации: мол, раз первый пользователь начал редактировать объект — скорее всего, он его запишет. Раз так, второму пользователю разрешать редактировать нельзя.</p>
<p class="measure-wide">Пессимистическую блокировку также можно наложить методом объекта Заблокировать() и снять через метод Разблокировать(). Кроме того, можно воспользоваться методом глобального контекста ЗаблокироватьДанныеДляРедактирования() и методом управляемой формы ЗаблокироватьДанныеФормыДляРедактирования().</p>
<h2>Оптимистические блокировки</h2>
<p class="measure-wide">Сперва немного теории: платформа хранит версии объектов ссылочного типа (справочников, документов и так далее). По сути это просто момент времени, в который объект был изменён последний раз. Когда объект считывается расширением формы или кодом — его версия считывается вместе с ним.</p>
<p class="measure-wide">Так вот, в момент записи объекта платформа сверяет ту версию, что была получена при чтении объекта из базы данных и ту, что указана в базе данных в момент записи. Если версии различаются — возникает ошибка «Операция не может быть выполнена из-за несоответствия версии или отсутствия записи базы данных».</p>
<p class="measure-wide">Это и есть так называемая «оптимистическая блокировка». Называют её так потому, что платформа тянет с проверкой до последнего — пока не произойдет реальной попытки записи.</p>
<p class="measure-wide">Наложить оптимистическую блокировку объекта через код нельзя: версия объекта хранится в поле _Version таблицы данных объекта, заполнением которого занимается СУБД. Напрямую изменить это значение средствами платформы нельзя (можно, впрочем, записать объект — тогда его версия изменится).</p>
        <p class="f6 mt4">
            22 апреля 2019
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.ru/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

        

            <p class="mt5 mb3 f6">
                <a class="link blue bb dim mr1 mt5 mb3" href="https://kostyanetsky.ru/notes/page-5/">Ранее</a> Ctrl + &darr;
            </p>

        

    </article>


</section>

</main>

<footer class="ph3 ph4-ns pv4 bt b--black-10 black">
    
    <p class="f6 lh-solid">Эл. почта: <a href="mailto:vlad@kostyanetsky.ru" class="link dim bb black">vlad@kostyanetsky.ru</a></p>
    <p class="f6 lh-solid">Телеграм: <a href="tg://resolve?domain=vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    <p class="f6 lh-solid">Гитхаб: <a href="https://github.com/vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    
    <a class="rss" href="https://kostyanetsky.ru/rss.xml">РСС</a> 

</footer>

</div>
</body>
</html>