

<!doctype html>
<html lang="ru" class="text-[18px] leading-[1.65]">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Заметки</title>

    <meta name="description" content="" />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Сайт Влада" href="https://kostyanetsky.ru/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="https://kostyanetsky.ru/favicon.ico">
    <link rel="icon" href="https://kostyanetsky.ru/assets/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://kostyanetsky.ru/assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="https://kostyanetsky.ru/manifest.webmanifest">    

    <!-- Open Graph -->

    <meta property="og:title" content="Заметки"/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content="https://kostyanetsky.ru/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "https://kostyanetsky.ru/notes" />    

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

<style>

  /* PT Sans (regular) — modern set */
  @font-face {
    font-family: "PT Sans";
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src:
      local("PT Sans"),
      local("PTSans-Regular"),
      url("../assets/fonts/pt-sans-v16-latin_cyrillic-regular.woff2") format("woff2"),
      url("../assets/fonts/pt-sans-v16-latin_cyrillic-regular.woff") format("woff");
  }

  :root {
    --site-font: "PT Sans", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial,
      "Apple Color Emoji", "Segoe UI Emoji";

    --text: rgb(0 0 0);                /* black */
    --text-strong: rgb(0 0 0);         /* black */
    --muted: rgb(71 85 105);           /* slate-600 */
    --link: rgb(15 23 42);             /* slate-900 */
    --link-underline: rgb(203 213 225);/* slate-300 */
    --link-underline-hover: rgb(100 116 139); /* slate-500 */

    --border: rgb(226 232 240);        /* slate-200 */
    --surface: rgb(255 255 255);       /* white */
    --surface-soft: rgb(248 250 252);  /* slate-50 */

    --radius-sm: 10px;
    --radius-md: 16px;

    --space-1: 0.35rem;
    --space-2: 0.75rem;
    --space-3: 0.9rem;
    --space-4: 1.2rem;
    --space-5: 1.8rem;
  }

  body {
    font-family: var(--site-font);
    color: var(--text);
    font-kerning: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  ::selection {
    background: rgb(226 232 240);
  }

  .prose-like > * + * {
    margin-top: var(--space-3);
  }

  .prose-like p {
    color: var(--text);
  }

  .prose-like strong {
    color: var(--text-strong);
    font-weight: 600;
  }

  .prose-like h2 {
    margin-top: var(--space-5);
    font-size: 1.25rem;
    line-height: 1.5;
    font-weight: 600;
    color: var(--text-strong);
  }

  .prose-like ul,
  .prose-like ol {
    padding-left: 1.2rem;
    color: var(--text);
  }

  .prose-like ul {
    list-style: disc;
  }

  .prose-like ol {
    list-style: decimal;
  }

  .prose-like li {
    margin-top: var(--space-1);
  }

  .prose-like a {
    color: var(--link);
    text-decoration: underline;
    text-decoration-color: var(--link-underline);
    text-decoration-thickness: 1px;
    text-underline-offset: 0.18em;
  }

  .prose-like a:hover {
    text-decoration-color: var(--link-underline-hover);
  }

  .prose-like a:focus-visible {
    outline: 2px solid rgb(148 163 184); /* slate-400 */
    outline-offset: 2px;
    border-radius: 6px;
  }

  .prose-like :not(pre) > code {
    font-size: 0.95em;
    padding: 0.1em 0.35em;
    border: 1px solid var(--border);
    border-radius: 0.5rem;
    background: var(--surface-soft);
  }

  .prose-like pre {
    margin-top: 1rem;
    padding: 0.9rem 1rem;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    background: var(--surface-soft);
    overflow-x: auto;
    max-width: 100%;
    -webkit-overflow-scrolling: touch;
    tab-size: 2;
  }

  .prose-like pre code {
    display: block;
    padding: 0;
    border: 0;
    background: transparent;
    border-radius: 0;

    font-size: 0.95rem;
    line-height: 1.6;
    color: rgb(15 23 42);
    white-space: pre;
    word-break: normal;
  }

  .prose-like a[id] {
    scroll-margin-top: 6rem;
  }

  .figure {
    margin-top: var(--space-4);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    overflow: hidden;
    background: var(--surface);
  }

  .figure img {
    width: 100%;
    height: auto;
    display: block;
  }

  .figure figcaption {
    padding: var(--space-2) 1rem;
    font-size: 0.875rem;
    color: var(--muted);
    border-top: 1px solid var(--border);
    background: var(--surface-soft);
  }

  .prose-like blockquote {
    margin-top: var(--space-4);
    padding: 0.75rem 1rem;
    border-left: 4px solid var(--border);
    background: var(--surface-soft);
    border-radius: var(--radius-sm);
    color: rgb(30 41 59);
  }

  .prose-like hr {
    margin-top: var(--space-5);
    border: 0;
    border-top: 1px solid var(--border);
  }
</style>

    <!-- Blog -->

    <script>
        let ctrlLeftUrl     = 'https://kostyanetsky.ru/notes/page-2';
        let ctrlRightUrl    = '';
    </script>
    
    <script src="https://kostyanetsky.ru/assets/blog.js"></script>    

  </head>

  <body class="min-h-screen bg-white text-slate-900">

<!-- Shared wrapper: top menu -->
<header class="border-b border-slate-200">
  <div class="mx-auto w-full max-w-4xl px-4 py-5">
    <div class="flex flex-wrap items-baseline gap-x-5 gap-y-2">
      
      <nav class="flex flex-wrap items-baseline gap-x-5 gap-y-2 text-sm">
        
        
        
        
        

        
        
          <a class="inline-block text-[1.25rem] leading-tight mr-4 border-b border-current no-underline transition-opacity hover:opacity-70 text-blue-600" href="https://kostyanetsky.ru/">Сайт Влада</a>
        

        
        
          <a class="inline-block text-[1.25rem] leading-tight mr-4 border-b border-current no-underline transition-opacity hover:opacity-70 text-blue-600" href="https://kostyanetsky.ru/projects/">Проекты</a>
        

        
        
          <span class="inline-block text-[1.25rem] leading-tight mr-4 text-black font-medium">Заметки</span>
        
      </nav>

      
      <div class="ml-auto flex items-center gap-4">
        
          
            <span
              class="inline-block text-[1.35rem] leading-none text-slate-400"
              title="Видите опечатку? Поправьте меня!"
              aria-disabled="true"
            >✎</span>
          
        

        
          
          <a
            href="https://kostyanetsky.me/notes"
            class="inline-block text-[1rem] leading-tight text-blue-600 border-b border-current no-underline transition-opacity hover:opacity-70"
            title="EN"
          >
            EN
          </a>
        
      </div>
    </div>
  </div>
</header>

    <!-- Shared wrapper: content -->
    <main
      class="mx-auto w-full max-w-4xl px-4 py-10"
      id="pageMeta"
      data-page="1"
      data-total-notes="20"
      data-total-pages="12"
    >
      <a id="top" class="block scroll-mt-24"></a>

      

      <header class="space-y-3">
        <h1 class="text-3xl font-semibold tracking-tight">Заметки</h1>
        <p class="max-w-2xl text-slate-700">
          Мои мысли о жизни, работе и разных интересных штуках вокруг меня.
        </p>
      </header>

      <section class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="relative w-full sm:w-[420px]">
          <input
            id="search"
            type="search"
            placeholder="Поиск по заголовку / тегам / тексту…"
            class="w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 pr-10 text-sm text-slate-900 placeholder:text-slate-400 outline-none transition focus:border-slate-400"
          />
          <svg
            class="pointer-events-none absolute right-3 top-1/2 h-5 w-5 -translate-y-1/2 text-slate-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m21 21-4.35-4.35m1.35-5.65a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"
            />
          </svg>
        </div>

        <p class="text-sm text-slate-600">
          Показано: <span id="count" class="font-semibold text-slate-900">0</span>
          <span class="text-slate-400">·</span>
          <span id="pageInfo">Страница</span>
        </p>
      </section>

      <!-- Static notes (SEO + no-JS fallback) -->
      <section id="staticNotes" class="mt-10 space-y-12">
                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/backup-ui"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Управление бэкапами
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>6 декабря 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#done</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>В конце года выкатили для нашего внутреннего инструмента (я уже вскользь <a href="https://kostyanetsky.ru/notes/easter-eggs" target="_blank">писал</a> о нём) большой апдейт, дающий коллегам адекватный доступ к бэкапам пользовательских приложений. Бэкапы в SaaS-компании нужны всем и всегда — для разработки, для тестирования, для расследования проблем, да много для чего. Без адекватного учёта процесс превращается в зоопарк, когда три человека в один момент времени создают три запроса на практически одинаковые копии одной и той же базы. Задача, конечно, решается, но ресурсов прожрано в три раза больше, чем хотелось бы.</p>
<p>У нас уже было решение на базе UI Битрикса, но в силу, э-э, особенностей развития этого продукта оно приносило больше боли, чем пользы. Поэтому мы переосмыслили процесс и всё переписали. На фронте — 1C, на бэке — PostgREST, PostgreSQL, PowerShell и много чего ещё. Логика довольно сложная, но у пользователя — простой и дружелюбный UI, через который можно заказать бэкап буквально в два нажатия.</p>
<p>Выбрать можно один из трёх видов бэкапов:</p>
<ul>
<li>облачный (копия реального приложения, развёрнутая в облаке и доступная, в том числе, через браузер);</li>
<li>файловый бэкап (обычный .dt-файл, который можно скачать и развернуть на локальной машине);</li>
<li>бэкап конфигурации и расширений (.cf + .cfe).</li>
</ul>
<p>Кроме того, новое решение отслеживает попытки заказать бэкап приложения, если он уже делается прямо сейчас. А ещё — не даёт пользователям бэкапить одно и то же приложение чаще, чем раз в час. </p>
<p>Ну и продолжаем хохмить в интерфейсе, конечно.</p>
<p><img alt="But Still!" src="https://kostyanetsky.ru/notes/backup-ui/but-still.png"/></p>
<p><img alt="Coffee First!" src="https://kostyanetsky.ru/notes/backup-ui/coffee-first.png"/></p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/desire-paths"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Протоптанные дорожки
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>29 ноября 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#optimization</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Ладно, загадка Жана Фреско. У вас есть таблица, скажем, на 50 тысяч строк. Как прочитать из неё полмиллиарда?</p>
<p>Раз плюнуть, Nested Loops + Clustered Index Seek:</p>
<p><img alt="Полмиллиарда" src="https://kostyanetsky.ru/notes/desire-paths/500_million.png"/></p>
<p>От Clustered Index Seek тут одно название, конечно. Фактически оператор при каждом исполнении пробегает по всей таблице (всему кластерному индексу) и сверяет каждую запись с Predicates. И так — 10 730 раз для 51 391 записей. В итоге 551 425 430 строк прочитали, 13 343 вернули.</p>
<p><img alt="Ох" src="https://kostyanetsky.ru/notes/desire-paths/ouch.gif"/></p>
<p>Короче, идеальный пример плохого плана запроса в вакууме, хоть сейчас тащи в палату мер и весов. Nested Loops, если кто позабыл, работает примерно так:</p>
<pre>
For Each Table1Row In Table1 Do
    For Each Table2Row In Table2 Do
        ...
</pre>
<p>Это ОК для мелких таблиц, но СУБД может его применить и для таблиц поболбше — например, если ей не хватает времени на построение плана.</p>
<p>Это и произошло в нашем случае. Прыгнем повыше, на уровень платформы: тут у нас динамический список с запросом по таблице документа, к которой разработчики прицепили с десяток виртуальных таблиц регистров накопления.</p>
<p>Некоторые регистры и сами по себе были здоровенными, а виртуальные таблицы дополнительно поддали жару (каждая превращается в 2+ вложенных запроса). СУБД честно пыталась придумать эффективный алгоритм, но в какой-то момент решала, что хреновый план запроса всё же лучше, чем вообще никакого.</p>
<p>В итоге пользователь что? Пытался поискать документ по номеру и клиентское приложение просто-напросто зависало.</p>
<p>Короче, по поводу виртуальных таблиц в динамических списках. В английском есть выражение «desire path», «протоптанная дорожка». Часто прицепить виртуальную таблицу к основной — и в самом деле самый простой, быстрый и привычный способ решить задачу. Но он <strong>не эффективен</strong>.</p>
<p>Есть, например, обработчик <code>ПриПолученииДанныхНаСервере()</code>. Он дольше в реализации, но позволяет хорошо затюнить виртуальную таблицу и избежать сценария выше. На каждую прокрутку списка получится больше запросов, но они будут быстрее и эффективнее, чем один, но гигантский.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/obsidian-foodiary-bases"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Дневник питания в Obsidian Bases
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>23 ноября 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#done</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#obsidian</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Переписал с помощью <a href="https://help.obsidian.md/bases" target="_blank">Obsidian Bases</a> свой прошлогодний <a href="https://kostyanetsky.ru/notes/obsidian-foodiary" target="_blank">плагин</a>, считающий калории, белки, жиры и углеводы в пище. Получилось сильно более гибкая и настраиваемая штука, чем в виде плагина — не нужно ничего переписывать, собирать и релизить, если вдруг решил посчитать клетчатку в еде или просто подвигать колонки в отчёте.</p>
<p>Ну и симпатичная, да:</p>
<p><img alt="UI" src="https://kostyanetsky.ru/notes/obsidian-foodiary-bases/base.png"/></p>
<p>Все необходимые настройки и скрипты — в <a href="https://github.com/vkostyanetsky/ObsidianFoodiaryBases" target="_blank">репозитории</a> на Github'е; инструкция <a href="https://github.com/vkostyanetsky/ObsidianFoodiaryBases/blob/main/README.ru.md" target="_blank">переведена</a> на русский язык.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/well-there-are-some"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Ну, есть кое-какие
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>17 ноября 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#meanwhile</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Гуляю вечером, сзади идёт какая-то мама и её мелкий — лет пяти, наверное. Я их не вижу, просто слышу разговор. Мама объясняет ребенку про университет: мол, туда надо поступить, учиться, будут экзамены и всё такое.</p>
<p>Мальчик молчит, потом расстроенно выдает:</p>
<p>— Я думал, есть только школа, а оказывается есть ещё сложности...</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/harmless-harm"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Безвредный вред
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>16 ноября 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#pgsql</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#mssql</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Разбирали на днях с коллегой проблему. Ничего особенно серьёзного, очередное расследование вида «какого черта этот запрос ведет себя странно?».</p>
<p>Упрощая, суть: читаем таблицу базы данных и кладем результат во временную таблицу. Если срабатывает определённое условие, нужно, чтобы временная таблица всё равно создавалась, но была пустой (независимо от того, есть строки в исходной таблице или нет).</p>
<p>Запрос был примерно такой:</p>
<pre>
SELECT
    Table.Field1 AS Field1
FROM
    Table AS Table
WHERE 
    &amp;Parameter
</pre>
<p>Если нужно было отбирать записи из исходной таблицы во временную, в параметр передавался TRUE; если временную таблицу нужно было получить пустой — передавался FALSE.</p>
<p>Несмотря на кажущуюся простоту, такой трюк — проблема для производительности, если таблица, которую читает запрос — большая.</p>
<p>Причина в том, как СУБД работают с параметризованными запросами. И MS SQL, и PostgreSQL строят план выполнения запроса на основе его текста, и в примере выше значение параметра <strong>не</strong> повлияет на принятие решения, нужно читать таблицу или нет.</p>
<p>Таким образом, при выполнении такого запроса обе СУБД педантично прочитают всю таблицу (ну, или её индекс), даже если параметр равен FALSE. В последнем случае каждая прочитанная запись будет отброшена и алгоритм будет работать корректно, однако мы будем тратить ресурсы на бессмысленное чтение данных и забивать буферный кэш, замедляя систему в целом и активно работая на глобальное потепление :)</p>
<p>Решение тут простое — вставлять TRUE/FALSE в тело запроса как константу, не используя параметр. Либо использовать оператор TOP, так текст запроса будет даже проще:</p>
<pre>
SELECT TOP 0
    Table.Field1 AS Field1
FROM
    Table AS Table
</pre>
<p>Тут на уровне SQL мы получим что-то вроде «SELECT TOP 0 ... FROM Table» (для MS SQL) и «SELECT ... FROM Table LIMIT 0» (для PostgreSQL). В итоговом плане будет оператор чтения, но исполнитель фактически не запросит ни одной строки, так что реального сканирования данных не случится (ура).</p>
<p>P.S. Если не критично получать во временной таблице корректные типы колонок, можно вообще вот так:</p>
<pre>
SELECT TOP 0
    UNDEFINED AS Field1
</pre>
<p>Выигрыш в производительности, впрочем, будет таким копеечным, что можно не упарываться. </p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/voodoo"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Шаманство
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>5 октября 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Поймали, кажется, первый воспроизводимый в лабораторных условиях сценарий повреждения кэша платформы. Короткий синопсис:</p>
<ul>
<li>Создаем новое приложение из шаблона 35-го релиза <a href="https://firstbit.ae" target="_blank">нашей ERP</a>.</li>
<li>Запускаем его и ждем, когда закончится инициализация.</li>
<li>Заменяем конфигурацию приложения на 36-й релиз (конкретно, версию 28537 из хранилища разработки) и снова запускаем.</li>
</ul>
<p>После этих нехитрых действий примерно у половины нашей команды платформа перестаёт видеть одно из перечислений. Причем, зараза, избирательно: обращаешься к элементу перечисления на клиенте — полный порядок, обращаешься на сервере — ловишь исключение.</p>
<p>Такая же петрушка с модулем менеджера одного из справочников: его методы недоступны, хотя существуют и объявлены как экспортные. Однако платформа после обновления делает вид, что их нет, и швыряется исключениями при попытке обратиться.</p>
<p><a href="https://x.com/EffinBirds/status/1970264357427704080" target="_blank"><img alt="Welcome To Dipshit Central" src="https://kostyanetsky.ru/notes/voodoo/welcome.jpg"/></a></p>
<p>Как и всегда, когда начинается магия — проблему нужно искать в кэше. Чистишь — все симптомы бесследно исчезают. Кроме того, есть и косвенные признаки:</p>
<ul>
<li>Перечисление было и в 35-м релизе, но было переименовано в 36-м;</li>
<li>Методов в 35-м релизе вообще не было (в 36-м их как раз разработали). </li>
</ul>
<p>То есть не первого, не вторых в кэше 35-го релиза не существовало, а платформа, по какой-то причине, пытается рыться в именно в нём.</p>
<p>Мы пока не доискались, что вызывает сбой. Вышли на конкретный коммит, после которого появилась проблема, но в нём из необычного — одно <a href="https://kostyanetsky.ru/notes/voodoo/the-commit.png" target="_blank">название</a> (и то поблизости есть куда более подозрительные с этой точки зрения <a href="https://kostyanetsky.ru/notes/voodoo/the-other-commit.png" target="_blank">кандидаты</a>). В остальном там минорные <a href="https://kostyanetsky.ru/notes/voodoo/5ba6ac0956e0cc7bc6b520e5110420e6950478fe.diff" target="_blank">изменения</a>, сопровождаемые заменой внутренних идентификаторов объекта метаданных. Они, конечно, связаны с ключами кэша, но их сброс делается при любом изменении любых метаданных и никогда раньше не приводил к проблемам.</p>
<p>Если вы набрели на эту заметку из гугла, потому что столкнулись с той же бедой — закиньте в проблемный объект какую-нибудь правку, чтобы платформа опять сменила идентификаторы объекта метаданных в манифесте. Например, добавьте пустой метод или просто пробел в текст модуля. Это решит проблему с конфигурацией и инструкция в начале заметки перестанет приводить к повреждению кэша.</p>
<p>Шаманство, конечно, но работает ¯\_(ツ)_/¯</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/data-history-missing-indexes"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Медленное удаление областей Фреша
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>3 августа 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Коллега заметил, что на одном из инстансов нашего фреша удаление областей стало идти прямо-таки трагически долго. Что в метриках? Вот это:</p>
<pre>
DELETE FROM T1
FROM _DataHistoryMetadata T1
WHERE 
    T1._MetadataId = ?
    AND T1._IsActual = 0x00 
    AND NOT (
        T1._MetadataVersionNumber IN (
            SELECT T2._MetadataVersionNumber AS MetadataVersionNumber_
            FROM _DataHistoryVersions T2
            WHERE T2._HistoryDataId IN (
                SELECT DataHistoryLatestVersions1.DataHistoryLatestVersions._HistoryDataId AS HistoryDataId_
                FROM DataHistoryLatestVersions1.DataHistoryLatestVersions T3
                WHERE DataHistoryLatestVersions1.DataHistoryLatestVersions._MetadataId = ?
            )
        )
    )
</pre>
<p>Каждый такой запрос читает порядка двадцати гигабайт. Что тут происходит — примерно понятно: платформа пытается удалить историю данных области и кривой запрос к БД приводит к сканированию всей таблицы по всем областям вместо быстрого поиска по индексу. Кто-то на Дмитровском опять поленился.</p>
<p><a href="https://x.com/EffinBirds/status/1945545263407301033" target="_blank"><img alt="Чему ты удивлён?" src="https://kostyanetsky.ru/notes/data-history-missing-indexes/why.png"/></a></p>
<p>В общем, теряем от тридцати секунд до получаса на действие. Хотелось бы побыстрее. Решение:</p>
<pre>
CREATE NONCLUSTERED INDEX IX_DataHistoryLatestVersions1_MetadataId
  ON dbo._DataHistoryLatestVersions1 (_MetadataId)
  INCLUDE (_HistoryDataId)
  WITH (DROP_EXISTING = OFF, ONLINE = OFF);

CREATE NONCLUSTERED INDEX IX_DataHistoryVersions_MetadataVersionNumber
  ON dbo._DataHistoryVersions (_MetadataVersionNumber)
  WITH (DROP_EXISTING = OFF, ONLINE = OFF);
</pre>
<p>Стоимость удаления области ожидаемо просела на ~99%.</p>
<p>Если будете повторять у себя:</p>
<ol>
<li>Формально такой трюк нарушает лицензионное соглашение, you've been warned и всё такое.</li>
<li>Есть риск, что платформа при будущих реструктуризациях будет спотыкаться о новые индексы (особенно при работе по «новой» схеме). Лучше иметь под рукой готовый скрипт, который сможет их грохнуть, а потом (после реструктуризации) — вернуть обратно.</li>
</ol>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/myth-buster"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Развенчиватель мифов
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>27 июля 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Попался под руку объёмный <a href="https://infostart.ru/1c/articles/2434171/" target="_blank">текст</a> на Инфостарте про мифы о платформе, полез читать.</p>
<p>По сути. Половина там написана заголовка ради, кажется. Свежий номер! Криминал, интриги, расследования! Файловая база быстрее клиент-серверной! СКД медленнее запроса! Вызов метода сервера на сервере — новый вызов сервера! <s>НЛО над Красной площадью!</s></p>
<p>Однако местами и правда любопытно. Например, о том, что код, слепленный в одну строку, механически работает в десять раз быстрее, я услышал впервые. Жалко, за такой отчаянный свэг коллеги побьют быстрее, чем успеешь порадоваться результату. Да и основные тормоза enterprise-приложений чаще растут из других мест.</p>
<p>Или, скажем, сравнение скорости выгрузки в таблицу для представлений объектов и для их наименований. Первое — в десятки раз медленнее! На первый взгляд странно: в конце концов, в обоих случаях у нас строки, и на момент замера они уже извлечены из базы. Думаю, что дело в типизации: строки представлений имеют неограниченную длину, в отличие от наименований. Отсюда расходы на выделение памяти, какие-то вспомогательные структуры и вот мы имеем то, что имеем.</p>
<p>P.S. Про некоторые аспекты из статьи я где-то у себя писал. Если навскидку — помню свою попытку <a href="https://kostyanetsky.ru/notes/is-ref-empty" target="_blank">измерить</a> скорость работы <code>ValueIsFilled()</code> и неприятный <a href="https://kostyanetsky.ru/notes/method-with-surprise" target="_blank">сюрприз</a> от встроенного <code>FindByNumber()</code>.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/delete-geometry"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Удаление геометрии
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>12 июня 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#3d</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Освоил прикольный трюк с удалением части объекта в том случае, если он с чем-то пересекается. Например, на этой гифке в центре находится модель головы обезьянки; при движении плоскости видно, как её часть (как раз та, что начинает пересекаться с обезьянкой) исчезает.</p>
<p><img alt="Демо" src="https://kostyanetsky.ru/notes/delete-geometry/demo.gif"/></p>
<p><a href="https://github.com/vkostyanetsky/3DPlayground/blob/main/Geometry%20Nodes/DeleteGeometry.blend" target="_blank">Идея</a> довольно простая: сводим геометрию объекта-ограничителя к кубу, вычисляем его минимальные и максимальные координаты по всем осям, а потом для каждой точки «обрезаемого» объекта проверяем, входит ли она в полученный диапазон. Входит? Удаляем.</p>
<p>Способов применения — масса; например, мне это пригодилось, когда я захотел автоматически отрезать часть линий декоративного нотного стана на стене так, чтобы они не пересекали дверной проем.</p>
<p><img alt="Пример" src="https://kostyanetsky.ru/notes/delete-geometry/case.jpg"/></p>
<p>Конечно, можно было бы сделать это вручную, без геонод, но такой вариант ударил бы по гибкости: изменятся какие-то размеры (ширина стены, размеры двери, угол наклона линий) — всё придётся переделывать.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/no"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Нет
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>11 июня 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p><img alt="Нет" src="https://kostyanetsky.ru/notes/no/no.jpg"/></p>
<p>Сообщение, которое выдает актуальная платформа при попытке подключения к выключенному кластеру серверов. Я, конечно, люблю лаконичность в интерфейсах, но тут всё-таки перебор.</p>
<p>Платформа, причем, установлена с единственным языковым пакетом (английским) и даже запущена с жестким указанием на «Ven VLen», но откуда-то всё равно прорастают родные березки. Возможно, сишная библиотека, откуда стреляет сообщение (DataExchangeTcpClientImpl.cpp) в моем случае смотрит на язык ОС (русский), сложно сказать.</p>
<p>В любом случае, не могу избавиться от ассоциаций с Багзом Банни каждый раз, как вижу это окошко.</p>
<p><img alt="No" src="https://kostyanetsky.ru/notes/no/bugs-bunny.png"/></p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/hottabych"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Проблема джинна
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>12 апреля 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#3d</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <blockquote>
<p>Вернувшись в Волькину комнату, Хоттабыч хитро оглянулся, щелкнул пальцами левой руки, и на стене... Тотчас же появилось точное подобие телефона, висевшего в прихожей. </p>
<p>— Теперь ты сможешь сколько угодно беседовать с друзьями, не покидая своей комнаты.</p>
<p>— Вот за это спасибо! — с чувством промолвил Волька, снял трубку, прижал ее к уху и долго тщетно прислушивался. Никаких гудков не было слышно... </p>
<p>— Аппарат испорчен, — объяснил он Хоттабычу, — сейчас я открою крышку. Посмотрим, в чем там дело. </p>
<p>Но коробка аппарата, несмотря на все усилия Вольки, никак не открывалась. </p>
<p>— Он сделан из цельного куска самого отборного черного мрамора! — похвастался Хоттабыч.</p>
<p>— Значит, внутри там ничего нет? — разочарованно спросил Волька.</p>
<p>— А разве внутри должно что-нибудь быть? — забеспокоился Хоттабыч.</p>
<p>— В таком случае понятно, почему этот телефон не действует, — сказал Волька, — ты сделал только макет телефона, без всего, что полагается внутри.</p>
<p><em>«Старик Хоттабыч», Лазарь Лагин</em></p>
</blockquote>
<p>Занимаясь 3D-моделированием, регулярно ощущаю себя этим джинном. Старик тоже пытался повторять форму предметов и даже делал их симпатичнее, как умел — однако фейлился, так как не понимал, что там внутри. </p>
<p>Вот и я так же. Последний месяц довожу до ума модель школьного класса музыки и знаете что? Об устройстве рояля я уже узнал больше, чем за всю предыдущую жизнь. А ещё могу прочитать короткую лекцию о системах отопления в российских школах: секционных батареях, панельных, чугунных и алюминиевых, какие чаще встречаются, расстояниях между ними, почему не надо подключать три в ряд и так далее :)</p>
<p>Я читал об этом эффекте: мол, рисуешь, например, самурайскую броню — по ходу дела волей-неволей много узнаешь о свойствах кожи, видах металла и технологическом стеке самурайской эпохи в целом. Не думал, правда, что столкнусь с этим буквально с самого начала — но, думаю, это хорошо. Стимуляция нейронных связей, расширение видения мира, развитие креативности и всё такое.</p>
<p>Ну и в целом интереснее работать с моделью, когда понимаешь, что там, так сказать, внутри барабанчика.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/easter-eggs"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Пасхалки
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>6 апреля 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p><img alt="Thank you, Mario!" src="https://kostyanetsky.ru/notes/easter-eggs/mario.jpg"/></p>
<p><img alt="Awaiting Signal" src="https://kostyanetsky.ru/notes/easter-eggs/mothership.jpg"/></p>
<p>Пара пасхалок, которые можно найти внутри FirstBit ERP. Спрятаны для разработчиков: пользователи в первом случае видят на форме заголовок и текст оповещения, а во втором — стандартное waiting for connection.</p>
<p>Люблю время от времени делать такие штуки: это весело, а ещё — помогает не скучать, даже если задача не слишком увлекает или просто устал. Если не читали заметку «<a href="https://collab.ldwg.ru/stressless-design" target="_blank">Дизайн без стресса</a>» Быстроновского — прочитайте, она клёвая (а я все равно не сформулирую лучше).</p>
<p>Вот, кстати, ещё одна пасхалка. Эта уже не из нашей ERP, а из нового инструмента по автоматическому обновлению баз. Его мы пишем сами для себя, поэтому можно хохмить с пользователем :)</p>
<p><img alt="Nice try, Marty!" src="https://kostyanetsky.ru/notes/easter-eggs/marty.jpg"/></p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/across-meeting"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Разработка ERP на английском
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>19 января 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#english</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/mZwHTbu285A" width="560"></iframe>
<p>Ведущий разработчик из нашей команды немного рассказал о нашей работе — конкретно, о разработке ERP на 1С для ОАЭ и, с недавних пор, Саудовской Аравии. Встречу захостила онлайн-школа английского языка Across, так что аудитория получилась соответствующая — русскоговорящие ребята, интересующиеся карьерой и рынками за рубежом.</p>
<p>В целом получилось прикольно, особенно как языковая практика. Напоминаю, что изучение иностранных языков — все ещё один из лучших способов размять мозги и, до кучи, один из самых доступных. Материалов и клубов по интересам не найти невозможно, было бы желание :)</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/safe-code"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Загадочный код
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>18 января 2025</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#georgia</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#videogames</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p><img alt="Код" src="https://kostyanetsky.ru/notes/safe-code/code.jpg"/></p>
<p>Где-то на улицах Тбилиси. Как большой фанат серии Dishonored — не смог пройти мимо. Уверен, поблизости есть сейф, к которому этот код подходит!</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/negativity"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Уходи, негатив!
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>29 декабря 2024</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#georgia</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#meanwhile</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p><img alt="Чичилаки" src="https://kostyanetsky.ru/notes/negativity/chichilaki.jpg"/></p>
<p>Белые штуки на заднем плане называются чичилаки. Это что-то вроде грузинской новогодней ёлки (де-факто, тщательно наструганный орешник). Считается, что он собирает на себя весь накопившийся негатив, так что после праздников его положено сжечь (вместе с негативом).</p>
<p>Последнее, как оказалось, задача со звездочкой. Местная полиция (и особенно пожарка) относится к этой старой доброй традиции с подозрением, и их можно понять (чичилаки бывает и в рост человека, факел выйдет — будь здоров).  Так что «заряженную» негативом чичилаки нам посоветовали просто выкинуть в мусорку, чтобы не нажить свежих проблем. Или сдать в зоопарк: животные ими играют и зубы чистят.</p>
<p>Последнее позабавило. Избавиться от негатива помогают котики, какая неожиданность. Да, здоровенные и повышенной зубастости, но всё же!</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/bit-of-surgery"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Немного хирургии
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>17 декабря 2024</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#1c</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Несколько лет назад попадалась на глаза заметка программиста, которому пришлось отлаживать ПО, управляющее роботом-хирургом, прямо во время операции. Помню, тогда это меня поразило до глубины души.</p>
<p>А сегодня с коллегой ремонтировали кластер 1С с базами на 1cFresh, которому после миграции на соседний сервер внезапно поплохело (если вкратце, при попытке распечатать документ клиентское приложение умирало в муках). Пока возились, мелькнула мысль: это, конечно, не так жутко выглядит, как ремонтировать софт, от которого вот прямо сейчас зависит чья-то жизнь, но... Если посчитать всех клиентов, которые вот прямо сейчас сидят на нервах из-за того, что у них бизнес стоит — ещё неизвестно, где уровень стресса будет выше.</p>
<p>P.S. Технические заморочки для тех, кому интересно. Вышло так, что при миграции кластера права на папку с серверным кэшем переехали некорректно и это привело к любопытному эффекту: в ней оседали только логи, а данные сеансов — нет. В итоге при открытии печатной формы документа конфигурация пыталась положить её в хранилище; rphost, в свою очередь, пытался засунуть её в серверный кэш сеанса.</p>
<p>Так что рабочий процесс (видимо) получал по рукам от ОС, из-за (видимо) кривой отработки событий файловой системы в платформе никак это исключение не обрабатывал и от безысходности убивал сеанс, что, в свою очередь, приводило к крашу клиентского процесса.</p>
<p>Пересобрали права, перезапустили кластер, проблема ушла.</p>
<p><img alt="End of Report" src="https://kostyanetsky.ru/notes/bit-of-surgery/report.jpeg"/></p>
<p>Остальные гипотезы (буйство менеджера кластера, недостаток аппаратных ресурсов, программные ошибки конфигурации, ошибки клиентского процесса, кривая отработка security profile, проблемы c сетью между клиентом и сервером) отбросили по ходу диагностики.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/vaporia"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Смутно знакомый логотип
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>14 декабря 2024</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#ai</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#georgia</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p><del>Тем временем OpenAI открыл в Тбилиси филиал</del> На самом деле тут вейпами торгуют, а дизайнер логотипа, скорее всего, вдохновлялся клубами пара. Но каждый раз, как мимо хожу, глаз цепляется :)</p>
<p><img alt="Vaporia" src="https://kostyanetsky.ru/notes/vaporia/vaporia.jpg"/></p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/creepy-graveyard"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Жуткое кладбище
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>26 ноября 2024</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#3d</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#done</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Продолжаю осваивать 3D в свободное время. Вот, первая более-менее самостоятельная работа с <a href="https://www.udemy.com/course/blender-environments-megacourse-create-3d-environments/" target="_blank">курса</a>, который недавно закончил.</p>
<p><a href="https://kostyanetsky.ru/notes/creepy-graveyard/creepy-graveyard.png" target="_blank"><img alt="Creepy Graveyard" src="https://kostyanetsky.ru/notes/creepy-graveyard/creepy-graveyard.png"/></a></p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/mraGFR_Tr5k" width="560"></iframe>
<p>Проблем, конечно, хватает: и в моделях, и в цветах, и в композиции... Да вообще везде. Хорошо хоть, что сцена по сюжету — ночь и туман. Самые косячные места можно просто спрятать. Не удивлюсь, если авторы курса специально выбрали такой сеттинг, чтобы новички не расстраивались :)</p>
<p>Но результатом я всё равно доволен. Думаю, на этом этапе перфекционизм скорее мешает, чем помогает. К тому же получилось явно лучше, чем прошлая работа. Я тогда был совсем зелёным в Blender и боялся сделать шаг в сторону от преподавателя: десять минут смотрел урок, а потом десять минут пытался повторить.</p>
<p>Такой подход работает только на старте, но не помогает понять, как искать решения проблем. Поэтому в этот раз я смотрел несколько уроков подряд по часу-полтора. Потом пробовал делать сам и к видео возвращался, только если совсем что-то не клеилось. В голове, кажется, осело заметно больше.</p>
<p>Короче, прогресс есть, едем дальше!</p>
<p>UPD: Один из фаундеров FlippedNormals записал <a href="https://www.youtube.com/watch?v=izkRFqBzya0" target="_blank">ролик</a> с теми же мыслями про обучение.</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/slack-summary"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Сводка в Slack
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>10 ноября 2024</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#work</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#done</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#powershell</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Попался под руку <a href="https://gist.github.com/vkostyanetsky/b0807f2df2501bbeeb97c95a977f3e23" target="_blank">скрипт</a>, который я пару лет назад накатал для рабочего GitLab'а. Вкратце: мы ежедневно прогоняем репозиторий разработки через прорву тестов на Ванессе, в результате чего получаем симпатичный отчет — сколько тестов выполнено, какие провалились, причины провалов и так далее.</p>
<p>Отчет нужно постоянно анализировать, хотя бы бегло. Конечно, полностью «зеленых» тестов мы уже давно не видели, и это нормально: например, в случае взаимозависимой разработки, когда коммиты ломают проверяемый функционал, и тесты еще предстоит поправить. Однако держать руку на пульсе все равно необходимо.</p>
<p>Чтобы упростить эту рутину, я немного расширил код пайплайна: после формирования отчета GitLab первым делом создает короткую сводку (тип клиента, тип базы, статистика по тестам) и отправляет ее в слак.</p>
<p><img alt="Отчет" src="https://kostyanetsky.ru/notes/slack-summary/report.jpg"/></p>
<p>Как бонус, стало проще отвечать на философский вопрос «кто все сломал». Чаще всего — автор первого коммита, на котором метрика Scenarios Failed на скриншоте выше пробила потолок :)</p>
            </div>
          </div>
          
        </article>


                
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/butterfly"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Лог и баг
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>12 октября 2024</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">#english</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Люблю иногда покопаться в происхождении слов. Например, «лог» пришло из морского дела и означало буквально бревно: деревянный поплавок, к которому прикрепляли веревку и бросали за борт судна. Верёвка имела узлы на равных промежутках, и по числу узлов, которые успевали размотаться за определённое время, моряки определяли скорость судна.</p>
<p>Эти измерения записывались в судовом журнале, который тоже назывался логом. Со временем так стали называть вообще любой журнал или запись о каком-то событии, а в айти слово вообще обрело вторую жизнь :)</p>
<p>Или, скажем, «баг» — ну, про это, наверное, все слышали? Мотылек, который семьдесят с гаком лет назад помешал работе компьютера, был отмечен в журнале как «first actual case of bug being found», и пошло-поехало. Насекомое получило своего рода цифровое бессмертие: теперь так называют любую ошибку, особенно в программе. </p>
<p>(Жаль только, что это было не какое-нибудь насекомое посимпатичнее — ну, не знаю, бабочка? Это прибавило бы нашей работе нотку романтики)</p>
<p>(Впрочем, если подумать... Может, «bug» и не такой плохой вариант. «Butterfly» — как-то длинновато. Кто-нибудь быстро сократил бы это до «butt», и чинили бы мы сейчас не баги, а жопы)</p>
            </div>
          </div>
          
        </article>


        
      </section>

      <section id="dynamicNotes" class="mt-10 hidden space-y-12"></section>

      <div
        id="empty"
        class="mt-8 hidden rounded-2xl border border-slate-200 bg-slate-50 p-8 text-center text-slate-700"
      >
        Ничего не нашлось. Попробуй другой запрос?
      </div>

      <!-- Static pagination (works without JS; hide during search) -->
      <nav id="pagination" class="mt-10 flex items-center justify-between">
        
        <a
          id="prevLink"
          href="https://kostyanetsky.ru/notes/page-2"
          class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 transition hover:bg-slate-50"
        >
          ← Раньше
        </a>
        
        <span class="w-[1px]"></span>
        
      </nav>



    </main>

<script>
  // ------------------------------------------------------------
  // Hybrid mode:
  // - Default: show static HTML notes (SEO-friendly, no-JS ok).
  // - On first user search: fetch notes.json, hide static, render results.
  // - On clear search: show static again.
  // ------------------------------------------------------------

  const metaEl = document.getElementById("pageMeta");
  const notesJsonUrl = "https://kostyanetsky.ru/notes.json";

  const page = Number(metaEl.getAttribute("data-page") || "1");
  const totalPages = Number(metaEl.getAttribute("data-total-pages") || "1");
  const totalNotes = Number(metaEl.getAttribute("data-total-notes") || "0");

  const searchEl = document.getElementById("search");
  const countEl = document.getElementById("count");
  const pageInfoEl = document.getElementById("pageInfo");

  const staticNotesEl = document.getElementById("staticNotes");
  const dynamicNotesEl = document.getElementById("dynamicNotes");
  const emptyEl = document.getElementById("empty");
  const paginationEl = document.getElementById("pagination");

  let notesCache = null;
  let notesLoadPromise = null;

  function debounce(fn, ms = 200) {
    let t;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), ms);
    };
  }

  async function loadNotesJsonOnce() {
    if (notesCache) return notesCache;

    if (!notesLoadPromise) {
      notesLoadPromise = fetch(notesJsonUrl, { credentials: "same-origin" })
        .then((r) => {
          if (!r.ok) throw new Error(`Failed to load ${notesJsonUrl}: ${r.status}`);
          return r.json();
        })
        .then((data) => {
          // Expecting: [{ html: "<article>...</article>", text: "plain text for search (usually already lowercased)" }]
          notesCache = Array.isArray(data) ? data : [];
          return notesCache;
        })
        .catch((err) => {
          console.error(err);
          notesCache = [];
          return notesCache;
        });
    }

    return notesLoadPromise;
  }

  function showStaticMode() {
    dynamicNotesEl.classList.add("hidden");
    dynamicNotesEl.innerHTML = "";
    emptyEl.classList.add("hidden");

    staticNotesEl.classList.remove("hidden");
    paginationEl.classList.remove("hidden");

    countEl.textContent = String(totalNotes);
    pageInfoEl.textContent = `Страница ${page} из ${totalPages}`;
  }

  function showSearchMode() {
    staticNotesEl.classList.add("hidden");
    paginationEl.classList.add("hidden");

    dynamicNotesEl.classList.remove("hidden");
  }

  function filterNotes(notes, q) {
    const needle = (q ?? "").trim().toLowerCase();
    if (!needle) return notes;

    return notes.filter((n) => {
      const hay = String(n?.text ?? "");
      return hay.includes(needle);
    });
  }

  async function runSearch() {
    const q = (searchEl.value || "").trim();

    if (!q) {
      showStaticMode();
      return;
    }

    showSearchMode();

    const notes = await loadNotesJsonOnce(); // [{html, text}, ...]
    const filtered = filterNotes(notes, q);

    countEl.textContent = String(filtered.length);
    pageInfoEl.textContent = "Поиск";

    if (filtered.length === 0) {
      dynamicNotesEl.innerHTML = "";
      emptyEl.classList.remove("hidden");
      return;
    }

    emptyEl.classList.add("hidden");
    dynamicNotesEl.innerHTML = filtered.map((n) => n.html || "").join("\n");
  }

  showStaticMode();

  // Search handler
  searchEl.addEventListener("input", debounce(runSearch, 200));

  // Search autorun in case search string is set (refresh / back-forward cache)
  function runSearchSoon() {
    requestAnimationFrame(() => requestAnimationFrame(() => runSearch()));
  }

  document.addEventListener("DOMContentLoaded", runSearchSoon);

  window.addEventListener("pageshow", runSearchSoon);
</script>


    <!-- Shared wrapper: footer -->
    <footer class="mt-12 border-t border-slate-200">
      <div class="mx-auto w-full max-w-4xl px-4 py-8 text-sm text-slate-600">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <p>Влад Костянецкий</p>
          <p>
            <a class="text-slate-900 underline decoration-slate-300 hover:decoration-slate-500" href="https://kostyanetsky.ru/rss.xml">RSS</a>
            <span class="mx-2 text-slate-300">·</span>
            <a class="text-slate-900 underline decoration-slate-300 hover:decoration-slate-500" href="https://github.com/vkostyanetsky">GitHub</a>
            <span class="mx-2 text-slate-300">·</span>
            <a class="text-slate-900 underline decoration-slate-300 hover:decoration-slate-500" href="https://t.me/tell_me_alisa">Telegram</a>            
          </p>
        </div>
      </div>
    </footer>

  </body>
</html>