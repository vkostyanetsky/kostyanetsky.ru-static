

<!doctype html>
<html lang="ru" class="text-[18px] leading-[1.65]">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Заметки</title>

    <meta name="description" content="" />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Сайт Влада" href="https://kostyanetsky.ru/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="https://kostyanetsky.ru/favicon.ico">
    <link rel="icon" href="https://kostyanetsky.ru/assets/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://kostyanetsky.ru/assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="https://kostyanetsky.ru/manifest.webmanifest">    

    <!-- Open Graph -->

    <meta property="og:title" content="Заметки"/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content="https://kostyanetsky.ru/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "https://kostyanetsky.ru/notes/page-9" />    

    <!-- CSS -->
     
    <link rel="stylesheet" href="/assets/css/tailwind.css">
    <link rel="stylesheet" href="/assets/css/site.css">

    <!-- Blog -->

    <script>
        let ctrlLeftUrl     = 'https://kostyanetsky.ru/notes/page-10';
        let ctrlRightUrl    = 'https://kostyanetsky.ru/notes/page-8';
    </script>
    
    <script src="https://kostyanetsky.ru/assets/js/hotkeys.js"></script>    

  </head>

  <body class="min-h-screen bg-white text-slate-900">

    <!-- header -->
    <header class="border-b border-slate-200">
        <div class="mx-auto w-full max-w-4xl px-4 py-5">
            <div class="flex flex-wrap items-baseline gap-x-5 gap-y-2">

                <!-- header: main menu -->
                <nav class="flex flex-wrap items-baseline gap-x-5 gap-y-2 text-sm">
                    
                    
                    
                    
                    

                    
                    
                    <a class="inline-block text-[1.25rem] leading-tight mr-4 border-b border-current no-underline transition-opacity hover:opacity-70 text-blue-600" href="https://kostyanetsky.ru/">Сайт Влада</a>
                    

                    
                    
                    <a class="inline-block text-[1.25rem] leading-tight mr-4 border-b border-current no-underline transition-opacity hover:opacity-70 text-blue-600" href="https://kostyanetsky.ru/projects/">Проекты</a>
                    

                    
                    
                    <a class="inline-block text-[1.25rem] leading-tight mr-4 border-b border-current no-underline transition-opacity hover:opacity-70 text-orange-600" href="https://kostyanetsky.ru/notes/">Заметки</a>
                    
                </nav>

                <!-- header: mirror link & edit link -->
                <div class="ml-auto flex items-center gap-4">
                    
                    
                        <span
                        class="inline-block text-[1.35rem] leading-none text-slate-400"
                        title="Видите опечатку? Поправьте меня!"
                        aria-disabled="true"
                        >✎</span>
                    
                    

                    
                    
                    <a
                        href="https://kostyanetsky.me/notes/page-9"
                        class="inline-block text-[1rem] leading-tight text-blue-600 border-b border-current no-underline transition-opacity hover:opacity-70"
                        title="EN"
                    >
                        EN
                    </a>
                    
                </div>
            </div>
        </div>
    </header>

    <!-- content -->
    <main
      class="mx-auto w-full max-w-4xl px-4 py-10"
      id="pageMeta"
      data-page="9"
      data-total-notes="20"
      data-total-pages="12"
    >
      <a id="top" class="block scroll-mt-24"></a>

      

    

      <header class="space-y-3">
        <h1 class="text-3xl font-semibold tracking-tight">Заметки</h1>
        <p class="max-w-2xl text-slate-700">
          Мои мысли о жизни, работе и разных интересных штуках вокруг меня.
        </p>
      </header>



      <section class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="relative w-full sm:w-[420px]">
          <input
            id="search"
            type="search"
            placeholder="Поиск по заголовку / тексту / тегам…"
            class="w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 pr-10 text-sm text-slate-900 placeholder:text-slate-400 outline-none transition focus:border-slate-400"
          />
          <svg
            class="pointer-events-none absolute right-3 top-1/2 h-5 w-5 -translate-y-1/2 text-slate-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m21 21-4.35-4.35m1.35-5.65a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"
            />
          </svg>
        </div>

        <p class="text-sm text-slate-600">
          Показано: <span id="count" class="font-semibold text-slate-900">0</span>
          <span class="text-slate-400">·</span>
          <span id="pageInfo">Страница</span>
        </p>
      </section>

      <section class="mt-4 flex flex-wrap gap-2">
      
        <button
          data-chip="all"
          class="chip rounded-full border border-slate-200 bg-slate-100 px-3 py-1.5 text-xs text-slate-900 hover:bg-slate-200"
        >
          Все
        </button>

        
        <button
          data-chip="1c"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          1С
        </button>
        
        <button
          data-chip="work"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Работа
        </button>
        
        <button
          data-chip="done"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Готово
        </button>
        
        <button
          data-chip="videogames"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Видеоигры
        </button>
        
        <button
          data-chip="meanwhile"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Тем временем
        </button>
        
        <button
          data-chip="english"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          English
        </button>
        
        <button
          data-chip="bash"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Bash
        </button>
        
        <button
          data-chip="code-smell"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Код с запашком
        </button>
        
        <button
          data-chip="family"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Семья
        </button>
        
        <button
          data-chip="mssql"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          MS SQL
        </button>
        
        <button
          data-chip="blog"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Блог
        </button>
        
        <button
          data-chip="workplace"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Рабочее место
        </button>
        
        <button
          data-chip="javascript"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Javascript
        </button>
        
        <button
          data-chip="obsidian"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Obsidian
        </button>
        
        <button
          data-chip="pgsql"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          PostgreSQL
        </button>
        
        <button
          data-chip="python"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Python
        </button>
        
        <button
          data-chip="webdev"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Вебдев
        </button>
        
        <button
          data-chip="ai"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          ИИ
        </button>
        
        <button
          data-chip="georgia"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Грузия
        </button>
        
        <button
          data-chip="optimization"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Оптимизация
        </button>
        
        <button
          data-chip="sport"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Спорт
        </button>
        
        <button
          data-chip="3d"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          3D
        </button>
        
        <button
          data-chip="bitrix"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Битрикс
        </button>
        
        <button
          data-chip="books"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Книги
        </button>
        
        <button
          data-chip="powershell"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Powershell
        </button>
        
        <button
          data-chip="typescript"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Typescript
        </button>
        
        <button
          data-chip="nodejs"
          class="chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50"
        >
          Node.js
        </button>
        

      </section>

      <!-- Static notes (SEO + no-JS fallback) -->
      <section id="staticNotes" class="mt-10 space-y-12">
        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/mssql-server-start-date"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Дата запуска сервера MS SQL
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>8 марта 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">MS SQL</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Для чего может пригодиться дата запуска MS SQL Server? Например, мы разбираем задержки в работе СУБД и хотим определить, в течении какого периода времени наполнялась DMV-шка <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql" target="_blank">sys.dm_os_wait_stats</a>. Её данные (как и любой другой DMV, впрочем) хранятся в оперативной памяти как раз с момента запуска СУБД.</p>
<p>Дату запуска сервера можно получить из  DMV-шки <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-dynamic-management-views/sys-dm-os-sys-info-transact-sql" target="_blank">sys.dm_os_sys_info</a>:</p>
<pre><code>SELECT sqlserver_start_time FROM sys.dm_os_sys_info
</code></pre>
<p>Есть и другой способ, связанный с tempdb. Эта база данных создаётся при запуске сервера, и дата её создания вполне может считаться датой запуска сервера. Значение можно вытащить из <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-catalog-views/sys-databases-transact-sql" target="_blank">sys.databases</a>:</p>
<pre><code>SELECT create_date FROM sys.databases WHERE name = 'tempdb'
</code></pre>
<p>Нюанс: дату запуска сервера как точку начала сбора данных DMV-шек нужно рассматривать с осторожностью. Накопленная статистика могла быть очищена вручную — например, вот так:</p>
<pre><code>DBCC SQLPERF('sys.dm_os_wait_stats', CLEAR)
</code></pre>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/mssql-server-waits"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Задержки сервера MS SQL
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>8 марта 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">MS SQL</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Каждый раз, когда SQL-запрос может запуститься, но ожидает другого ресурса — он записывает сведения о причине задержки. Доступ к ним можно получить через представление <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql" target="_blank">sys.dm_os_wait_stats</a>.</p>
<p>Для анализа представления можно использовать готовые скрипты:</p>
<ul>
<li><a href="https://kostyanetsky.ru/notes/mssql-server-waits/causes_of_wait_times.txt" target="_blank">Скрипт</a> из статьи Яна Стерка «Открытие скрытых данных для оптимизации производительности приложений», опубликованной в MSDN Magazine ещё в <a href="https://msdn.microsoft.com/ru-ru/magazine/ee310108.aspx" target="_blank">2008-м</a> году. Выводит список типов задержки, упорядоченный по времени — от самых частотных до наиболее редких.</li>
<li><a href="https://kostyanetsky.ru/notes/mssql-server-waits/sql_server_wait_statistics.txt" target="_blank">Cкрипт</a> из <a href="https://www.sqlskills.com/blogs/paul/wait-statistics-or-please-tell-me-where-it-hurts/" target="_blank">статьи</a> Пола Рэндала про анализ причин задержек в работе сервера MS SQL (на Хабре, кстати, есть <a href="https://habr.com/ru/post/216309/" target="_blank">перевод</a>). Фильтрует задержки, которые возникают на сервере всегда и которые обычно можно игнорировать. Кроме того, к каждой задержке добавляется ссылка на страницу, где эта задержка детально описана (например, вот <a href="https://www.sqlskills.com/help/waits/cxpacket" target="_blank">описание</a> CXPACKET).</li>
</ul>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/cursed-forest"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                The Cursed Forest
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>6 марта 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Видеоигры</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/uoCdg6SQRoA" width="560"></iframe>
<p>Ничего не ждал от игры, но она, внезапно, удалась. Выглядит бодро; чувствуется внимание к деталям, да и в сумме — совсем неплохо. А ближе к концу — ещё и трогательно.</p>
<p>Садитесь играть по всем правилам — гасите свет, надевайте наушники и, конечно, выключайте душнилу.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/duplicate-key"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Повторяющийся ключ
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>1 марта 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Готово</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Работа</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>На Инфостарте вышла любопытная <a href="https://infostart.ru/public/1010017/" target="_blank">статья</a> про ошибку СУБД «cannot insert duplicate key». Одна из возможных причин сбоя — использование уникального идентификатора объекта для сопоставления при обмене с другими информационными базами (то есть, без служебного регистра, сопоставляющего объекты базы данных с идентификаторами объектов внешней базы).</p>
<p>Такой жести, чтобы уникальные идентификаторы совпали в разных базах для одной и той же таблицы, у меня в практике пока не было. Однако от подхода «единого идентификатора» я отрекся окончательно после того, как делал обмен между <a href="https://firstbit.ae/products/erp-dubai/financial_management/" target="_blank">FirstBIT ERP</a> и <a href="http://superagent.ru/products/grotem_agent" target="_blank">GROTEM / Agent</a>.</p>
<p>Архитектура пилотного решения была такая: данные из FirstBIT ERP выгружались сперва в служебную ИБ 1С, написанную разработчиками GROTEM'а, а уже оттуда — в основную базу данных сервера мобильных приложений.</p>
<p>Сопоставление было сделано очень просто — через идентификаторы объектов. Например, один и тот же документ в обеих базах имел один и тот же идентфикатор. Но были и более сложные схемы: например, контрагент FirstBIT ERP на стороне GROTEM'а превращался в три объекта: собственно контрагента, торговую точку и документ взаиморасчетов.</p>
<p><img alt="WAIT WHAT" src="https://media.giphy.com/media/zkSFsZpQMZuG4/giphy.gif"/></p>
<p>Да, в документ взаиморасчетов. И все три объекта имели один и тот же идентфикатор — идентификатор контрагента FirstBIT ERP. В общем, не то чтобы это было очень изящным решением, но для платформы такой расклад вполне адекватен и мы решили, что проблем быть не должно.</p>
<p>Однако обмен работать отказался.</p>
<p>Беглый анализ показал, что данные успешно выгружаются в промежуточную базу данных и проходят все возможные проверки на целостность и полноту, а не работает только финальный шаг — выгрузка в базу данных сервера мобильных приложений.</p>
<p>В итоге выяснилось, что:</p>
<ol>
<li>В этой самой базе есть таблица, где хранятся все интересующие нас объекты. Документы, элементы справочников, вот это всё.</li>
<li>Эта таблица имеет уникальный индекс по GUID объекта.</li>
</ol>
<p>В этом месте интрига закончилась. Ну да, первый же выгруженный контрагент создавал целых три сущности с одним и тем же GUID, которые прекрасно лежали в своих таблицах на стороне 1С, но не могли быть записаны в одну общую таблицу базы данных приложения.</p>
<p><img alt="I will not use GUIDs to map objects!" src="https://kostyanetsky.ru/notes/duplicate-key/i-will-not-use-guids.gif"/></p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/loneliness"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Одиночество
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>1 марта 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Тем временем</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Видеоигры</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Хороший ролик про одиночество, его причины и последствия (спойлер: все серьёзно, вплоть до биологического уровня). Рассказывают на английском, но если нужно — там есть русские субтитры.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/n3Xv_g3g-mA" width="560"></iframe>
<p>(емкий <a href="https://twitter.com/StatusyOk/status/1098845710668185602" target="_blank">твит</a> о том же)</p>
<p>(а также я, походу, достаточно много наиграл в Starcraft II, чтобы название ролика у меня в голове произносилось исключительно голосом Зератула и под музыку из <a href="https://www.youtube.com/watch?v=xu94hnQDnRY" target="_blank">Alone</a>)</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/failed-hunt"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Неудачная охота
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>21 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Готово</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Работа</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>При обновлении платформы до 8.13.12.1790 наткнулись на плавающий баг при переключении текущей страницы элемента на сервере. Конкретно на сервере оно срабатывает, но как только управление возвращается на клиент — текущей страницей становится та, что была до изменения. При этом ещё и происходит событие изменения текущей страницы (как будто пользователь сменил её вручную).</p>
<p>Неприятно, но, в общем, ничего страшного — запатчили баг, описали и зарепортили в 1С. Там пока <a href="https://bugboard.v8.1c.ru/error/000050675.html" target="_blank">думают</a>. Но я, внезапно, даже как-то расстроен — когда расследуешь такие штуки, они всегда выглядят немного загадочно и кажется, что ты вот-вот найдешь что-то интересное! Например, новый аспект работы платформы или что-то вроде этого.</p>
<p>И вот, наконец, ты смотришь на проблему под правильным углом, а она — обычный жук. Возможно, полосатый или в крапинку, но жук как жук — сидит себе, шевелит усами. И ты такой: блин, это что — и есть моя добыча? :-)</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/big-value-tables"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Большие таблицы значений
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>17 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Пока писал про <a href="https://kostyanetsky.ru/notes/find-rows-at-client" target="_blank">поиск строк</a> на клиенте, вспомнил ещё один нюанс, связанный с данными на управляемых формах — тоже про передачу между клиентом и сервером.</p>
<p>Допустим, нам по условиям задачи нужно оперировать сравнительно большими (тысячи строк) таблицами значений. Это могут быть данные, которые в общем случае не нужно показывать пользователю: например, параметры расчета цен, информация о продажах и закупках, что-то ещё. Логично создать такие таблицы в виде атрибутов формы — хотя бы потому, что можно использовать удобный конструктор.</p>
<p>Но когда платформа решит передать такую таблицу на сервер, начнутся проблемы. Дело в том, что передавать она будет не простой и компактный объект ТаблицаЗначений, а весьма насыщенный ДанныеФормыКоллекция. Разница колоссальна — на одном из наших проектов траты на такой обмен данными составляли порядка 40% от всего времени работы ключевой операции.</p>
<p>Решение достаточно очевидно — не использовать атрибуты формы вообще. Вместо этого создавать таблицы значений с помощью кода (например, в обработчике ПриСозданииНаСервере), закидывать их во временное хранилище, а в атрибутах формы хранить только адреса хранилища. Таким образом при необходимости поработать с таблицей на сервер отправляется только строка с адресом, и расходы на сериализацию и обмен данными начинают стремиться к нулю. На сервере извлекаем таблицу, читаем данные, изменяем их, если нужно, и сохраняем обратно во временное хранилище — по тому же адресу.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/evolution"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Эволюция
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>16 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">English</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Работа</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Javascript</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Говоря о развитии чего-либо (продукта, языка общения, языка программирования и так далее), люди иногда называют это «эволюцией». Мол, процессы похожи — неудачные решения точно так же постепенно вымываются, а удачные — остаются и усиляют сущность, к которой принадлежат. Так-то оно так, но я сейчас вспомнил не про позитивную сторону — фигня в том, что в ходе эволюции потомки, кроме полезных ништяков, получают все хреново выстроенные и зачастую бессмысленные механизмы, которые не смогли прикончить предка.</p>
<p>В итоге мы задерживаем дыхание, когда глотаем, путаемся между dissatisfied и unsatisfactory, а ещё программируем на чудесном языке JavaScript — который, при всём своем удобстве и распостраненности, вобрал в себя все мыслимые и немыслимые недостатки скриптовых языков.</p>
<p>Но это нам ещё везёт — есть, например, жирафы! У этих ребят гортанный нерв сначала спускается по шее на два метра вниз, а потом — поднимается обратно к мышцам гортани (ага, вместо того, чтобы пройти несколько сантиметров от мозга напрямую).</p>
<p>Зная всё это, мне чуть-чуть проще смотреть на то, во что иногда превращается мой код на очередном цикле разработки. Ну и что, что у этого хомячка отрос драконий хвост? Эволюционно, например, такой хвост очень полезен. Кто я такой, чтобы спорить с Дарвином?</p>
<p><a href="https://twitter.com/bluecoders/status/966624401172123649" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/evolution/snap-tweet-bluecoders-966624401172123649.png"/></a></p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/find-rows-at-client"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Найти строки на клиенте
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>12 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Про то, что метод НайтиСтроки() для коллекций данных формы горазд под шумок наделать серверных вызовов, я узнал довольно давно, столкнувшись с неадекватно долгой прогрузкой формы (там он вызывался прямо в обработчике открытия, да ещё и в цикле). Так делать, конечно, не нужно, на что мягко намекает справка: calling the method executes a server call.</p>
<p>Однако сегодня писал код для задачи с похожей механикой и заметил, что серверных вызовов по факту нет. Удивился, полез на ИТС и, в общем, дело в следующем: при вызове НайтиСтроки() на клиенте поиск на нём и происходит, однако платформа не держит все данные больших коллекций на клиенте. Они передаются с сервера, и запрос этих данных с клиента — тот самый серверный вызов, на который ссылается справка.</p>
<p>Разработчики платформы расплывчато описывают объем коллекции, до которого клиенту не нужно обращаться к серверу (на ИТС <a href="https://its.1c.ru/db/v8std/content/628/hdoc/_top/" target="_blank">пишут</a>, что это порядка двадцати строк). Так что подход не меняется: делаем явный серверный вызов и не переживаем, что платформа налепит своих. Впрочем, всегда приятно лучше понимать, что внутри барабанчика :-)</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/i-wish-i-could"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Ай ду май бэст
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>12 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">English</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Видеоигры</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Что здорово облегчает работу над английским языком — так это практика, которая буквально сама лезет в руки. Причем порой она полезнее каких-нибудь примеров с условного Cambridge Dictionary — просто потому, что лучше запоминается.</p>
<p>Например, вчера проходили на занятиях гипотетические формулировки и запоминали, как правильно понимать wish и if only; сегодня первое, что попалось в ленте — вот этот твит. Куда уж доходчивее :-)</p>
<p><a href="https://twitter.com/roxiqt/status/1046952683477729282" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/i-wish-i-could/snap-tweet-roxiqt-1046952683477729282.png"/></a></p>
<p>Или, скажем, недавно освежали в памяти разницу между try и trying — а я её запомнил давным-давно по вымученному «I do my best» Фелисити из Borderlands: The Pre-Sequel. Ситуация там была довольно яркая, и этот оттенок невозможности выполнить задачу здорово въелся в память.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/what-are-our-girls-made-of"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Из чего сделаны наши девчонки?
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>9 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Семья</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Тем временем</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>На фоне скандальной рекламы «Reebok» (я в этой теме полный мимокрокодил, но взрывная волна даже до меня докатилась) на ютубе попался классный ролик их конкурентов. Ему уже пара лет, но он ровно про то же и, блин! Реклама здорового человека — не знаю, как лучше выразиться.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/xifSHMbGSKI" width="560"></iframe>
<p>Показал мелкой — смотрела глазами по пять копеек. Покажу ещё раз, когда опять будет батониться вместо тренировки :-)</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/drummer"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Внезапный барабанщик
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>9 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Я пишу на платформе 1С довольно давно и повидал некоторое дерьмо, но такое, честно говоря, вижу первый раз.</p>
<p><a href="https://kostyanetsky.ru/notes/drummer/bug.png" target="_blank"><img alt="Оттакота!" src="https://kostyanetsky.ru/notes/drummer/bug-thumbnail.png"/></a></p>
<p>Поначалу я даже не понял, с какого конца это жевать. Поискал перевод иероглифа — Википедия лишь сухо сообщила, что это такой <a href="https://en.wiktionary.org/wiki/%E4%80%80" target="_blank">тип чашки</a>, а Google Translate вообще <a href="https://translate.google.com/#view=home&amp;op=translate&amp;sl=auto&amp;tl=ru&amp;text=%E4%80%80" target="_blank">развёл руками</a>.</p>
<p>Коллега заметил, что символ отдаленно похож на складского сортировщика — мол, перекладывает что-то там себе между коробками. Не знаю, не знаю. По-моему, больше напоминает барабанщика за работой. Но что, черт побери, это значит? Может быть, 1С пытается что-то мне сказать? Что-то про музыку?</p>
<p>Может, мне нужно было стать басистом, а не вот это всё.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/temporary-tables-deletion"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Удаление временных таблиц
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>7 февраля 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Любопытная деталь: при закрытии менеджера временных таблиц не происходит удаления этих таблиц из tempdb. Актуально и для прямого вызова метода Закрыть() объекта менеджера, и для неявного варианта (когда объект менеджера уничтожается при завершении метода, в котором он был создан). На деле в обеих случаях выполняется только TRUNCATE, который удаляет данные таблицы; сама же таблица остаётся на случай, если пользователь снова выполнит запрос с таким же составом полей (это выгоднее, чем заново её создавать).</p>
<p>То же самое (удаление данных, но не самой таблицы) происходит при прямом вызове УНИЧТОЖИТЬ из текста запроса. К слову, эта команда вообще редко бывает осмыслена — разве что если объект менеджера живет сравнительно долго, а во временную таблицу помещён большой объем данных, от которого хочется побыстрее избавиться.</p>
<p>Что до удаления таблицы, то оно выполняется только при закрытии соединения с сервером приложений.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/string-concatenation"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Конкатенация строк
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>27 января 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Работа</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Как и многие другие компании, мы даем соискателям тестовое задание. Оно намеренно несложное и нужно больше для того, чтобы посмотреть — насколько кандидат понимает платформу? Как аккуратно работает с объектами конфигурации и её кодом?</p>
<p>Одна из множества мелких штук, которые там проверяются — это формирование длинного сообщения для пользователя, включающее множество параметров. Разработчик может делать это через СтрШаблон() или СтрСоединить(), а может — через простую конкатенацию (соединение) строк. Если кандидат использует последний вариант — это считается небольшим минусом: для пользователя результат будет тот же, но вот понять из кода, как он будет примерно выглядеть — заметно сложнее.</p>
<p>Однако тут есть другой аспект. В первой половине прошлого года «Рарус» опубликовал <a href="http://techlab.rarus.ru/upload/iblock/2/185/Beeline-obespechenie-bespereboynoy-raboti.pdf" target="_blank">отчет</a> о работах, проделанных для «Билайна». Там много любопытного, но среди прочего есть совершенно оглушительный пункт: за счет отказа от соединения строк разработчики добились 40% снижения нагрузки на процессоры! От двух дополнительных серверов после этих изменений вообще отказались, так как они стали не нужны.</p>
<p>Проблема возникала из-за того, чтобы рабочие процессы тратили слишком много времени на распределение памяти для склейки строк. В случае однократного соединения заметной нагрузки не возникает, однако когда мы, например, собираем большой запрос в цикле и делаем это многократно — нагрузка растет лавинообразно. Конкатенацию в таких случаях использовать нельзя, правильный вариант — все те же СтрШаблон() или СтрСоединить(). На старых версиях платформы, где этих методов нет, можно применять объект текстового документа — добавлять в него строки, а потом получать текст.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/incompiled-code"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Не скомпилированный код
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>27 января 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Не очевидная штука: абстрактная внешняя обработка работает заметно медленнее точно такой же, но встроенной в конфигурацию или её расширение. Причина — её код нужно заново компилировать для каждого пользователя при каждом запуске (тогда как код встроенных обработок компилируется один раз и для всех). Судя по <a href="https://kb.1c.ru/articleView.jsp?id=111" target="_blank">статье</a> в базе знаний 1С, для платформы 8.3.10 это было прямо катастрофа, но и пятидесятипроцентный рост нагрузки на процессор в 8.3.13 — тоже, в общем, ничего хорошего.</p>
<p>Другой подход с тем же эффектом — это хранение кода внутри базы (в реквизитах служебных справочников, например). Каждый раз, когда такой код нужно запустить, он извлекается из БД и компилируется. Например, у нас в <a href="https://firstbit.ae/products/erp-dubai/financial_management/" target="_blank">конфигурации</a> можно создавать регламентные задания без изменения метаданных — просто добавляем элемент специального справочника, загружаем в него код и настраиваем расписание работы.</p>
<p>Это относительно нормально — регламентные задания обычно выполняются не слишком часто и компиляция, скорее всего, не создаст сколько-либо заметной нагрузки на процессор. Однако этот же справочник может использоваться и для автоматического вызова какого-либо кода после произвольного события: например, после сохранения документа определенного типа. В таких случаях, если есть понимание, что код будет выполняться постоянно и множеством пользователей — стоит перенести логику в метод общего модуля из расширения, а в самом хранимом коде оставить только вызов этой логики.</p>
<p>А ещё можно вообще отказаться от хранения кода и сделать весь механизм в виде расширения. Возможно, решение будет менее гибким, но все же это лучше, чем потом медитировать над низким APDEX'ом.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/trip-to-kok-kol"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Поездка на Кок-Коль
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>6 января 2019</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Спорт</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Летом катался с друзьями на границу с Монголией (на машинах доехали до Ташанты, а оттуда — на велосипедах до <a href="http://rasulka.ru/ооо-расул---кок-коль.html" target="_blank">Кок-Коля</a>). Вымотались как проклятые, однако это того определенно стоило — виды с гор невероятно крутые! Одно жаль, животные попадались нечасто — даже чумных сусликов не встретили, хотя их нам каждый встречный анонсировал, включая погранцев :-)</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/4HbJAdYQ-xM" width="560"></iframe>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/ampersand-sign-in-1c"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Знак амперсанда в 1С
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>27 декабря 2018</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>При обработке символа амперсанда в тексте надписей платформа применяет стандартный подход Windows: то есть, сам амперсанд не отобразится, а следующий после него символ станет горячей клавишей для действия, закрепленного за надписью (например, обработчика команды или события элемента).</p>
<p>Пример ниже выведется как «Project Costing». Символ «P» в ней будет подчеркнут и станет горячей клавишей; если это, например, заголовок команды, то её можно будет вызвать, нажав Alt + P.</p>
<pre><code>ТекстНадписи = "&amp;Project Costing";
</code></pre>
<p>Единственное неудобство — если нужно вывести амперсанд прямо в надпись. В этом случае символ следует удвоить: так, пример ниже будет выглядеть как «Project P&amp;L». Никаких горячих клавиш в таком случае создано не будет.</p>
<pre><code>ТекстНадписи = "Project P&amp;&amp;L";
</code></pre>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/valve-in-a-china-shop"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Как Valve в посудной лавке
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>10 декабря 2018</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Видеоигры</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Ребята из Valve продолжают заигрывать с поклонниками своих игр — то ли по привычке, то ли там и правда кто-то считает, что это отличный способ напоминать о себе.</p>
<p>Конечно, с этой компанией как разработчиком игр всё в целом понятно. Мало кто всерьёз ждет третий Half-Life или, скажем, продолжение Portal. Но меня каждый раз умиляет это непринужденное изящество слона в посудной лавке, с которым Valve работает со своей аудиторией.</p>
<p><a href="https://twitter.com/retropcan/status/1072013105515913216" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/valve-in-a-china-shop/snap-tweet-retropcan-1072013105515913216.png"/></a></p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/snowboard-effect"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Эффект сноуборда
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>1 декабря 2018</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">Спорт</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p><a href="https://kostyanetsky.ru/notes/snowboard-effect/standing.jpg" target="_blank"><img alt="Стою!" src="https://kostyanetsky.ru/notes/snowboard-effect/standing-thumbnail.jpg"/></a> <a href="https://kostyanetsky.ru/notes/snowboard-effect/sitting.jpg" target="_blank"><img alt="Сижу!" src="https://kostyanetsky.ru/notes/snowboard-effect/sitting-thumbnail.jpg"/></a></p>
<p>Летишь такой вниз по склону, в который раз пытаясь почувствовать точку равновесия и не полететь кубарем, но чувствуешь только отбитую задницу, а из головы не идет знаменитый спич Васа из третьего Far Cry.</p>
<blockquote>
<p>Я уже говорил тебе, что такое безумие, а? Безумие — это точное повторение одного и того же действия. Раз за разом, в надежде на изменение. Это есть безумие.</p>
<p><em>― Ваас Монтенегро, Far Cry 3</em></p>
</blockquote>
<p>Но вниз все равно приезжаешь невероятно довольный.</p>
<p>Магия какая-то.</p>
            </div>
          </div>
          
        </article>


        
            

        <article class="rounded-2xl bg-white">

          <header class="space-y-2">

                        
            <header class="space-y-2">
            <a href="https://kostyanetsky.ru/notes/set-new-object-ref"
                class="inline text-2xl font-semibold tracking-tight hover:underline">
                Ссылка нового объекта
            </a>
            </header>
            

            <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600">
              <span>29 ноября 2018</span>
              
                <span class="text-slate-300">·</span>
                
                <div class="flex flex-wrap gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs text-slate-700">1С</span>
                </div>
                
              
            </div>

          </header>

          <div class="mt-5">
            <div class="prose-like">
              <p>Уникальный идентификатор — удобный критерий при сопоставлении объектов в разных конфигурациях. Например, когда нужно передавать инвойсы из одной базы в другую. Как второй базе понять, загружался полученный инвойс или нет? Первое, что приходит в голову — просто выполнить поиск объекта по его UUID:</p>
<pre><code>ИнвойсЗагружен = Документы.Инвойс.ПолучитьСсылку(UUID).Пустая();
</code></pre>
<p>Однако иногда уникальный идентификатор используют для связи объектов в одной конфигурации. Например, если условия задачи мешают добавить обычный ссылочный реквизит и мы не можем в документе А прямо сослаться на документ Б. Или, скажем, если мы создаем элемент справочника на основании документа и хотим иметь между ними прямую связь — присваивая элементу справочника ссылку, полученную по уникальному идентификатору документа. Платформа гарантирует уникальность идентификатора в пределах таблицы, так что такие трюки вполне безопасны.</p>
<p>Я это к чему. Метод УстановитьСсылкуНового() в коде нужно использовать с осторожностью! Проверяйте, что ссылка ещё не установлена до выполнения вашего кода:</p>
<pre><code>СсылкаЗадана = ПолучитьСсылкуНового().Пустая();
</code></pre>
<p>Если ссылка задана, то это надо как-то обработать — либо не заменять её вашей (если логика задачи позволяет), либо создать исключение. Иначе может возникнуть нарушение связности данных, которое будет непросто расследовать — да и вообще заметить.</p>
<p>Ну и, конечно, эта штука работает в обе стороны — я имею в виду, что установленную вами ссылку тоже может потереть какой-нибудь посторонний код (например, обработчик события объекта или подписка на него). Это надежно решается только тестированием.</p>
            </div>
          </div>
          
        </article>


        
      </section>

      <section id="dynamicNotes" class="mt-10 hidden space-y-12"></section>

      <div
        id="empty"
        class="mt-8 hidden rounded-2xl border border-slate-200 bg-slate-50 p-8 text-center text-slate-700"
      >
        Ничего не нашлось. Попробуйте другой запрос?
      </div>

      <!-- Static pagination (works without JS; hide during search) -->
      <nav id="pagination" class="mt-10 flex items-center justify-between">
        
        <a
          id="prevLink"
          href="https://kostyanetsky.ru/notes/page-10"
          class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 transition hover:bg-slate-50"
        >
          ← Раньше
        </a>
        
        <span class="w-[1px]"></span>
        
        <a
          id="nextLink"
          href="https://kostyanetsky.ru/notes/page-8"
          class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 transition hover:bg-slate-50"
        >
          Дальше →
        </a>
        
      </nav>

<script>
  // ------------------------------------------------------------
  // Hybrid mode:
  // - Default: show static HTML notes (SEO-friendly, no-JS ok).
  // - On first user search OR tag click: fetch notes.json, hide static, render results.
  // - On clear (no query AND tag=all): show static again.
  // ------------------------------------------------------------

  const metaEl = document.getElementById("pageMeta");
  const notesJsonUrl = "https://kostyanetsky.ru/notes.json";

  const page = Number(metaEl.getAttribute("data-page") || "1");
  const totalPages = Number(metaEl.getAttribute("data-total-pages") || "1");
  const totalNotes = Number(metaEl.getAttribute("data-total-notes") || "0");

  const searchEl = document.getElementById("search");
  const countEl = document.getElementById("count");
  const pageInfoEl = document.getElementById("pageInfo");

  const staticNotesEl = document.getElementById("staticNotes");
  const dynamicNotesEl = document.getElementById("dynamicNotes");
  const emptyEl = document.getElementById("empty");
  const paginationEl = document.getElementById("pagination");

  let notesCache = null;
  let notesLoadPromise = null;

  // Tag filter state (chip)
  let activeTag = "all";

  const TAG_SESSION_KEY = "notesActiveTag";

  try {
    const saved = sessionStorage.getItem(TAG_SESSION_KEY);
    if (saved) activeTag = saved;
  } catch (e) {
    // no sessionStorage :|
  }

  const CHIP_CLASS_DEFAULT =
    "chip rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50";
  const CHIP_CLASS_ACTIVE =
    "chip rounded-full border border-slate-200 bg-slate-100 px-3 py-1.5 text-xs text-slate-900 hover:bg-slate-200";

  function debounce(fn, ms = 200) {
    let t;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), ms);
    };
  }

  async function loadNotesJsonOnce() {
    if (notesCache) return notesCache;

    if (!notesLoadPromise) {
      notesLoadPromise = fetch(notesJsonUrl, { credentials: "same-origin" })
        .then((r) => {
          if (!r.ok) throw new Error(`Failed to load ${notesJsonUrl}: ${r.status}`);
          return r.json();
        })
        .then((data) => {
          // Expecting: [{ html: "<article>...</article>", text: "plain text", tags: ["work", ...] }, ...]
          notesCache = Array.isArray(data) ? data : [];
          return notesCache;
        })
        .catch((err) => {
          console.error(err);
          notesCache = [];
          return notesCache;
        });
    }

    return notesLoadPromise;
  }

  function showStaticMode() {
    dynamicNotesEl.classList.add("hidden");
    dynamicNotesEl.innerHTML = "";
    emptyEl.classList.add("hidden");

    staticNotesEl.classList.remove("hidden");
    paginationEl.classList.remove("hidden");

    countEl.textContent = String(totalNotes);
    pageInfoEl.textContent = `Страница ${page} из ${totalPages}`;
  }

  function showSearchMode() {
    staticNotesEl.classList.add("hidden");
    paginationEl.classList.add("hidden");

    dynamicNotesEl.classList.remove("hidden");
  }

  function normalizeTag(t) {
    return String(t || "")
      .trim()
      .toLowerCase();
  }

  function noteHasTag(note, tag) {
    if (!tag || tag === "all") return true;

    const want = normalizeTag(tag);

    const tags = note?.tags;
    
    return tags.map(normalizeTag).includes(want);
  }

  function filterNotes(notes, q, tag) {
    const needle = (q ?? "").trim().toLowerCase();
    const needText = needle.length > 0;
    const needTag = tag && tag !== "all";

    if (!needText && !needTag) return notes;

    return notes.filter((n) => {
      const matchesText = !needText ? true : String(n?.text ?? "").includes(needle);
      const matchesTag = !needTag ? true : noteHasTag(n, tag);
      return matchesText && matchesTag;
    });
  }

  function setActiveChipUI(tag) {
    document.querySelectorAll(".chip").forEach((x) => {
      x.className = CHIP_CLASS_DEFAULT;
      x.setAttribute("aria-pressed", "false");
    });

    const btn = Array.from(document.querySelectorAll(".chip")).find((b) => b.dataset.chip === tag);
    if (btn) {
      btn.className = CHIP_CLASS_ACTIVE;
      btn.setAttribute("aria-pressed", "true");
    }
  }

  function makeSearchLabel(q, tag) {
    const hasQ = (q || "").trim().length > 0;
    const hasTag = tag && tag !== "all";

    if (hasQ && hasTag) return `Поиск + #${normalizeTag(tag)}`;
    if (hasTag) return `Тег: #${normalizeTag(tag)}`;
    return "Поиск";
  }

  async function runSearch() {
    const q = (searchEl.value || "").trim();
    const hasQ = q.length > 0;
    const hasTag = activeTag && activeTag !== "all";

    if (!hasQ && !hasTag) {
      try { sessionStorage.removeItem(TAG_SESSION_KEY); } catch (e) {}
      showStaticMode();
      return;
    }

    showSearchMode();

    const notes = await loadNotesJsonOnce();
    const filtered = filterNotes(notes, q, activeTag);

    countEl.textContent = String(filtered.length);
    pageInfoEl.textContent = makeSearchLabel(q, activeTag);

    if (filtered.length === 0) {
      dynamicNotesEl.innerHTML = "";
      emptyEl.classList.remove("hidden");
      return;
    }

    emptyEl.classList.add("hidden");
    dynamicNotesEl.innerHTML = filtered.map((n) => n.html || "").join("\n");
  }

  // Initial render
  setActiveChipUI(activeTag);
  showStaticMode();

  // Text search handler
  searchEl.addEventListener("input", debounce(runSearch, 200));

  // Tag chips handler
  document.querySelectorAll(".chip").forEach((b) => {
    b.addEventListener("click", () => {
      activeTag = b.dataset.chip || "all";
        try {
        if (activeTag === "all") sessionStorage.removeItem(TAG_SESSION_KEY);
        else sessionStorage.setItem(TAG_SESSION_KEY, activeTag);
        } catch (e) {}      
      setActiveChipUI(activeTag);
      runSearch();
    });
  });

  // Search autorun in case search string is set (refresh / back-forward cache)
  function runSearchSoon() {
    requestAnimationFrame(() => requestAnimationFrame(() => runSearch()));
  }

  document.addEventListener("DOMContentLoaded", runSearchSoon);
  window.addEventListener("pageshow", runSearchSoon);
</script>



    </main>

    <!-- footer -->
    <footer class="mt-12 border-t border-slate-200">
      <div class="mx-auto w-full max-w-4xl px-4 py-8 text-sm text-slate-600">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <p>Влад Костянецкий</p>
          <p>
            <a class="text-slate-900 underline decoration-slate-300 hover:decoration-slate-500" href="https://kostyanetsky.ru/rss.xml">RSS</a>
            <span class="mx-2 text-slate-300">·</span>
            <a class="text-slate-900 underline decoration-slate-300 hover:decoration-slate-500" href="https://github.com/vkostyanetsky">GitHub</a>
            <span class="mx-2 text-slate-300">·</span>
            <a class="text-slate-900 underline decoration-slate-300 hover:decoration-slate-500" href="https://t.me/tell_me_alisa">Telegram</a>            
          </p>
        </div>
      </div>
    </footer>

  </body>
</html>