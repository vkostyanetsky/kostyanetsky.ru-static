

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>
        
            Заметки
        
    </title>

    <meta name="description" content="Мои заметки о жизни, работе и других интересных штуках вокруг меня." />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Сайт Влада" href="/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="/favicon.ico">    
        
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicons/96x96.png">

    <!-- Open Graph -->

    <meta property="og:title" content="Заметки"/>
    <meta property="og:description" content="Мои заметки о жизни, работе и других интересных штуках вокруг меня."/>
    <meta property="og:image" content="/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "/notes/page-2/" />    

    <!-- Google Fonts -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans&display=swap"> 

    <!-- Tachyons -->

    <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Likely -->
    
    <script src="/assets/likely/likely.js"></script>
    <link rel="stylesheet" href="/assets/likely/likely.css">    

    <!-- Twitter -->

    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>

    <!-- Blog -->

    <script>

        let ctrlUpUrl       = '/notes/';
        let ctrlDownUrl     = '/notes/page-3/';
        let ctrlLeftUrl     = '';
        let ctrlRightUrl    = '';

    </script>
    
    <link rel="stylesheet" href="/assets/blog.css">
    <script src="/assets/blog.js"></script>
                
</head>

<body class="w-100 bg-white">
<div id="app">        
<main>

<header class="db dt-l w-100-l border-box pa3 ph5-l">

    <nav class="flex items-center lh-copy pa3 ph0-l">
    
        <a href=""><img class="br-100" src="/assets/images/me.jpg" title="Привет!" /></a>

        <div class="pl4 flex-auto">
        
            
                <a class="dib f4 mr3 link dim bb blue" href="">Сайт Влада</a>
            

            
                <a class="dib f4 mr3 link dim bb orange" href="/notes/">Заметки</a>
            

        </div>
        
    </nav>

    
        <nav class="dtc-l v-mid tc tr-l"><a href="/notes/page-2/" class="link f5 f5-ns dim blue bb"></a></nav>
    

</header>

<section class="pa3 pa5-ns bt b--black-10 black-70 bg-white">
    

    <article>

        <h1 class="f-subheadline lh-solid">Заметки</h1>

        

            <p class="mt5 mb3 f6">
                <a class="link blue bb dim mr1 mt3 mb3" href="/notes/">Позднее</a> Ctrl + &uarr;
            </p>

        

        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/data-size-console/">Размер данных базы 1С</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">На прошлой неделе листал комментарии к 8.3.15 и наткнулся на метод ПолучитьРазмерДанныхБазыДанных(). Стало любопытно, как эта штука работает и насколько её данные расходятся с теми, которые можно получить из, например, Management Studio.</p>
<p class="measure-wide">В итоге накатал что-то вроде <a class="link blue dim bb" href="https://github.com/vkostyanetsky/DataSizeConsole">консоли</a>, через которую методу можно передавать разные метаданные, и принялся следить за запросами платформы к БД.</p>
<p class="measure-wide">В общем, размер данных платформа считает примерно таким выражением:</p>
<pre><code>CAST(
    SUM(
        CAST(
            DATALENGTH(T1._Fld40) AS NUMERIC(12, 0)
        )
    ) AS NUMERIC(18, 0)
)
</code></pre>
<p class="measure-wide">И так для каждого поля, которое есть у объекта, включая стандартные. Если есть табличные части — они тоже считаются. Результат суммируется.</p>
<p class="measure-wide">Выводы?</p>
<p class="measure-wide">Ну, во-первых, понятно, почему у метода такое дурацкое название. Он считает не размер таблиц, как я изначально подумал, а именно <strong>размер данных</strong> — то есть на оценку не влияют ни расходы на схему данных, ни расходы на индексы, ни механика экстентов. Учитывается только размер самих данных, которые хранятся непосредственно в объекте.</p>
<p class="measure-wide">Таким образом, реальный объём места, которое слопал условный справочник номенклатуры, будет больше того, которое покажет метод. Возможно, значительно. Для точной аналитики такой подход не годится, но чтобы быстро оценить распределение данных в БД – вполне подходит. </p>
<p class="measure-wide">Во-вторых, метод никак не считает расходы на историю данных для анализируемых объектов, что честно указано в документации. Теоретически их можно посчитать вручную, оттолкнувшись от _DataHistoryMetadata, но подождем релиз-другой — возможно, разработчики это добавят.</p>
<p class="measure-wide">В-третьих, СУБД в ходе расчетов выгребает все содержимое нужных таблиц, а потом считает размер того, что выгребла. То есть вызов, скорее всего, приведет к куче сканирований и может быстро вымыть буферный кэш. На 1cFresh запросы будут делаться с учетом разделителей, но это слабое утешение, как по мне.</p>
<p class="measure-wide">В общем, на работающем проде применять с осторожностью.</p>
        <p class="f6 mt4">
            11 июля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/done/">сделал</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/what-is-inside-the-drum/">Выгрузка стандартных обработок</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Недавно внедрили в нашу конфигурацию встроенный в платформу механизм истории данных вместо морально и функционально устаревшего велосипеда из SSLi. Сейчас как раз дописываю выгрузку историю данных в бэкап и загрузку его обратно: удивительно, но этого пока не умеет ни БСП, ни БТС, ни SSLi (впрочем, от последней я и не ждал).</p>
<p class="measure-wide">Как закончу, расскажу подробнее. Пока хочу отметить любопытную опцию, которая пригодилась по ходу дела: встроенные в платформу обработки, которые доступны из меню «Все функции», можно выгрузить в виде обычных epf-файлов! Трюк очень подробно разобрали коллеги на Инфостарте (<a class="link blue dim bb" href="https://infostart.ru/public/369487/">вот тут</a> и <a class="link blue dim bb" href="https://infostart.ru/public/538300/">вот тут</a>). Вкратце магия выглядит вот так:</p>
<pre><code>КопироватьФайл(
    "v8res://mngbase/StandardDataChangeHistory.epf",
    "Q:/StandardDataChangeHistory.epf"
);
</code></pre>
<p class="measure-wide">Полный список стандартных форм и обработок, которые можно вытащить, способ получения этого списка, а также куча споров вокруг и около — по ссылкам выше.</p>
<p class="measure-wide">Зачем это пригодится вам — честно, не знаю. Что касается нас, то мы делали интерфейсы для работы с историей данных и было любопытно, как они написаны у самой 1С (спойлер: довольно неряшливо).</p>
        <p class="f6 mt4">
            5 июля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/work/">работа</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/how-not-to-land/">Тонкое искусство приземления</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/bvim4rsNHkQ" width="560"></iframe>
<p class="measure-wide">На волне актуальных новостей наткнулся на трёхлетней давности ролик от SpaceX с подборкой неудачных приземлений на плавучую платформу. Как по мне — отличный пример того, как нужно относиться к своим ошибкам. С юмором!</p>
<blockquote>
<p class="measure-wide">Well, technically, it did land... Just not in one piece.</p>
</blockquote>
<p class="measure-wide">:D</p>
<p class="measure-wide">В комментариях не отстают:</p>
<blockquote>
<p class="measure-wide">Space X : Launches astronauts for the first time.</p>
<p class="measure-wide">Youtube: Let's recommend this video!</p>
</blockquote>
        <p class="f6 mt4">
            31 мая 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/meanwhile/">тем временем</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/fred/">Фред</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Игорь Сахаров перепел «Фреда» Короля и Шута на английском языке:</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/MsFQmXdC29g" width="560"></iframe>
<p class="measure-wide">Роцк! Ро-о-оцк! :-)</p>
<p class="measure-wide">Если серьёзно, я уже как-то <a class="link blue dim bb" href="/notes/i-wish-i-could/">писал</a> про это, но мне ни разу не лень повторить: такие штуки — один из самых простых и приятных способов запомнить кучу слов и оборотов.</p>
<p class="measure-wide">Да, вокруг хватает крутанов с цепкими мозгами, которым этот трюк не нужен; он, скорее, для обычных ребят вроде меня самого. У нас все эти what a good match you and I и spellbound by your beauty pure and true в других обстоятельствах порой улетучиваются из головы, ну... Секунд через десять?</p>
<p class="measure-wide">А так — смотришь ролик, невольно подпеваешь и не замечаешь, как текст намертво оседает в памяти.</p>
        <p class="f6 mt4">
            24 мая 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/english/">английский</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/perfectly-balanced/">Об идеальном балансе</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Хочу поделиться парой классных текстов о современном софте. Они не особенно свежие (первый-то уж точно), но наверняка ведь кто-то пропустил:</p>
<ul class="measure-wide">
<li><a class="link blue dim bb" href="https://tonsky.me/blog/disenchantment/ru/">Моё разочарование в софте</a> Никиты Тонского</li>
<li><a class="link blue dim bb" href="https://habr.com/ru/company/jugru/blog/493178/">В софте всё восхитительно, но все недовольны</a> Евгения Трифонова</li>
</ul>
<p class="measure-wide">? Если вы — тоже сотрудник «Первого БИТа», то <a class="link blue dim bb" href="https://newportal.1cbit.ru/news/3066979/">итоги</a> хакатона лежат на портале. Там же — <a class="link blue dim bb" href="https://newportal.1cbit.ru/news/3066980/">отзыв</a> другого победителя, Димы Лещенко (там всякие интересные подробности, почитайте).</p>
<p class="measure-wide">К чему я это вспомнил? На прошлой неделе участвовал в хакатоне среди программистов нашей компании. Узнал кучу клевых штук, а по итогам даже занял первое место (вместе с ещё двумя участниками, у которых получились очень похожие решения). </p>
<p class="measure-wide">В процессе нужно было развернуть и настроить целую гору софта: EDT, RabbitMQ, Docker, GitLab, JIRA, SonarQube и ещё вагон инструментов поменьше и попроще. Ладно, к RabbitMQ у меня претензий нет: легкий и быстрый, но вот остальное... Про хороший аппетит EDT я знал и раньше, а вот прожорливость GitLab и JIRA по-настоящему удивила.</p>
<p class="measure-wide">Да, в моём случае всё запускалось в докере; да, конфигурация не была оптимальной (например, было развернуто несколько серверов PostgreSQL вместо одного); да, докер был для Windows, а его реализация под эту платформу — тема для едких шуток у всех сисадминов, с которыми я знаком. Но потратить 12 гигабайт ОЗУ прямо со старта?! Про процессор вообще молчу — нагрузка была такая, будто компьютер просчитывал ядерный взрыв в реальном времени.</p>
<p class="measure-wide">Короче, лучшей иллюстрации к тезисам Никиты подобрать трудно: софт выше слопал море ресурсов и невозмутимо попросил ещё, даже не приступив к какой-то понятной для пользователя задаче. А впрочем... Может, это иллюстрация к тексту Евгения? Я, на секундочку, одной-единственной командой развернул несколько операционных систем со сложными серверами внутри. И потратил на это несоизмеримо меньше времени чем, скажем, пришлось бы потратить несколько лет назад.</p>
<p class="measure-wide">У меня нет ответа. Думаю, ни у кого нет. Это такой вечный холивар внутри головы программиста: какую сторону не займи, на деле все равно балансируешь между двумя крайностями. С одной стороны, надо писать хороший, быстрый код. С другой — хорошо бы не решать воображаемые проблемы, из-за которых софт точно-точно будет тормозить (проблем, к слову, пока нет) (и почти наверняка не будет).</p>
<p class="measure-wide">Одно в итоге дает чистое удовольствие от хорошо сделанной работы: вспоминаешь, что ты, черт побери, неплох! Другое — просто позволяет не нажить бед с башкой в поисках идеального алгоритма сортировки пузырьком :-)</p>
<p class="measure-wide">В общем,</p>
<p class="measure-wide"><img alt="Perfectly balanced... As all things should be." src="/notes/perfectly-balanced/perfectly-balanced.jpg"/></p>
<p class="measure-wide">(вдогонку: у Вастрика был <a class="link blue dim bb" href="https://vas3k.club/battle/1400/">баттл</a> на ту же тему; там куча аргументов «за» и «против», любопытно почитать)</p>
        <p class="f6 mt4">
            20 мая 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/work/">работа</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/value-table-view/">Просмотр таблицы значений</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Закинул на GitHub <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/ef44bbb18f36a1c51826a5d0b4f3960e">короткую функцию</a>, с помощью которой произвольную таблицу значений можно превратить в табличный документ.</p>
<p class="measure-wide">Для чего? Чтобы посмотреть её содержимое. Саму таблицу на клиент передать нельзя, а вот табличный документ на её основе — можно. Кроме того, у табличного документа есть клиентский метод Show(), который отображает его в отдельном окне.</p>
<p class="measure-wide">То есть можно прямо из режима предприятия просматривать разные служебные таблицы, не тратя время на создание интерфейса для них. Просто передаем их в функцию по ссылке выше, получаем табличные документы, возвращаем их на клиент и выводим.</p>
        <p class="f6 mt4">
            16 мая 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/done/">сделал</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/self-documenting-code/">Самодокументируемый код</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Всем привет! С вами снова Джонни Кэтсвилл и передача «Самодокументируемый код»!</p>
<p class="measure-wide">Сегодня мы переберем строки таблицы значений с Н по Й:</p>
<p class="measure-wide"><img alt=":|" src="/notes/self-documenting-code/self-documenting-code.png"/></p>
<p class="measure-wide">Вроде и мелочь совсем, но когда в пределах одного модуля в пятый раз натыкаешься на такой подход к именованию переменных — глаз невольно начинает дергаться :-)</p>
<p class="measure-wide">Дело даже не в том, что этот участок <a class="link blue dim bb" href="/notes/why-so-serious">труднее разобрать</a> — просто он неплохо говорит о качестве модуля в целом. Скорее всего, писавший его программист был вымотан, и поблизости можно встретить что-нибудь вроде отважной выгрузки справочника номенклатуры в таблицу значений, чтения кучи объектов «через точку» и прочего тяп-ляп.</p>
        <p class="f6 mt4">
            3 мая 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/code-smell/">код с запашком</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/manage-services-with-powershell/">Управление службами через PowerShell</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">На днях набросал себе несколько скриптов на PowerShell'е для запуска и остановки служб на рабочем ПК. Наработки в итоге не пригодились, так что зафиксирую себе пару примеров на будущее, чтобы не потерять:</p>
<pre><code>get-service -Name 1C:Enterprise* | Where-Object {$_.status -eq 'running'} | stop-service -pass
get-service -Name *SQL* | Where-Object {$_.status -eq 'running'} | stop-service -pass
</code></pre>
<p class="measure-wide">Обе строки выше делают одно и то же: ищут службы с определенным именем, проверяют их состояния и, если службы запущены — останавливают их. Имена служб удобно задавать через шаблоны — например, у Microsoft SQL Server целый выводок служб с разным назначением и их удобно пристрелить одной строкой. Или, скажем, служба сервера 1С:Предприятия — она одна, зато её длиннющее название просто лень писать полностью :-)</p>
<p class="measure-wide">Примерно тот же подход, кстати, работает и с обычными процессами. Так, строка ниже ищет процесс obs64; если находит — останавливает. </p>
<pre><code>get-process -Name obs64 | stop-process -pass
</code></pre>
<p class="measure-wide">Если нужны детали, то на сайте разработчика есть подробная <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/powershell/scripting/samples/managing-services?view=powershell-7">документация</a> с кучей примеров и рассуждений в духе «как запустить службу, если вы медитируете на одной ноге в условиях искусственной невесомости».</p>
        <p class="f6 mt4">
            28 апреля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/powershell/">PowerShell</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/workplace/">рабочее место</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/black-mesa/">Black Mesa</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/YkBrNGeFwoU" width="560"></iframe>
<p class="measure-wide">Легендарный, но уже откровенно постаревший Half-Life тщательно отретушировали и дополнили кучей новых задумок. Вышло здорово; прям видно, что фанаты старались :-) Особенно Зену пошло на пользу — разве что завод, по-моему, стоило сделать покороче. Впрочем, бой с Нихилантом переделали так, что он с лихвой окупает все страдания.</p>
<p class="measure-wide">Есть мелкие косяки с музыкой, оптимизацией и переводом, но ничего особо критичного. Учитывая, сколько шла разработка — удивительно, что вообще дошло до релиза сквозь типичные для долгих проектов проблемы вроде усталости и выгорания команды. И это не считая титанической работы по переделке проекта двадцатилетней давности на современные рельсы! Quite a nasty piece of work you managed over there, guys. I am impressed.</p>
<p class="measure-wide"><a href="/notes/black-mesa/swamp.jpg"><img alt="Болото" src="/notes/black-mesa/swamp-thumbnail.jpg"/></a> <a href="/notes/black-mesa/crystaline-cave.jpg"><img alt="Кристаллическая пещера" src="/notes/black-mesa/crystaline-cave-thumbnail.jpg"/></a> <a href="/notes/black-mesa/burning-sky.jpg"><img alt="Пылающее небо" src="/notes/black-mesa/burning-sky-thumbnail.jpg"/></a> <a href="/notes/black-mesa/flycatcher.jpg"><img alt="Мухоловка" src="/notes/black-mesa/flycatcher-thumbnail.jpg"/></a></p>
        <p class="f6 mt4">
            13 апреля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/is-ref-empty/">Пустая() или ЗначениеЗаполнено()?</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Несколько дней назад обсуждал с коллегой, какой способ проверки заполнения ссылки лучше. С одной стороны, несколько лет назад я слышал на каких-то курсах авторитетное мнение, что функцию ЗначениеЗаполнено() нужно использовать с осторожностью, так как её логика — сопоставлять переменную всем возможным пустым значениям, которые есть в конфигурации. И это, мол, огромная тормозная лапша. Как альтернативу авторы курса советовали использовать метод ссылки Пустая(), а композитные реквизиты предлагалось проверять примерно так:</p>
<pre><code>СсылкаЗаполнена = Ссылка &lt;&gt; Неопределено И Не Ссылка.Пустая();
</code></pre>
<p class="measure-wide">Коллега в свою очередь утверждал, что ЗначениеЗаполнено() быстрее, так как это встроенная функция, которая не тратит время на поиск метода у объекта (в скриптовых языках это сравнительно медленная операция).</p>
<p class="measure-wide">На моей памяти ни тот, ни другой метод узким местом никогда не были, но меня разобрало любопытство; написал <a class="link blue dim bb" href="https://github.com/vkostyanetsky/IsEmptyOrValueIsFilled">тест</a>, который проверяет ссылочную переменную на пустое значение обеими способами и замеряет время, которое было потрачено. </p>
<p class="measure-wide">В среднем результат выглядит <a class="link blue dim bb" href="/notes/is-ref-empty/is-ref-empty.png">примерно так</a>. Там четыре шага — на первых двух предполагается, что ссылка определена, а на третьем и четвертом добавляется соответствующая проверка. В последней колонке таблицы виден контекст выполнения теста (клиент или сервер).</p>
<p class="measure-wide">Вывод довольно очевиден: ЗначениеЗаполнено() никакой деградации не показывает, более того — работает быстрее, чем метод Пустая() (особенно если мы начинаем проверять переменную на Неопределено). Конечно, отклонение не слишком значительное, но на каких-то длительных регламентных операциях вполне можно сэкономить пару секунд.</p>
<p class="measure-wide">Да и чисто практически проще делать проверку одним универсальным вызовом, а не пытаться угадать все возможные значения переменной.</p>
        <p class="f6 mt4">
            11 апреля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/done/">сделал</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/sharex-video-recording/">Запись видео в ShareX</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Прежде чем приспособить OBS Studio для записи видео (писал о ней в <a class="link blue dim bb" href="/notes/video-recording">предыдущей</a> заметке), я пробовал использовать <a class="link blue dim bb" href="https://getsharex.com/">ShareX</a>. Программа поначалу неплохо справлялась, однако от неё пришлось отказаться из-за неприятного бага: иногда при попытке завершить запись софт портил полученное видео.</p>
<p class="measure-wide">Я гуглил, но причину понять так и не смог. Впрочем, неудивительно — ShareX использует <a class="link blue dim bb" href="https://www.ffmpeg.org/">ffmpeg</a> для записи видео, а это дитя опенсорца вместо адекватной диагностики невозмутимо вываливает целый рулон логов. Разбирать его без соответствующего опыта — занятие для клинического оптимиста.</p>
<p class="measure-wide">Впрочем, как инструмент для создания скриншотов ShareX почти безупречна. Обилие опций слегка напоминает замотанного человека в приступе гиперактивности :-)</p>
<p class="measure-wide"><a href="/notes/sharex-video-recording/interface.png"><img alt="Настраиваем скриншоты" src="/notes/sharex-video-recording/interface-thumb.png"/></a></p>
<blockquote>
<p class="measure-wide">— Протестирую сам! Сам все протестирую! И полы вымою!</p>
<p class="measure-wide"><em><a class="link blue dim bb" href="https://www.youtube.com/watch?v=K6oZuB8_dU8&amp;feature=youtu.be&amp;t=640">Эффективность не работает. Илья Якямсев</a></em></p>
</blockquote>
        <p class="f6 mt4">
            8 апреля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/workplace/">рабочее место</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/video-recording/">Запись видео</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Я работаю удалённо и с коллегами общаюсь через Zoom и Slack. В основном в чатах, но многие темы по-прежнему проще обсудить голосом. И вот тут-то возникают проблемы: приходится забыть про индексацию и поиск по сообщениям, а главное — нет никакого архива разговоров. Иногда очень нужно вспомнить: кто говорил? Что конкретно? Когда?</p>
<p class="measure-wide">Zoom и Slack сами по себе эту проблему не решают. Первый умеет записывать только те конференции, которые организуешь ты или которые тебе разрешили писать (короче, далеко не все), а второй писать видео не умеет вообще.</p>
<h2>Решение проблемы</h2>
<p class="measure-wide">Я закрыл вопрос какое-то время назад, поставив себе <a class="link blue dim bb" href="https://obsproject.com">OBS Studio</a> — популярный среди стримеров софт для записи экрана. С записью конференций он прекрасно справляется. Настройка минимальная: пишем весь экран, звук с микрофона и все звуки, которые воспроизводятся. В микшере по результатам тестовых записей можно натыкать фильтры — усиление, шумоподавление и так далее.</p>
<p class="measure-wide"><img alt="Настройка OBS Studio" src="/notes/video-recording/video-recording.png"/></p>
<p class="measure-wide">В настройках нужно указать папку, куда будут складываться записанные видео (Вывод → Запись → Путь записи). Поскольку мы пишем звонки и файлов будет много, лучше сразу разложить их в папки по дням — для этого идем в расширенные настройки и в поле «Формат имени файла» указываем нечто вроде %CCYY-%MM-%DD/%hh-%mm-%ss.</p>
<h2>Быстрое управление записью</h2>
<p class="measure-wide">Конечно, лезть в OBS при каждом звонке неудобно, но у неё есть куча хоткеев — можно прожимать какие-нибудь заковыристые комбинации в начале и в конце разговора. Однако со мной это не сработало — придуманные хоткеи почему-то постоянно вылетали из головы. Даже стикеры не помогали. </p>
<p class="measure-wide">Поначалу я здорово разозлился, но потом понял: раз не получается запомнить хоткей — надо его выкинуть. Начинать запись нажатием одной кнопки, заканчивать нажатием на другую.</p>
<p class="measure-wide">С оборудованием всё было просто: у меня эргономичная <a class="link blue dim bb" href="https://www.microsoft.com/accessories/ru-ru/products/keyboards/natural-ergonomic-keyboard-4000/b2m-00020">клавиатура</a> от Microsoft, программируемых кнопок на ней — вагон. Хуже с софтом: OBS Studio понимает некоторые <a class="link blue dim bb" href="https://github.com/obsproject/obs-studio/wiki/Launch-Parameters">параметры</a> запуска, но список откровенно бедноват — даже остановки записи нет. Хотелось бы побольше.</p>
<p class="measure-wide">В итоге решил задачу через плагин к OBS Studio, который дает порулить запущенным экземпляром программы. Он придуман для удаленного управления записью (например, со смартфона), но никто не мешает использовать его локально.</p>
<p class="measure-wide">Схема получилась такая:</p>
<ol class="measure-wide">
<li>Ставим OBS Studio и плагин <a class="link blue dim bb" href="https://obsproject.com/forum/resources/obs-websocket-remote-control-of-obs-studio-made-easy.466/">obs-websocket</a> к ней. Снимаем галку «Enable System Tray Alerts» в настройках (Tools → WebSockets Server Settings), не то программа примется сообщать о каждом чихе.</li>
<li>Кладем куда-нибудь <a class="link blue dim bb" href="https://obsproject.com/forum/resources/command-line-tool-for-obs-websocket-plugin-windows.615/">утилиту</a>, с помощью которой этим плагином можно рулить из командной строки. </li>
<li>Вешаем на одну кнопку OBSCommand.exe /startrecording, а на другую — OBSCommand.exe /stoprecording.</li>
<li>Готово, вы великолепны!</li>
</ol>
<p class="measure-wide">При вызове на долю секунду видно консоль (OBSCommand запускается, связывается с obs-websocket и ждет ответа). Сначала хотел как-нибудь скрыть это окно, но, поразмыслив, передумал — если OBS Studio не будет запущен или возникнет какая-то проблема, консоль не закроется и я хотя бы узнаю, что запись не началась.</p>
        <p class="f6 mt4">
            3 апреля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/workplace/">рабочее место</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/unresolved-references/">Неразрешимые ссылки</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Чаще всего неразрешимые ссылки на объекты метаданных образуются в ходе удаления объектов (и, иногда, при объединении конфигураций). На ИТС есть <a class="link blue dim bb" href="https://its.1c.ru/db/metod8dev#content:2290:hdoc">статья</a> по этой теме, там хорошо описаны детали.</p>
<p class="measure-wide">На работе программы битые ссылки сказываются далеко не всегда. Конечно, поле без привязки к данным заметить несложно, но вот удалили вы, допустим, функциональную опцию — что с того, что ссылка на неё осталась где-нибудь в команде на форме? Она будет просто лежать, как обрезанный провод, инертный и безвредный. Ничего по нему не идет. </p>
<p class="measure-wide">Однако такие штуки постепенно захламляют конфигурацию, и от них правильно избавляться, и на ИТС предложена не больно-то эффективная методика (последовательный перебор всех возможных мест, где может быть битая ссылка). Представьте себе сложную форму документа с множеством элементов; сколько времени придется потратить на поиск? Еще не факт, что успешный.</p>
<p class="measure-wide">Есть более грубый, но действенный метод: последовательно удалять с формы группы элементов. Можно начинать с больших групп (например, со страниц). После каждого удаления выполнять проверку конфигурации и смотреть — исчезла битая ссылка или нет. Перед началом работы лучше удалить из формы весь код, чтобы платформа не ругалась на обращения к несуществующим элементам.</p>
<p class="measure-wide">Проблема, кстати, может быть не в элементах, а в самой форме — но там её куда проще найти (хранилище настроек, условное оформление, команды; в общем, кандидатов немного).</p>
<p class="measure-wide">Ещё можно сделать выгрузку конфигурации в файлы и порыться в полученных XML-ках. Это неплохая идея ещё и потому, что сам по себе внешний вид элементов может вас обмануть: если, например, речь идет о ссылке на функциональную опцию в команды формы, то при проверке свойств команды вы даже не заметите, что есть какая-то проблема. А вот в XML-ке будет болтаться какой-то подозрительный GUID вместо наименования опции — считай, явка с повинной :-)</p>
        <p class="f6 mt4">
            10 марта 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/standard-attributes-filtering/">Фильтрация стандартных реквизитов</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Короткий <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/ee1f913868673c2218877dfbecc9b08a">фрагмент</a> кода из обработки для настройки механизма истории данных, о которой я только что <a class="link blue dim bb" href="/notes/data-history-settings">писал</a>. Эта функция определяет, является ли Attribute стандартным реквизитом с именем StandardAttributeName, принадлежащим объекту метаданных MetadataObject. Где она нужна? Допустим, вы перебираете стандартные реквизиты объекта и по какой-то причине хотите пропустить один из них.</p>
<p class="measure-wide">На первый взгляд решение выглядит максимально индусским. Почему бы, например, просто не сравнить два реквизита — проверяемый и тот, что хотим отсеять?</p>
<pre><code>If Attribute = MetadataObject.StandardAttributes.Order Then
</code></pre>
<p class="measure-wide">Дело в том, что такой код не сработает: результат операции сравнения двух стандартных реквизитов объекта метаданных в платформе 1С — всегда Ложь.</p>
<p class="measure-wide">О'кей, скажете вы — может, тогда не будем усложнять и напишем вот так?</p>
<pre><code>If Attribute.Name = "Order" Then
</code></pre>
<p class="measure-wide">Однако так тоже не сработает, если ваш код будет запущен в русскоязычной конфигурации: стандартный реквизит, который мы пытаемся найти, в этом случае будет называться «Порядок». </p>
<p class="measure-wide">Тем не менее, к самому стандартному реквизиту внутри коллекции можно обращаться и по-русски, и по-английски. Потом получаем текущее имя атрибута и сравниваем с именем того атрибута, который проверяем.</p>
<p class="measure-wide">Конечно, можно было просто сделать сравнение имени реквизита и с «Order», и с «Порядок» — но это, во-первых, некрасиво, а во-вторых — стандарты программирования у нас в компании запрещают писать код на русском. В общем, мне хотелось найти более общее решение.</p>
<p class="measure-wide">Что до конструкции Try/Catch — она тут на тот случай, если стандартного реквизита с таким именем в конфигурации нет вообще (и попытка обратиться к нему  по имени приведет к ошибке).</p>
        <p class="f6 mt4">
            9 марта 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/done/">сделал</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/data-history-settings/">Настройки истории данных</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Выложил на GitHub <a class="link blue dim bb" href="https://github.com/vkostyanetsky/AuditLogSettings">обработку</a> для настройки механизма истории данных, который сравнительно недавно <a class="link blue dim bb" href="https://its.1c.ru/db/v8312doc#bookmark:dev:TI000001938">появился</a> в платформе. Эта обработка:</p>
<ol class="measure-wide">
<li>Строит дерево объектов, для которых может вестись история данных;</li>
<li>Подсказывает, для каких объектов история данных ведется сейчас;</li>
<li>Дает возможность включить или выключить историю данных для объектов и их реквизитов. </li>
</ol>
<p class="measure-wide">Обработка поддерживает пакетные операции — например, можно включить историю разом для нескольких документов и всех справочников. Или вообще удалить все внесенные настройки, откатив состояние механизма к тому, которое заложил разработчик конфигурации.</p>
<p class="measure-wide">По-моему, неплохо получилось. Я писал эту штуку больше для себя, разминая мозг по вечерам — но мы, возможно, даже включим её в <a class="link blue dim bb" href="https://firstbit.ae">нашу конфигурацию</a>! Сейчас версионированием данных в ней занимается SSLi, и её механизмы трудно назвать эффективными — медленные и сильно раздувают базу. Надеюсь, платформа на тестах покажет себя лучше.</p>
<p class="measure-wide">На Инфостарте и ИТС можно найти похожие разработки, но они либо глючат, либо работают только на русскоязычных конфигурациях (не имеют английского интерфейса + опираются на БСП), либо просто-напросто устарели (например, не поддерживают работу с константами).</p>
        <p class="f6 mt4">
            9 марта 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/done/">сделал</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/work/">работа</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/ninth-wave/">Девятый вал</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Покупал вчера утром подарки своим женщинам. Пока флорист собирала букеты, болтал с ней ни о чем и случайно перехватил взгляд в сторону нарастающей толпы покупателей — спокойный такой, с отчетливо читающейся обреченностью. Так моряки, наверное, смотрят на вздымающуюся волну, которая вот-вот похоронит их шлюпку :-)</p>
<p class="measure-wide">Люди вне цветочной индустрии иногда хмыкают — мол, восьмое марта это такой волшебный праздник для цветочников, которые делают целое состояние за десять часов. Касса в эти дни и правда собирается приличная — только вот у любого, кто когда-либо работал в этой сфере, восьмое (и пара дней до него, кстати) чаще ассоциируется с чудовищной нагрузкой на силы, нервы и здоровье.</p>
<p class="measure-wide">Я, можно сказать, ещё дешево отделался: всего-то разворачивал и обслуживал айти в местной сети цветочных магазинов (кстати, <a class="link blue dim bb" href="http://rosetta.florist/">рекомендую</a> бывших коллег!). И все равно запах цветов ещё долго вызывал у меня вьетнамский синдром :-)</p>
        <p class="f6 mt4">
            9 марта 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/meanwhile/">тем временем</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/work/">работа</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/top-exceptions/">Топ исключений по ТЖ</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Выложил на GitHub <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/FrequentExceptions.sh">скрипт</a> на баше, который по собранному технологическому журналу 1С определяет наиболее частотные исключения.</p>
<p class="measure-wide">Скрипт анализирует события EXCP. Это основной источник информации об ошибках, хотя, конечно, не единственный: например, есть EXCPCNTX (событие, которое началось, но не закончилось в тот момент, когда произошла ошибка). Кроме того, если исключение происходит во время серверного вызова, то в поле RetExcp у события CALL будет текст ошибки, которая вернется на клиент.</p>
<p class="measure-wide">Впрочем, в большинстве случаев EXCP и, иногда, EXCPCNTX вполне достаточно. Часто их собирают просто по умолчанию — нагрузки это не создает, зато позволяет прогонять собранные логи через какой-нибудь инструмент аналитики (скрипт выше, например) и держать, так сказать, руку на пульсе.</p>
        <p class="f6 mt4">
            16 февраля 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/bash/">bash</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/done/">сделал</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/salt/">Соль</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Люблю моменты, когда опыт из какой-нибудь видеоигры слегка пересекается с абсолютно нерелевантной реальностью.</p>
<p class="measure-wide">Взять, например, <a class="link blue dim bb" href="https://store.steampowered.com/app/283640/Salt_and_Sanctuary/">Salt and Sanctuary</a>. Дело там происходит на острове посреди моря; соль здесь — ценный ресурс, вокруг которого крутится сюжет и геймплей. Её нужно искать, отнимать у врагов и тщательно хранить. </p>
<p class="measure-wide">В общем, игру я на днях прошёл. А вчера открываю <a class="link blue dim bb" href="https://ldwg.ru/">сайт</a> Быстроновского и понять не могу — чего я так залип на <a class="link blue dim bb" href="/notes/salt/ldwg.png">этой фразе</a>?</p>
<p class="measure-wide"><img alt="Знаете, я и сам в некотором роде собираю соль!" src="/notes/salt/scientist.png"/></p>
<p class="measure-wide">Действительно, было бы странно не залипнуть! Соли к этому моменту я собрал на пару товарных составов, никак не меньше.</p>
        <p class="f6 mt4">
            28 января 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/videogames/">видеоигры</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/debug-via-http/">Отладка через HTTP</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">В конце недели столкнулся с довольно глупой ситуацией: отладка через TCP/IP на сервере 1С перестала работать. То есть сам по себе режим отладки включен, однако конфигуратор «не видит» контекстов отладки на сервере.</p>
<p class="measure-wide">Ситуация глупая в том смысле, что понять причину довольно сложно: явных ошибок платформа не выдает. После проверки очевидных вариантов (фаервол, порты и так далее) остается только руками разводить. </p>
<p class="measure-wide">Решил проблему, переключившись на отладку через HTTP. Инфрастуктурно это более сложная <a class="link blue dim bb" href="https://its.1c.ru/db/v8310doc#bookmark:dev:TI000001599">схема</a>, но настраивается она довольно просто; если вкратце, то нужно:</p>
<ul class="measure-wide">
<li>Запустить службу агента сервера с ключами «-debug -http».</li>
<li>В параметрах отладки конфигуратором (Сервис → Параметры → Отладка) указать HTTP как протокол отладки и сервер отладки кластера как сервер отладки.</li>
</ul>
<p class="measure-wide">Подробнее процесс настройки <a class="link blue dim bb" href="https://its.1c.ru/db/v8310doc#bookmark:dev:TI000001604">описан</a> на ИТС.</p>
        <p class="f6 mt4">
            26 января 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="/notes/unsupported-code/">Неподдерживаемый код</a></h2>

            
    
    <div class="f4 lh-copy black mb5">
        <p class="measure-wide">Случайно наткнулся на <a class="link blue dim bb" href="https://helpf.pro/faq/view/1907.html">пример</a> запроса в 1С, который считает разницу между двумя датами (в годах, месяцах и днях).</p>
<p class="measure-wide">Код, возможно, действительно работает (я не проверял), но как по мне — это хороший пример того, как делать не надо. Проблема в том, что автор забудет смысл большинства если-тогда-иначе через пару месяцев, не говоря уже о посторонних разработчиках, которые решат использовать этот код на своих проектах. В итоге при первой же доработке, которую потребуется провернуть на этом участке, куда дешевле будет заменить решение на что-то более наглядное, а не доработать.</p>
<p class="measure-wide">И это еще далеко не самый наглядный пример. Взять хотя бы <a class="link blue dim bb" href="http://www.google.ru/search?q=email+regex">регулярки для проверки e-mail</a>. Хочется выйти подышать, да? :-)</p>
        <p class="f6 mt4">
            18 января 2020
            
                <span class="pl2">
                    <a class="link blue bb dim" href="/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

        

            <p class="mt5 mb3 f6">
                <a class="link blue bb dim mr1 mt5 mb3" href="/notes/page-3/">Ранее</a> Ctrl + &darr;
            </p>

        

    </article>


</section>

</main>

<footer class="ph3 ph4-ns pv4 bt b--black-10 black">
    
    <p class="f6 lh-solid">Эл. почта: <a href="mailto:vlad@kostyanetsky.ru" class="link dim bb black">vlad@kostyanetsky.ru</a></p>
    <p class="f6 lh-solid">Телеграм: <a href="tg://resolve?domain=vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    <p class="f6 lh-solid">Гитхаб: <a href="https://github.com/vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    
    <a class="rss" href="/rss.xml">РСС</a> 
           
</footer>

</div>
</body>
</html>