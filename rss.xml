<rss version="2.0">
    <channel>    
        <title>Влад Костянецкий</title>
        <description>Привет! Меня зовут Влад, я — разработчик приложений для бизнеса.</description>
        <language>ru</language>
        <link>https://kostyanetsky.ru</link>
        <lastBuildDate>Sun, 25 Sep 2022 19:02:53 +0700</lastBuildDate>
        
        <item>
            <title>Слак советует</title>
            <link>https://kostyanetsky.ru/notes/slack/</link>
            <guid isPermaLink="false">note-slack</guid>
            <pubDate>Sun, 25 Sep 2022 19:02:53 +0700</pubDate>
            <description><p class="measure-wide">Слак, конечно, есть за что ругать. За тормоза, за баги, за <a class="link blue dim bb" href="https://t.me/nikitonsky_pub/262" target="_blank">оповещения</a>. Но я просто обожаю его заглушки на случай, если новых сообщений нет.</p>
<p class="measure-wide">Посмотрите, какая милота:</p>
<p class="measure-wide"><img alt="All done. The future is yours." src="https://kostyanetsky.ru/notes/slack/all-done.png"/></p>
<p class="measure-wide">Зачем вообще нужны психотерапевты?</p>
<p class="measure-wide"><img alt="You're up to date. Go forth and do great things." src="https://kostyanetsky.ru/notes/slack/up-to-date.png"/></p>
<p class="measure-wide">Или вот:</p>
<p class="measure-wide"><img alt="You're all read. Here is a tractor." src="https://kostyanetsky.ru/notes/slack/here-is-tractor.png"/></p>
<p class="measure-wide">Боже, слак, хоть ты не начинай.</p></description>
        </item>
        
        <item>
            <title>Взболтать, но не смешивать</title>
            <link>https://kostyanetsky.ru/notes/shaken-not-stirred/</link>
            <guid isPermaLink="false">note-shaken-not-stirred</guid>
            <pubDate>Sun, 07 Aug 2022 19:04:51 +0700</pubDate>
            <description><p class="measure-wide">Затрем немного про организацию кода. Если вам нужно где-то описать множество объектов с общими свойствами — подумайте, не стоит ли подробить описание на отдельные методы, каждый из которых будет описывать один конкретный объект?</p>
<p class="measure-wide">Посмотрим на пример — метод, который описывает табличные части документов, пригодные для какой-то задачи. Что-то вроде:</p>
<pre><code>SupportedTypes["Document.SupplierPricesEntering"]   = "Prices";
SupportedTypes["Document.OpeningBalancesEntering"]  = "CustomerAccounts,VendorAccounts";
SupportedTypes["Document.Requisition"]              = "InventoryAndServices";
</code></pre>
<p class="measure-wide">Вроде всё в порядке, так? Описания есть, табличные части перечислены, посплитить их по запятой — считай, бесплатно.</p>
<p class="measure-wide">Однако документов в методе описано много. Рано или поздно какому-нибудь коллеге (или вам самим) понадобится добавить ещё одну табличную часть для документа, который уже описан в методе. Его что-то отвлечет, он забудет поискать существующую строку и получится что-то вроде:</p>
<pre><code>SupportedTypes["Document.SupplierPricesEntering"]   = "Prices";
SupportedTypes["Document.OpeningBalancesEntering"]  = "CustomerAccounts,VendorAccounts";
SupportedTypes["Document.Requisition"]              = "InventoryAndServices";

&lt;...&gt;

SupportedTypes["Document.OpeningBalancesEntering"]  = "PayrollDeductions";
</code></pre>
<p class="measure-wide">В результате пара табличных частей выпадет из описания, и хорошо, если связанный функционал покрыт тестами.</p>
<p class="measure-wide">Вывод? Ну, можно написать метод-хелпер, который будет принимать на вход тип документа и имя <strong>одной</strong> табличной части. Хелпер будет заполнять соответствие SupportedTypes и следить за тем, чтобы уже добавленные в него данные не были потеряны.</p>
<p class="measure-wide">А если совсем по фен-шую, лучше поступить так, как я написал в начале заметки: разделить метод на отдельные вспомогательные методы, каждый из которых будет описывать только табличные части по одному документу. Что-то вроде:</p>
<pre><code>Procedure AddOpeningBalancesEnteringDocument(SupportedTypes)

    TabularSections = New Array;

    TabularSections.Add("CustomerAccounts");
    TabularSections.Add("VendorAccounts");
    TabularSections.Add("PayrollDeductions");

    SupportedTypes["Document.Requisition"] = StrConcat(TabularSections, ",");

EndProcedure
</code></pre>
<p class="measure-wide">Так и описание документа никто случайно не сотрет, и Сонар будет доволен. А вот случае реализации хелпера он, скорее всего, примется ругаться на повторяющиеся литералы с именами табличных частей.</p></description>
        </item>
        
        <item>
            <title>Не так, а этак!</title>
            <link>https://kostyanetsky.ru/notes/not-but/</link>
            <guid isPermaLink="false">note-not-but</guid>
            <pubDate>Sat, 23 Jul 2022 11:32:48 +0700</pubDate>
            <description><p class="measure-wide">Про хорватский комикс <a class="link blue dim bb" href="http://www.to-zo.com/notbut" target="_blank">NOT/BUT</a> мне кто-то рассказал в начале прошлого года, когда я всерьёз учился рисовать. Каждый стрип там — про какую-то травмирующую или просто мрачную мысль, которая приходит в голову художника во время работы. Идея в том, чтобы подтолкнуть читателя в правильном направлении и дать ему посмотреть на ситуацию, в которую он попал, с более практичной стороны.</p>
<p class="measure-wide">Рисовать я бросил через год, в конце февраля: стало понятно, что времени на хобби у меня больше нет. Но комикс — совершенно универсальный; полистайте, даже если понятия не имеете, что такое клячка :-)</p>
<p class="measure-wide"><a href="http://www.to-zo.com/notbut" target="_blank"><img alt="Да что за херня?" src="https://kostyanetsky.ru/notes/not-but/mistakes.png"/></a></p>
<p class="measure-wide">Все эти бесконечные самокопания хорошо знакомы любому профессионалу, а выход из них — не всегда очевиден. Особенно если ты зол, устал, а дедлайн по проекту истёк где-то на прошлой неделе.</p></description>
        </item>
        
        <item>
            <title>Окей!</title>
            <link>https://kostyanetsky.ru/notes/ok/</link>
            <guid isPermaLink="false">note-ok</guid>
            <pubDate>Fri, 22 Jul 2022 13:13:00 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/GuIPxcXwF30" width="560"></iframe>
<p class="measure-wide">Блин. Посмотрел видео и понял, что я как раз давным-давно просто пишу OK в утренних дейликах в ответ на вопрос «how do you feel today». Мол, со мной всё в норме, жив-здоров, на работу ничто не влияет.</p>
<p class="measure-wide">Что обо мне думали коллеги — боюсь предположить. Надеюсь, они тоже не знали про то, что okay в ответе на такой вопрос нифига не значит okay. :-)</p></description>
        </item>
        
        <item>
            <title>Баночка с печеньем</title>
            <link>https://kostyanetsky.ru/notes/cookie-jar/</link>
            <guid isPermaLink="false">note-cookie-jar</guid>
            <pubDate>Sat, 28 May 2022 21:34:38 +0700</pubDate>
            <description><p class="measure-wide">На днях прикручивал работу с куками к одному из своих скриптов. Пока искал оптимальное решение, наткнулся на совершенно очаровательный (при этом, кстати, 100% рабочий) <a class="link blue dim bb" href="https://stackoverflow.com/questions/13030095/how-to-save-requests-python-cookies-to-a-file" target="_blank">совет</a> со StackOverflow:</p>
<blockquote>
<p class="measure-wide">You can get a CookieJar object from the session with session.cookies, and use pickle to store it to a file.</p>
</blockquote>
<p class="measure-wide">Ну то есть, буквально: держите ваше печенье в банке, а чтобы хранить его — маринуйте. Банку с маринованным печеньем, кстати, потом можно поставить на <a class="link blue dim bb" href="https://docs.python.org/3/library/shelve.html" target="_blank">полку</a>.</p>
<p class="measure-wide">Вот как после этого не любить пайтон, а?</p>
<p class="measure-wide">P.S. Пока писал заметку, разобрало любопытство — почему всё-таки pickle, а нe serialization? Так вот, если вкратце: <a class="link blue dim bb" href="https://stackoverflow.com/questions/27324986/pickles-why-are-they-called-that/27325007#27325007" target="_blank">таков путь</a>.</p></description>
        </item>
        
        <item>
            <title>Минус встроенные твиты</title>
            <link>https://kostyanetsky.ru/notes/no-more-embedded-tweets/</link>
            <guid isPermaLink="false">note-no-more-embedded-tweets</guid>
            <pubDate>Mon, 21 Mar 2022 20:25:48 +0700</pubDate>
            <description><p class="measure-wide">Не успел я <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/no-more-google-fonts/" target="_blank">выпилить</a> из блога Google Fonts, как пришлось отправить вдогонку встроенные твиты.</p>
<p class="measure-wide">Как это работало раньше? Хотел сослаться на твит — просто вставлял на него ссылку. Скрипт сборки заменял её на HTML-блок, который находил скрипт Твиттера и заменял на текст твита (и всякими полезными ссылками). Вот в этом <a class="link blue dim bb" href="https://github.com/vkostyanetsky/BlogBuilder/commit/c21ef8a7bec10672406e6be57b8e734ba3ac01c5" target="_blank">коммите</a> в целом видно, как это работало.</p>
<p class="measure-wide">Как это работает теперь? Ну да, никак. Твиттер в России заблокирован, так что его скрипты работают только со включенным VPN.</p>
<p class="measure-wide"><img alt="Штош" src="https://kostyanetsky.ru/notes/no-more-embedded-tweets/well.jpg"/></p>
<p class="measure-wide">Пришлось поскринить все твиты, на которые я когда-то ссылался, и добавить их в заметки в виде картинок со ссылками. Кому нужен оригинал, тот включит VPN и перейдёт в Твиттер, а остальные, по крайней мере, могут прочитать текст.</p>
<p class="measure-wide">Пара слов про техническую сторону. Скринить каждый твит вручную мне было лень, поэтому я полез в сеть, обдумывая, как автоматизировать процесс. Сначала попадались только сервисы, готовые решить проблему за какие-то жалкие десять долларов (спасибо, как-нибудь в следующий раз), но потом я набрёл на идеальный <a class="link blue dim bb" href="https://github.com/privatenumber/snap-tweet" target="_blank">инструмент</a>: консольный скрипт для Node.js.</p>
<p class="measure-wide">Ничего лишнего. Чистый функционал. Ты ему — твит. Он тебе — картинку:</p>
<blockquote>
<p class="measure-wide">npx snap-tweet https://twitter.com/PossumEveryHour/status/1506148678461014016</p>
</blockquote>
<p class="measure-wide">И всё. Захотелось занести автору денег.</p>
<p class="measure-wide">Подумал, не прикрутить ли snap-tweet к скрипту сборки (чтобы было, как раньше: вставляешь ссылку на твит, а дальше оно само генерит картинку и кладёт куда надо). Решил, нафиг. Грубое попирание KISS, да и вообще... В мире и так хватает энтропии. Особенно, блин, сейчас.</p></description>
        </item>
        
        <item>
            <title>Смотри не перепутай</title>
            <link>https://kostyanetsky.ru/notes/do-not-confuse/</link>
            <guid isPermaLink="false">note-do-not-confuse</guid>
            <pubDate>Wed, 16 Mar 2022 20:09:31 +0700</pubDate>
            <description><p class="measure-wide"><img alt="Код" src="https://kostyanetsky.ru/notes/do-not-confuse/do-not-confuse.png"/></p>
<p class="measure-wide">Если вид операции — продажа товара или недвижимости, то открой общую форму AdvancesPickFormWithVAT с параметрами, описанными в структуре PickParameters. Колбеком будет метод EditPrepaymentOffsetEnd, описанный в этом же модуле; передай ему структуру AdditionalParameters. Форму нужно открыть так, чтобы она заблокировала весь интерфейс.</p>
<p class="measure-wide">А вот если вид операции — возврат поставщику, то открой общую форму AdvancesPickFormWithVAT с параметрами, описанными в структуре PickParameters. Колбеком будет метод EditPrepaymentOffsetEnd, описанный в этом же модуле; передай ему структуру AdditionalParameters. Форму нужно открыть так, чтобы она заблокировала весь интерфейс.</p>
<p class="measure-wide">Смотри не перепутай.</p></description>
        </item>
        
        <item>
            <title>Минус Google Fonts</title>
            <link>https://kostyanetsky.ru/notes/no-more-google-fonts/</link>
            <guid isPermaLink="false">note-no-more-google-fonts</guid>
            <pubDate>Sat, 19 Feb 2022 20:25:48 +0700</pubDate>
            <description><p class="measure-wide"><a href="https://twitter.com/PixelAmbacht/status/1494272370076536840" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/no-more-google-fonts/snap-tweet-PixelAmbacht-1494272370076536840.png"/></a></p>
<p class="measure-wide">Год назад, блин. Ладно, всем привет! С вами Джонни Слоупок! Сегодня мы будем выпиливать из моего блога работу с Google Fonts. Я подгружал с него основной шрифт (PT Sans), но без кросс-доменного кэширования единственный смысл делать это дальше — если сервер, на котором работает сайт, слабоват и с гугла шрифты грузятся шустрее. </p>
<p class="measure-wide">В моем случае блог отдают сервера гитхаба, которые на производительность не жалуются, так что теперь PT Sans загружается прямо с них. И знаете что? Разница прямо драматическая. Если раньше при обновлении страницы была явно заметна задержка между загрузкой страницы и загрузкой шрифта, то теперь её невооруженным глазом не разобрать. Если у вас свой блог и хотите попробовать — вот тут есть классный <a class="link blue dim bb" href="https://google-webfonts-helper.herokuapp.com/fonts" target="_blank">сервис</a>, который решает задачу в несколько кликов.</p>
<p class="measure-wide">Не забудьте повесить звезду на <a class="link blue dim bb" href="https://github.com/majodev/google-webfonts-helper" target="_blank">репозиторий</a>!</p></description>
        </item>
        
        <item>
            <title>Итоги 2021-го</title>
            <link>https://kostyanetsky.ru/notes/totals-of-2021/</link>
            <guid isPermaLink="false">note-totals-of-2021</guid>
            <pubDate>Tue, 08 Feb 2022 13:25:00 +0700</pubDate>
            <description><p class="measure-wide">Поздновато я сел итоги подводить, да? Ну, предыдущие пара месяцев вышли, гм, плотными и у меня банально руки не доходили сесть и подумать. А сейчас я как раз в отпуске за 2021-й год — так что самое время. Пишу, типа, из прошлого.</p>
<p class="measure-wide">Выписывать каждую ачивку меня совершенно не тянет. Год точно вышел неплохим: я проделал уйму сложной работы над FirstBit ERP (писал новые модули, перепиливал существующие, давил баги, писал функциональные и нагрузочные тесты — да много чего было). Это хорошо сказалось и на самой конфе, и на делах компании. Кроме того, между делом я защитился на эксперта по 1С и на профессионала по PostgreSQL, гип-гип-ура.</p>
<p class="measure-wide">Были и фейлы, ну. Перечислять, опять же, лень, но главный провал — я чудовищно разжирел и вместо того, чтобы сбросить килограм десять (таков был изначальный план) — набрал ещё пяток.</p>
<p class="measure-wide">Оглядываясь назад, корень большинства проблем за прошлый год вижу так: я слишком сильно фокусировался на потоке задач. Они все были по-своему интересные, от тщательно проработанного ТЗ до челленджей в духе «найди в коде проблему, используя ведьмачье чутьё». Делаешь одну задачу, другую, третью, сотую и сам не замечаешь, что забил почти на всё, кроме работы. В итоге получаешь кучу опыта, но мир усыхает до окна с конфигуратором и сил как-то применять этот опыт нет. Нездоровая фигня.</p>
<p class="measure-wide">Короче, если представить меня как персонажа какой-нибудь видеоигры, выглядит так: атака и интеллект за год заметно выросли, но здоровье, подвижность, харизма и вообще почти всё остальное — поползло вниз. Теперь надо с этим всем что-то делать.</p>
<p class="measure-wide">Пойду для начала пробегусь километров десять, вот что!</p>
<p class="measure-wide"><a href="https://twitter.com/EffinBirds/status/1329575199667347459" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/totals-of-2021/snap-tweet-EffinBirds-1329575199667347459.png"/></a></p>
<p class="measure-wide">Возможно, птичка, возможно.</p></description>
        </item>
        
        <item>
            <title>Переиспользуйте с осторожностью</title>
            <link>https://kostyanetsky.ru/notes/reuse-carefully/</link>
            <guid isPermaLink="false">note-reuse-carefully</guid>
            <pubDate>Tue, 08 Feb 2022 09:00:11 +0700</pubDate>
            <description><p class="measure-wide">Расскажу про смешной и немного стыдный кейс, который разбирал в январе. Суть в двух словах: где-то ближе к концу падает огромный автотест на Ванессе, проверяющий расчёт НДС.</p>
<p class="measure-wide">Начинаю расследовать. Первым делом смотрю на скрины в Аллюре: о'кей, причина очевидна — в одном из документов сдохло условное оформление для поля с суммой НДС. Тест ожидал, что оно будет недоступно, если ставка НДС равна нулю, а оно оказалось доступным.</p>
<p class="measure-wide">Непорядок, надо чинить. Смотрю на условие оформления в коде: ну, поле блокируется, если ссылка на ставку НДС есть в списке «нулевых» ставок (т.е. ставка в которых равна нулю). Всё просто и логично. Что тут, блин, могло сломаться?</p>
<p class="measure-wide"><a href="https://twitter.com/EffinBirds/status/1489980393675702281" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/reuse-carefully/snap-tweet-EffinBirds-1489980393675702281.png"/></a></p>
<p class="measure-wide">Ладно, лезу в документ ручками. А там внезапно всё тип-топ: оформление работает как надо. Плавающий баг, что ли? Запускаю автотест снова, в нужный момент вклиниваюсь с отладчиком и обнаруживаю какую-то откровенную фигню: в списке «нулевых» ставок, кроме них самих — пачка пустых ссылок! </p>
<p class="measure-wide">Откровенно чешу в затылке. Этот список документ получает из общего модуля, где лежит <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/5ec036ee148606aad9caefbc9305bfb0" target="_blank">примерно такой код</a>. Пустую ссылку отсюда даже теоретически получить нельзя. Причем у модуля включено переиспользование возвращаемых значений и функция по факту выполняется один раз где-то в начале теста, до всех сложных манипуляций с данными. То есть тест, по идее, повлиять на неё никак не может.</p>
<p class="measure-wide">Тупик? Ну, опытные коллеги уже, наверное, обо всём догадались, но мне пришлось порядком потанцевать вокруг бага и даже залезть в <a class="link blue dim bb" href="https://its.1c.ru/db/v8std/content/724/hdoc" target="_blank">стандарт</a>, пока не дошло: <strong>кэш возвращаемых значений в 1С можно изменить</strong>. В смысле, не просто вызвать ОбновитьПовторноИспользуемыеЗначения(), а прямо вот ручками взять и поменять конкретные данные.</p>
<p class="measure-wide">Как? Ну, если вы тянете из общего модуля со включенным кэшированием какие-то значения и они не примитивного типа (строка, число и т.п.) — вы получите не само значение, а указатель на него где-то в памяти. Запишете этот указатель в переменную и попробуете поменять — поменяете кэш.</p>
<p class="measure-wide">Вот так просто, да. Это и произошло в моем случае: метод, формирующий список «нулевых» ставок, вызывала форма другого документа. Получив список значений, она непринужденно дописывала к нему пустую ссылку и использовала в своей логике. Таким образом, при каждом открытии этой формы кэш списка прирастал всё новыми и новыми пустыми ссылками, что в конце концов сломало документ на другом конце конфы.</p>
<p class="measure-wide"><a href="https://twitter.com/EffinBirds/status/1488165946342662144" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/reuse-carefully/snap-tweet-EffinBirds-1488165946342662144.png"/></a></p>
<p class="measure-wide">По-хорошему, платформе стоило бы швыряться исключениями при попытке поменять кэш, но пока этого не происходит — надо бить себя по рукам самостоятельно. Например, при разработке кэшируемых модулей возвращать из них неизменяемые типы данных (ФиксированнаяСтруктура вместо Структура, ФиксированныйМассив вместо Массив и так далее). Это, правда, не стопроцентная защита: во-первых, фиксированные типы не везде применимы, а во-вторых — даже в последних версиях БСП это делается далеко не везде. Много конфигураций сейчас пишется не на БСП?</p>
<p class="measure-wide">Сонар тоже пока не умеет ловить проблему, а про менее популярные средства я вообще молчу. Никакой серебрянной пули, короче — следим за своим кодом, поглядываем в код коллег и стараемся не забывать об ещё одном изящном способе бахнуть себе в ногу.</p></description>
        </item>
        
    </channel>
</rss>