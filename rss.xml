<rss version="2.0">
    <channel>    
        <title>Влад Костянецкий</title>
        <description>Привет! Меня зовут Влад, я — разработчик приложений для бизнеса.</description>
        <language>ru</language>
        <link>https://kostyanetsky.ru</link>
        <lastBuildDate>Sun, 03 Aug 2025 16:25:35 +0700</lastBuildDate>
        
        <item>
            <title>Медленное удаление областей Фреша</title>
            <link>https://kostyanetsky.ru/notes/data-history-missing-indexes</link>
            <guid isPermaLink="false">note-data-history-missing-indexes</guid>
            <pubDate>Sun, 03 Aug 2025 16:25:35 +0700</pubDate>
            <description><p>Коллега заметил, что на одном из инстансов нашего фреша удаление областей стало идти прямо-таки трагически долго. Что в метриках? Вот это:</p>
<pre>
DELETE FROM T1
FROM _DataHistoryMetadata T1
WHERE 
    T1._MetadataId = ?
    AND T1._IsActual = 0x00 
    AND NOT (
        T1._MetadataVersionNumber IN (
            SELECT T2._MetadataVersionNumber AS MetadataVersionNumber_
            FROM _DataHistoryVersions T2
            WHERE T2._HistoryDataId IN (
                SELECT DataHistoryLatestVersions1.DataHistoryLatestVersions._HistoryDataId AS HistoryDataId_
                FROM DataHistoryLatestVersions1.DataHistoryLatestVersions T3
                WHERE DataHistoryLatestVersions1.DataHistoryLatestVersions._MetadataId = ?
            )
        )
    )
</pre>
<p>Каждый такой запрос читает порядка двадцати гигабайт. Что тут происходит — примерно понятно: платформа пытается удалить историю данных области и кривой запрос к БД приводит к сканированию всей таблицы по всем областям вместо быстрого поиска по индексу. Кто-то на Дмитровском опять поленился.</p>
<p><a href="https://x.com/EffinBirds/status/1945545263407301033" target="_blank"><img alt="Чему ты удивлён?" src="https://kostyanetsky.ru/notes/data-history-missing-indexes/why.png"/></a></p>
<p>В общем, теряем от тридцати секунд до полутора минут на действие. Хотелось бы побыстрее. Решение:</p>
<pre>
CREATE NONCLUSTERED INDEX IX_DataHistoryLatestVersions1_MetadataId
  ON dbo._DataHistoryLatestVersions1 (_MetadataId)
  INCLUDE (_HistoryDataId)
  WITH (DROP_EXISTING = OFF, ONLINE = OFF);

CREATE NONCLUSTERED INDEX IX_DataHistoryVersions_MetadataVersionNumber
  ON dbo._DataHistoryVersions (_MetadataVersionNumber)
  WITH (DROP_EXISTING = OFF, ONLINE = OFF);
</pre>
<p>Стоимость удаления области ожидаемо просела на ~99%.</p>
<p>Если будете повторять у себя — помните, что:</p>
<ol>
<li>Формально такой трюк нарушает лицензионное соглашение, you've been warned и всё такое.</li>
<li>Есть риск, что платформа при будущих реструктуризациях будет спотыкаться о новые индексы (особенно при работе по «новой» схеме). Лучше иметь под рукой готовый скрипт, который сможет грохнуть индекс, а потом (после реструктуризации) — вернуть обратно.</li>
</ol></description>
        </item>
        
        <item>
            <title>Развенчиватель мифов</title>
            <link>https://kostyanetsky.ru/notes/myth-buster</link>
            <guid isPermaLink="false">note-myth-buster</guid>
            <pubDate>Sun, 27 Jul 2025 12:21:32 +0700</pubDate>
            <description><p>Попался под руку объёмный <a href="https://infostart.ru/1c/articles/2434171/" target="_blank">текст</a> на Инфостарте про мифы о платформе, полез читать.</p>
<p>По сути. Половина там написана заголовка ради, кажется. Свежий номер! Криминал, интриги, расследования! Файловая база быстрее клиент-серверной! СКД медленнее запроса! Вызов метода сервера на сервере — новый вызов сервера! <s>НЛО над Красной площадью!</s></p>
<p>Однако местами и правда любопытно. Например, о том, что код, слепленный в одну строку, механически работает в десять раз быстрее, я услышал впервые. Жалко, за такой отчаянный свэг коллеги побьют быстрее, чем успеешь порадоваться результату. Да и основные тормоза enterprise-приложений чаще растут из других мест.</p>
<p>Или, скажем, сравнение скорости выгрузки в таблицу для представлений объектов и для их наименований. Первое — в десятки раз медленнее! На первый взгляд странно: в конце концов, в обоих случаях у нас строки, и на момент замера они уже извлечены из базы. Думаю, что дело в типизации: строки представлений имеют неограниченную длину, в отличие от наименований. Отсюда расходы на выделение памяти, какие-то вспомогательные структуры и вот мы имеем то, что имеем.</p>
<p>P.S. Про некоторые аспекты из статьи я где-то у себя писал. Если навскидку — помню свою попытку <a href="https://kostyanetsky.ru/notes/is-ref-empty" target="_blank">измерить</a> скорость работы ValueIsFilled() и неприятный сюрприз от встроенного <a href="https://kostyanetsky.ru/notes/method-with-surprise" target="_blank">FindByNumber()</a>.</p></description>
        </item>
        
        <item>
            <title>Удаление геометрии</title>
            <link>https://kostyanetsky.ru/notes/delete-geometry</link>
            <guid isPermaLink="false">note-delete-geometry</guid>
            <pubDate>Thu, 12 Jun 2025 10:40:43 +0700</pubDate>
            <description><p>Освоил прикольный трюк с удалением части объекта в том случае, если он с чем-то пересекается. Например, на этой гифке в центре находится модель головы обезьянки; при движении плоскости видно, как её часть (как раз та, что начинает пересекаться с обезьянкой) исчезает.</p>
<p><img alt="Демо" src="https://kostyanetsky.ru/notes/delete-geometry/demo.gif"/></p>
<p><a href="https://github.com/vkostyanetsky/3DPlayground/blob/main/Geometry%20Nodes/DeleteGeometry.blend" target="_blank">Идея</a> довольно простая: сводим геометрию объекта-ограничителя к кубу, вычисляем его минимальные и максимальные координаты по всем осям, а потом для каждой точки «обрезаемого» объекта проверяем, входит ли она в полученный диапазон. Входит? Удаляем.</p>
<p>Способов применения — масса; например, мне это пригодилось, когда я захотел автоматически отрезать часть линий декоративного нотного стана на стене так, чтобы они не пересекали дверной проем.</p>
<p><img alt="Пример" src="https://kostyanetsky.ru/notes/delete-geometry/case.jpg"/></p>
<p>Конечно, можно было бы сделать это вручную, без геонод, но такой вариант ударил бы по гибкости: изменятся какие-то размеры (ширина стены, размеры двери, угол наклона линий) — всё придётся переделывать.</p></description>
        </item>
        
        <item>
            <title>Нет</title>
            <link>https://kostyanetsky.ru/notes/no</link>
            <guid isPermaLink="false">note-no</guid>
            <pubDate>Wed, 11 Jun 2025 19:29:33 +0700</pubDate>
            <description><p><img alt="Нет" src="https://kostyanetsky.ru/notes/no/no.jpg"/></p>
<p>Сообщение, которое выдает актуальная платформа при попытке подключения к выключенному кластеру серверов. Я, конечно, люблю лаконичность в интерфейсах, но тут всё-таки перебор.</p>
<p>Платформа, причем, установлена с единственным языковым пакетом (английским) и даже запущена с жестким указанием на «Ven VLen», но откуда-то всё равно прорастают родные березки. Возможно, сишная библиотека, откуда стреляет сообщение (DataExchangeTcpClientImpl.cpp) в моем случае смотрит на язык ОС (русский), сложно сказать.</p>
<p>В любом случае, не могу избавиться от ассоциаций с Багзом Банни каждый раз, как вижу это окошко.</p>
<p><img alt="No" src="https://kostyanetsky.ru/notes/no/bugs-bunny.png"/></p></description>
        </item>
        
        <item>
            <title>Проблема джинна</title>
            <link>https://kostyanetsky.ru/notes/hottabych</link>
            <guid isPermaLink="false">note-hottabych</guid>
            <pubDate>Sat, 12 Apr 2025 23:57:12 +0700</pubDate>
            <description><blockquote>
<p>Вернувшись в Волькину комнату, Хоттабыч хитро оглянулся, щелкнул пальцами левой руки, и на стене... Тотчас же появилось точное подобие телефона, висевшего в прихожей. </p>
<p>— Теперь ты сможешь сколько угодно беседовать с друзьями, не покидая своей комнаты.</p>
<p>— Вот за это спасибо! — с чувством промолвил Волька, снял трубку, прижал ее к уху и долго тщетно прислушивался. Никаких гудков не было слышно... </p>
<p>— Аппарат испорчен, — объяснил он Хоттабычу, — сейчас я открою крышку. Посмотрим, в чем там дело. </p>
<p>Но коробка аппарата, несмотря на все усилия Вольки, никак не открывалась. </p>
<p>— Он сделан из цельного куска самого отборного черного мрамора! — похвастался Хоттабыч.</p>
<p>— Значит, внутри там ничего нет? — разочарованно спросил Волька.</p>
<p>— А разве внутри должно что-нибудь быть? — забеспокоился Хоттабыч.</p>
<p>— В таком случае понятно, почему этот телефон не действует, — сказал Волька, — ты сделал только макет телефона, без всего, что полагается внутри.</p>
<p><em>«Старик Хоттабыч», Лазарь Лагин</em></p>
</blockquote>
<p>Занимаясь 3D-моделированием, регулярно ощущаю себя этим джинном. Старик тоже пытался повторять форму предметов и даже делал их симпатичнее, как умел — однако фейлился, так как не понимал, что там внутри. </p>
<p>Вот и я так же. Последний месяц довожу до ума модель школьного класса музыки и знаете что? Об устройстве рояля я уже узнал больше, чем за всю предыдущую жизнь. А ещё могу прочитать короткую лекцию о системах отопления в российских школах: секционных батареях, панельных, чугунных и алюминиевых, какие чаще встречаются, расстояниях между ними, почему не надо подключать три в ряд и так далее :)</p>
<p>Я читал об этом эффекте: мол, рисуешь, например, самурайскую броню — по ходу дела волей-неволей много узнаешь о свойствах кожи, видах металла и технологическом стеке самурайской эпохи в целом. Не думал, правда, что столкнусь с этим буквально с самого начала — но, думаю, это хорошо. Стимуляция нейронных связей, расширение видения мира, развитие креативности и всё такое.</p>
<p>Ну и в целом интереснее работать с моделью, когда понимаешь, что там, так сказать, внутри барабанчика.</p></description>
        </item>
        
        <item>
            <title>Пасхалки</title>
            <link>https://kostyanetsky.ru/notes/easter-eggs</link>
            <guid isPermaLink="false">note-easter-eggs</guid>
            <pubDate>Sun, 06 Apr 2025 23:33:52 +0700</pubDate>
            <description><p><img alt="Thank you, Mario!" src="https://kostyanetsky.ru/notes/easter-eggs/mario.jpg"/> <img alt="Awaiting Signal" src="https://kostyanetsky.ru/notes/easter-eggs/mothership.jpg"/></p>
<p>Пара пасхалок, которые можно найти внутри FirstBit ERP. Спрятаны для разработчиков: пользователи в первом случае видят на форме заголовок и текст оповещения, а во втором — стандартное waiting for connection.</p>
<p>Люблю время от времени делать такие штуки: это весело, а ещё — помогает не скучать, даже если задача не слишком увлекает или просто устал. Если не читали заметку «<a href="https://collab.ldwg.ru/stressless-design" target="_blank">Дизайн без стресса</a>» Быстроновского — прочитайте, она клёвая (а я все равно не сформулирую лучше).</p>
<p>Вот, кстати, ещё одна пасхалка. Эта уже не из нашей ERP, а из нового инструмента по автоматическому обновлению баз. Его мы пишем сами для себя, поэтому можно хохмить с пользователем :)</p>
<p><img alt="Nice try, Marty!" src="https://kostyanetsky.ru/notes/easter-eggs/marty.jpg"/></p></description>
        </item>
        
        <item>
            <title>Разработка ERP на английском</title>
            <link>https://kostyanetsky.ru/notes/across-meeting</link>
            <guid isPermaLink="false">note-across-meeting</guid>
            <pubDate>Sun, 19 Jan 2025 23:54:12 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/mZwHTbu285A" width="560"></iframe>
<p>Ведущий разработчик из нашей команды немного рассказал о нашей работе — конкретно, о разработке ERP на 1С для ОАЭ и, с недавних пор, Саудовской Аравии. Встречу захостила онлайн-школа английского языка Across, так что аудитория получилась соответствующая — русскоговорящие ребята, интересующиеся карьерой и рынками за рубежом.</p>
<p>В целом получилось прикольно, особенно как языковая практика. Напоминаю, что изучение иностранных языков — все ещё один из лучших способов размять мозги и, до кучи, один из самых доступных. Материалов и клубов по интересам не найти невозможно, было бы желание :)</p></description>
        </item>
        
        <item>
            <title>Загадочный код</title>
            <link>https://kostyanetsky.ru/notes/safe-code</link>
            <guid isPermaLink="false">note-safe-code</guid>
            <pubDate>Sat, 18 Jan 2025 23:25:22 +0700</pubDate>
            <description><p><img alt="Код" src="https://kostyanetsky.ru/notes/safe-code/code.jpg"/></p>
<p>Где-то на улицах Тбилиси. Как большой фанат серии Dishonored — не смог пройти мимо. Уверен, поблизости есть сейф, к которому этот код подходит!</p></description>
        </item>
        
        <item>
            <title>Уходи, негатив!</title>
            <link>https://kostyanetsky.ru/notes/negativity</link>
            <guid isPermaLink="false">note-negativity</guid>
            <pubDate>Sun, 29 Dec 2024 23:09:32 +0700</pubDate>
            <description><p><img alt="Чичилаки" src="https://kostyanetsky.ru/notes/negativity/chichilaki.jpg"/></p>
<p>Белые штуки на заднем плане называются чичилаки. Это что-то вроде грузинской новогодней ёлки (де-факто, тщательно наструганный орешник). Считается, что он собирает на себя весь накопившийся негатив, так что после праздников его положено сжечь (вместе с негативом).</p>
<p>Последнее, как оказалось, задача со звездочкой. Местная полиция (и особенно пожарка) относится к этой старой доброй традиции с подозрением, и их можно понять (чичилаки бывает и в рост человека, факел выйдет — будь здоров).  Так что «заряженную» негативом чичилаки нам посоветовали просто выкинуть в мусорку, чтобы не нажить свежих проблем. Или сдать в зоопарк: животные ими играют и зубы чистят.</p>
<p>Последнее позабавило. Избавиться от негатива помогают котики, какая неожиданность. Да, здоровенные и повышенной зубастости, но всё же!</p></description>
        </item>
        
        <item>
            <title>Немного хирургии</title>
            <link>https://kostyanetsky.ru/notes/bit-of-surgery</link>
            <guid isPermaLink="false">note-bit-of-surgery</guid>
            <pubDate>Tue, 17 Dec 2024 22:40:24 +0700</pubDate>
            <description><p>Несколько лет назад попадалась на глаза заметка программиста, которому пришлось отлаживать ПО, управляющее роботом-хирургом, прямо во время операции. Помню, тогда это меня поразило до глубины души.</p>
<p>А сегодня с коллегой ремонтировали кластер 1С с базами на 1cFresh, которому после миграции на соседний сервер внезапно поплохело (если вкратце, при попытке распечатать документ клиентское приложение умирало в муках). Пока возились, мелькнула мысль: это, конечно, не так жутко выглядит, как ремонтировать софт, от которого вот прямо сейчас зависит чья-то жизнь, но... Если посчитать всех клиентов, которые вот прямо сейчас сидят на нервах из-за того, что у них бизнес стоит — ещё неизвестно, где уровень стресса будет выше.</p>
<p>P.S. <strong>Technical dadoodas</strong> для тех, кому интересно. Вышло так, что при миграции кластера права на папку с серверным кэшем переехали некорректно и это привело к любопытному эффекту: в ней оседали только логи, а данные сеансов — нет. В итоге при открытии печатной формы документа конфигурация пыталась положить её в хранилище; rphost, в свою очередь, пытался засунуть её в серверный кэш сеанса.</p>
<p>Так что рабочий процесс (видимо) получал по рукам от ОС, из-за (видимо) кривой отработки событий файловой системы в платформе никак это исключение не обрабатывал и от безысходности убивал сеанс, что, в свою очередь, приводило к крашу клиентского процесса.</p>
<p>Пересобрали права, перезапустили кластер, проблема ушла.</p>
<p><img alt="End of Report" src="https://kostyanetsky.ru/notes/bit-of-surgery/report.jpeg"/></p>
<p>Остальные гипотезы (буйство менеджера кластера, недостаток аппаратных ресурсов, программные ошибки конфигурации, ошибки клиентского процесса, кривая отработка security profile, проблемы c сетью между клиентом и сервером) отбросили по ходу диагностики.</p></description>
        </item>
        
    </channel>
</rss>