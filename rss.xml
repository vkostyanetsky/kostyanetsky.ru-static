<rss version="2.0">
    <channel>    
        <title>Влад Костянецкий</title>
        <description>Привет! Меня зовут Влад, я — разработчик приложений для бизнеса.</description>
        <language>ru</language>
        <link>https://kostyanetsky.ru</link>
        <lastBuildDate>Mon, 19 Oct 2020 18:35:56 +0700</lastBuildDate>
        
        <item>
            <title>Профессиональная деформация</title>
            <link>https://kostyanetsky.ru/notes/nerdview</link>
            <guid isPermaLink="false">note-nerdview</guid>
            <pubDate>Mon, 19 Oct 2020 18:35:56 +0700</pubDate>
            <description><p><img alt="Чат с дочкой" src="https://kostyanetsky.ru/notes/nerdview/telegram.png"/></p>
<p>Дочка пишет о своих планах — мол, не теряй меня. А у меня профессиональная деформация: этот вполне нормальный чат мой мозг упорно воспринимает как код на Gherkin. Просто какой-то неправильный, что ли, хочется быстренько пофиксить :-)</p>
<pre><code>И я выхожу
Тогда я в школе
И я выхожу
Тогда я покачаюсь
</code></pre>
<p>Мы на этом языке пишем автотесты нашей конфигурации для <a href="https://github.com/Pr-Mex/vanessa-automation" target="_blank">Vanessa Automation</a>. Вроде не так уж много я их накатал (сравнивая с некоторыми коллегами — баловался, считай). Но, видимо, достаточно.</p></description>
        </item>
        
        <item>
            <title>Пустая() или ЗначениеЗаполнено()?</title>
            <link>https://kostyanetsky.ru/notes/is-ref-empty</link>
            <guid isPermaLink="false">note-is-ref-empty</guid>
            <pubDate>Sat, 11 Apr 2020 12:24:12 +0700</pubDate>
            <description><p>Несколько дней назад обсуждал с коллегой, какой способ проверки заполнения ссылки лучше. С одной стороны, время назад на каком-то курсе я слышал авторитетное мнение, что функцию ЗначениеЗаполнено() нужно использовать с осторожностью, так как её логика — сопоставлять переменную всем возможным пустым значениям, которые есть в конфигурации. И это, мол, огромная тормозная лапша. Как альтернативу автор курса советовал использовать метод ссылки Пустая(), а композитные реквизиты проверять примерно так:</p>
<pre><code>СсылкаЗаполнена = Ссылка &lt;&gt; Неопределено И Не Ссылка.Пустая();
</code></pre>
<p>Коллега в свою очередь утверждал, что ЗначениеЗаполнено() быстрее, так как это встроенная функция, которая не тратит время на поиск метода у объекта (в скриптовых языках это сравнительно медленная операция).</p>
<p>На моей памяти ни тот, ни другой метод узким местом никогда не были, но меня разобрало любопытство; написал <a href="https://github.com/vkostyanetsky/IsEmptyOrValueIsFilled" target="_blank">тест</a>, который проверяет ссылочную переменную на пустое значение обеими способами и замеряет время, которое было потрачено. </p>
<p>В среднем результат выглядит <a href="https://kostyanetsky.ru/notes/is-ref-empty/is-ref-empty.png" target="_blank">примерно так</a>. Там четыре шага — на первых двух предполагается, что ссылка определена, а на третьем и четвертом добавляется соответствующая проверка. В последней колонке таблицы виден контекст выполнения теста (клиент или сервер).</p>
<p>Вывод довольно очевиден: ЗначениеЗаполнено() никакой деградации не показывает, более того — работает быстрее, чем метод Пустая() (особенно если мы начинаем проверять переменную на Неопределено). Конечно, отклонение не слишком значительное, но на каких-то длительных регламентных операциях вполне можно сэкономить пару секунд.</p>
<p>Да и чисто практически проще делать проверку одним универсальным вызовом, а не пытаться угадать все возможные значения переменной.</p></description>
        </item>
        
        <item>
            <title>Знак амперсанда в 1С</title>
            <link>https://kostyanetsky.ru/notes/ampersand-sign-in-1c</link>
            <guid isPermaLink="false">note-ampersand-sign-in-1c</guid>
            <pubDate>Thu, 27 Dec 2018 10:11:50 +0700</pubDate>
            <description><p>При обработке символа амперсанда в тексте надписей платформа применяет стандартный подход Windows: то есть, сам амперсанд не отобразится, а следующий после него символ станет горячей клавишей для действия, закрепленного за надписью (например, обработчика команды или события элемента).</p>
<p>Пример ниже выведется как «Project Costing». Символ «P» в ней будет подчеркнут и станет горячей клавишей; если это, например, заголовок команды, то её можно будет вызвать, нажав Alt + P.</p>
<pre><code>ТекстНадписи = "&amp;Project Costing";
</code></pre>
<p>Единственное неудобство — если нужно вывести амперсанд прямо в надпись. В этом случае символ следует удвоить: так, пример ниже будет выглядеть как «Project P&amp;L». Никаких горячих клавиш в таком случае создано не будет.</p>
<pre><code>ТекстНадписи = "Project P&amp;&amp;L";
</code></pre></description>
        </item>
        
        <item>
            <title>Control и Poets of the Fall</title>
            <link>https://kostyanetsky.ru/notes/control-and-poets-of-the-fall</link>
            <guid isPermaLink="false">note-control-and-poets-of-the-fall</guid>
            <pubDate>Fri, 23 Aug 2019 18:02:23 +0700</pubDate>
            <description><p>Я и так уже не устоял перед рыжей чертовкой из <a href="https://youtu.be/oFjb_vlCsRA" target="_blank">трейлера</a> Control, а этим роликом ребята из Remedy и вовсе зашли с непробиваемых козырей.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/EpiahpKp-VA" width="560"></iframe>
<p>Послушайте, это просто неприлично круто! Можно как-нибудь перемотать время на конец августа? :-)</p></description>
        </item>
        
        <item>
            <title>Простая галочка</title>
            <link>https://kostyanetsky.ru/notes/simple-checkbox</link>
            <guid isPermaLink="false">note-simple-checkbox</guid>
            <pubDate>Sat, 30 Mar 2019 11:26:57 +0700</pubDate>
            <description><p>Пару недель назад мы добавили в справочник номенклатуры FirstBIT ERP параметр «Inactive». Задача была простой: если товар больше не нужен пользователю — он ставит галочку и тот исчезает отовсюду (из форм выбора, форм подбора остатков на складах и так далее).</p>
<p>Звучит несложно, правда? Техническая реализация тоже была простой — мы прошлись по всем объектам, в которых предполагается выбор номенклатуры, и добавили дополнительный параметр этого выбора.</p>
<p><img alt="Параметры выбора" src="https://kostyanetsky.ru/notes/simple-checkbox/choice-parameters.png"/></p>
<p>Но пользователи начали жаловаться, что настройка не работает. Мы полезли разбираться и поняли, что забыли про историю ввода — этот механизм, как оказалось, параметры выбора просто игнорирует. То есть пользователи выбирали в инвойсе какой-то товар, потом делали его неактивным, возвращались и инвойс и… Снова видели в истории товар, который вроде только что отключили.</p>
<p>Мы принялись искать выход. Проблема в том, что история ввода хранится в системном хранилище и повлиять на неё программно нельзя. Можно разве что полностью удалить — но фактическая очистка истории происходит только при перезапуске клиента (и то через раз). Отключить историю вообще? Напоминает лечение простуды отсечением головы.</p>
<p>В какой-то момент мы наткнулись на информацию о том, что история ввода хранится не просто для конкретного поля, а ещё и в разрезе параметров выбора. То есть для каждого сочетания параметров выбора и их значений история выбора своя. Получается, если добавить некий дополнительный параметр выбора ко всем полям, где выбирается номенклатура — изменение значения этого параметра будет «чистить» историю (на самом деле, конечно, создавать новую — но пользователю-то какая разница).</p>
<p>В общем, мы создали такой параметр. Хранится в общем хранилище и транслируется в формы при их открытии через общий модуль, который программно добавляет параметр выбора. Если пользователь снимает или устанавливает флаг Inactive для любой номенклатуры — значение параметра меняется, а уже открытые формы получают его через механизм оповещений.</p>
<p><img alt="Минуточку!" src="https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif"/></p>
<p>А ведь как все невинно начиналось, а?</p>
<p>Однако механизм неплохо работает, хотя его недостатки налицо: во-первых, системное хранилище будет постепенно пухнуть по мере появления всё новых и новых сочетаний реальных параметров выбора и нашего, фиктивного. Во-вторых, запись номенклатуры теперь потенциально узкое место: два пользователя не смогут одновременно записать номенклатуры, у которых изменены флаги Inactive (будет блокировка при записи нового значения нашего скрытого параметра выбора в общее хранилище).</p>
<p>Первую проблему можно решить очисткой хранилища по какому-то триггеру, вторую — записью нашего параметра выбора в разрезе пользователей (например, через регистр сведений). Впрочем, мы искренне надеемся, что 1С даст какой-то доступ к истории ввода до того, как нам придется городить дополнительные костыли к тем, что мы уже наворотили :-)</p></description>
        </item>
        
        <item>
            <title>СКД и право просмотра</title>
            <link>https://kostyanetsky.ru/notes/rights-for-dcs</link>
            <guid isPermaLink="false">note-rights-for-dcs</guid>
            <pubDate>Tue, 28 Aug 2018 20:35:33 +0700</pubDate>
            <description><p>Универсальный подход системы компоновки данных «если у пользователя нет права на просмотр чего-то, то этого как бы нет» иногда заставляет платформу выкидывать знатные фортели. Нет, сферический отчет в вакууме и правда работает хорошо — например, если нет права на просмотр какого-то справочника, то в отчете он фигурировать не будет. Однако реальные примеры бывают посложнее.</p>
<p>Например, пару недель назад я отлаживал отчет, который при попытке генерации выдавал понятную на первый взгляд ошибку:</p>
<p><img alt="У вас настройка кривая, товарищ!" src="https://kostyanetsky.ru/notes/rights-for-dcs/ru.png"/></p>
<p>Отчет гигантский — запрос на добрую тысячу строк, сложная настройка, здоровенный макет, запутанный код компоновки. Первое подозрение пало на ошибку в настройке, но расследование быстро дошло от ссылки на валюту в выборке данных до чтения константы с этой валютой на самом нижнем уровне отчета, на которую не было права просмотра.</p>
<p>Не скажу сходу, что именно тут сбило платформу с толку и привело к не очевидной диагностике — то ли манипуляции с временной таблицей, куда эта константа была прочитана, то ли то, что читалась она в конструкции ВЫБОР, то ли то, что на сам справочник валют все необходимые права были. Искать конкретное условие или их сочетания я не стал — думаю, это просто специфика реализации движка СКД, которая может меняться от версии к версии. Достаточно не забывать о праве просмотра, и проблемы не будет.</p>
<p>Что касается ошибки, при столкновении с ней стоит вывести проблемный отчет под полными правами. Если тут всё о'кей, нужно набросать список таблиц, откуда отчет читает данные, и проверить — все ли они с правами на чтение и просмотр.</p>
<p>Нудно, но может сэкономить прилично времени.</p></description>
        </item>
        
        <item>
            <title>Почему не баш?</title>
            <link>https://kostyanetsky.ru/notes/why-not-bash</link>
            <guid isPermaLink="false">note-why-not-bash</guid>
            <pubDate>Sat, 03 Jul 2021 21:31:48 +0700</pubDate>
            <description><p>В прошлой заметке я говорил о задачах, для решения которых баш — идеальный инструмент: минимум ограничений, простые условия — и оговорился, что иногда он вообще не справляется.</p>
<p>Чтобы не быть голословным, давайте пример из практики. Есть, скажем, порядка семидесяти гигабайт логов ТЖ 1С, по которым нужно построить топ пояснений к исключениям — от самых частотных к менее частотным.</p>
<p>Плёвое дело, верно? Выгребаем EXCP, извлекаем Descr, считаем повторения. Даже нужный <a href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический журнал/FrequentExceptions.sh" target="_blank">скрипт</a> я как-то уже писал. Запускаю, терпеливо жду…</p>
<p>Знаете, сколько понадобилось времени? Я тоже нет: после того, как скрипт проработал сутки, я его вырубил и полез разбираться, в чём проблема. Затык возник где-то в скрипте gawk'а: именно она активно нагружала процессор (если не считать cat'а, которая время от времени читала очередную порцию данных).</p>
<p><img alt="Процессы" src="https://kostyanetsky.ru/notes/why-not-bash/procexp64.png"/></p>
<p>Беда, беда, огорчение! В общем, я подумал и <a href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический журнал/FrequentExceptions.py" target="_blank">переписал</a> этот скрипт на Питоне. Новая версия отработала за 15 минут и дала мне:</p>
<ol>
<li>Топ пояснений по событиям исключений;</li>
<li>Скрипт, который можно прочитать через полгода без помощи гугла;</li>
<li>Уверенность, что я могу добавить в скрипт два-три условия и не вызвать Сатану случайным сочетанием операторов и ключей.</li>
</ol>
<p>Конечно, я мог оптимизировать версию на баше. Вероятно, тормозит поиск в массиве — время, необходимое для поиска пояснения в массиве уже зафиксированных пояснений, линейно растет с увеличением размера массива. Можно, например, попробовать изменить подход к сбору данных — gawk'ом только извлекать сами пояснения, а результат сбора передать в тандем sort &amp; uniq.</p>
<p>Однако это уже отчётливо отдаёт <a href="https://kostyanetsky.ru/notes/why-not-bash/but-why.jpg" target="_blank">мемасом</a> про буханку хлеба: из неё, конечно, можно сделать троллейбус, просто не очень понятно — зачем? Камон, мне бы проблему решить. А Питон с ней уже справился на твердую пятёрку, чем сэкономил мне кучу времени и нервов.</p>
<p>Собственно, к этому я вел. Родовые травмы баша понятны и нередко приемлемы, плюсы — приятны и очевидны, но при работе с ним вопрос иногда встает так: cтоит ли только ради того, чтобы получить решение именно на баше, потратить часа два на возню с утилитами, параметрами, мануалами и постами на Stack Overflow? </p>
<p><a href="https://twitter.com/EffinBirds/status/1408560771877965825" target="_blank"><img alt="Твит" src="https://kostyanetsky.ru/notes/why-not-bash/snap-tweet-EffinBirds-1408560771877965825.png"/></a></p>
<p>Вот поэтому не баш, да.</p>
<p>UPD: Хорошая <a href="https://grishaev.me/no-bash/" target="_blank">заметка</a> Ивана Гришаева на ту же тему.</p></description>
        </item>
        
        <item>
            <title>Распределенный дизайн</title>
            <link>https://kostyanetsky.ru/notes/distributed-design</link>
            <guid isPermaLink="false">note-distributed-design</guid>
            <pubDate>Sat, 20 Oct 2018 12:34:45 +0700</pubDate>
            <description><p>Дизайнер из «Stack Overflow» <a href="http://www.tedgoas.com/blog/distributed-design" target="_blank">написал</a> о том, как они организуют удаленную работу. Понравилась структура текста — не просто «как мы это делаем», а прямо парами: проблема + решение. </p>
<p>У нас в компании почти вся разработка — удаленная и сам я — тоже удаленщик. Мне очень нравится так работать; главное тут — помнить, как легко нахватать самых неожиданных проблем, когда твое рабочее место и твой дом — одно и то же место. Советы из статьи пить воду и вылезать под солнце вполне себе актуальны, например — в ходе какого-нибудь кранча про это и правда легко забыть.</p></description>
        </item>
        
        <item>
            <title>Одиночество</title>
            <link>https://kostyanetsky.ru/notes/loneliness</link>
            <guid isPermaLink="false">note-loneliness</guid>
            <pubDate>Fri, 01 Mar 2019 16:50:19 +0700</pubDate>
            <description><p>Хороший ролик про одиночество, его причины и последствия (спойлер: все серьёзно, вплоть до биологического уровня). Рассказывают на английском, но если нужно — там есть русские субтитры.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/n3Xv_g3g-mA" width="560"></iframe>
<p>(емкий <a href="https://twitter.com/StatusyOk/status/1098845710668185602" target="_blank">твит</a> о том же)</p>
<p>(а также я, походу, достаточно много наиграл в Starcraft II, чтобы название ролика у меня в голове произносилось исключительно голосом Зератула и под музыку из <a href="https://www.youtube.com/watch?v=xu94hnQDnRY" target="_blank">Alone</a>)</p></description>
        </item>
        
        <item>
            <title>ГПиМРМ</title>
            <link>https://kostyanetsky.ru/notes/hpmor</link>
            <guid isPermaLink="false">note-hpmor</guid>
            <pubDate>Sun, 06 Nov 2016 15:32:00 +0700</pubDate>
            <description><p>Дочитал «Гарри Поттер и методы рационального мышления» — эпический фанфик по сами-знаете-какой вселенной. Автор — крутой спец по искусственному интеллекту и интересен сам по себе, но вот эту его книгу я прямо настойчиво <a href="http://hpmor.ru" target="_blank">рекомендую</a>.</p>
<p>В первую очередь — как очень любопытное переосмысление оригинальной саги Джоан Роулинг. Многие аспекты поданы как минимум не менее интересно и выпукло, и вообще интрига закручена отменная — две трети истории я прочитал, не выключая <a href="https://kostyanetsky.ru/notes/hpmor/gene-wilder-meme.jpg" target="_blank">Джина Уайлдера</a> :-) При этом автор ухитрился свести концы с концами и закрыть сюжетную линию так, что претензий у меня почти не осталось.</p>
<p>Ну и в любом случае, безотносительно всего — это неплохой способ знакомства с кучей научных, около-научных и просто интересных штук, так или иначе затронутых по ходу дела. Автор умен, и книжка тоже вышла неглупая.</p></description>
        </item>
        
    </channel>
</rss>